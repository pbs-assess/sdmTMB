<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Optimization control options — sdmTMBcontrol • sdmTMB</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimization control options — sdmTMBcontrol"><meta name="description" content="sdmTMB() and stats::nlminb() control options."><meta property="og:description" content="sdmTMB() and stats::nlminb() control options."><meta property="og:image" content="https://sdmTMB.github.io/sdmTMB/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sdmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.4.9024</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sdmTMB/sdmTMB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Optimization control options</h1>
      <small class="dont-index">Source: <a href="https://github.com/sdmTMB/sdmTMB/blob/main/R/utils.R" class="external-link"><code>R/utils.R</code></a></small>
      <div class="d-none name"><code>sdmTMBcontrol.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code><a href="sdmTMB.html">sdmTMB()</a></code> and <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code> control options.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sdmTMBcontrol</span><span class="op">(</span></span>
<span>  eval.max <span class="op">=</span> <span class="fl">2000L</span>,</span>
<span>  iter.max <span class="op">=</span> <span class="fl">1000L</span>,</span>
<span>  normalize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  nlminb_loops <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  newton_loops <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  getsd <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  quadratic_roots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  start <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  map <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lower <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  upper <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  censored_upper <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  multiphase <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  profile <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  get_joint_precision <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"sdmTMB.cores"</span>, <span class="fl">1L</span><span class="op">)</span>,</span>
<span>  suppress_nlminb_warnings <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  collapse_spatial_variance <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  collapse_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-eval-max">eval.max<a class="anchor" aria-label="anchor" href="#arg-eval-max"></a></dt>
<dd><p>Maximum number of evaluations of the objective function
allowed.</p></dd>


<dt id="arg-iter-max">iter.max<a class="anchor" aria-label="anchor" href="#arg-iter-max"></a></dt>
<dd><p>Maximum number of iterations allowed.</p></dd>


<dt id="arg-normalize">normalize<a class="anchor" aria-label="anchor" href="#arg-normalize"></a></dt>
<dd><p>Logical: use <code><a href="https://rdrr.io/pkg/TMB/man/normalize.html" class="external-link">TMB::normalize()</a></code> to normalize the process
likelihood using the Laplace approximation? Can result in a substantial
speed boost in some cases. This used to default to <code>FALSE</code> prior to
May 2021. Currently not working for models fit with REML or random intercepts.</p></dd>


<dt id="arg-nlminb-loops">nlminb_loops<a class="anchor" aria-label="anchor" href="#arg-nlminb-loops"></a></dt>
<dd><p>How many times to run <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code> optimization.
Sometimes restarting the optimizer at the previous best values aids
convergence. If the maximum gradient is still too large,
try increasing this to <code>2</code>.</p></dd>


<dt id="arg-newton-loops">newton_loops<a class="anchor" aria-label="anchor" href="#arg-newton-loops"></a></dt>
<dd><p>How many Newton optimization steps to try after running
<code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code>. This sometimes aids convergence by further reducing the
log-likelihood gradient with respect to the fixed effects. This calculates
the Hessian at the current MLE with <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optimHess()</a></code> using a
finite-difference approach and uses this to update the fixed effect
estimates.</p></dd>


<dt id="arg-getsd">getsd<a class="anchor" aria-label="anchor" href="#arg-getsd"></a></dt>
<dd><p>Logical indicating whether to call <code><a href="https://rdrr.io/pkg/TMB/man/sdreport.html" class="external-link">TMB::sdreport()</a></code>.</p></dd>


<dt id="arg-quadratic-roots">quadratic_roots<a class="anchor" aria-label="anchor" href="#arg-quadratic-roots"></a></dt>
<dd><p>Experimental feature for internal use right now; may
be moved to a branch. Logical: should quadratic roots be calculated? Note:
on the sdmTMB side, the first two coefficients are used to generate the
quadratic parameters. This means that if you want to generate a quadratic
profile for depth, and depth and depth^2 are part of your formula, you need
to make sure these are listed first and that an intercept isn't included.
For example, <code>formula = cpue ~ 0 + depth + depth2 + as.factor(year)</code>.</p></dd>


<dt id="arg-start">start<a class="anchor" aria-label="anchor" href="#arg-start"></a></dt>
<dd><p>A named list specifying the starting values for parameters. You
can see the necessary structure by fitting the model once and inspecting
<code>your_model$tmb_obj$env$parList()</code>. Elements of <code>start</code> that are specified
will replace the default starting values.</p></dd>


<dt id="arg-map">map<a class="anchor" aria-label="anchor" href="#arg-map"></a></dt>
<dd><p>A named list with factor <code>NA</code>s specifying parameter values that
should be fixed at a constant value. See the documentation in
<code><a href="https://rdrr.io/pkg/TMB/man/MakeADFun.html" class="external-link">TMB::MakeADFun()</a></code>. This should usually be used with <code>start</code> to specify the
fixed value.</p></dd>


<dt id="arg-lower">lower<a class="anchor" aria-label="anchor" href="#arg-lower"></a></dt>
<dd><p>An optional named list of lower bounds within the optimization.
Parameter vectors with the same name (e.g., <code>b_j</code> or <code>ln_kappa</code> in some
cases) can be specified as a numeric vector. E.g.
<code>lower = list(b_j = c(-5, -5))</code>. Note that <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optimHess()</a></code> does not
implement lower and upper bounds, so you must set <code>newton_loops = 0</code> if
setting limits.</p></dd>


<dt id="arg-upper">upper<a class="anchor" aria-label="anchor" href="#arg-upper"></a></dt>
<dd><p>An optional named list of upper bounds within the optimization.</p></dd>


<dt id="arg-censored-upper">censored_upper<a class="anchor" aria-label="anchor" href="#arg-censored-upper"></a></dt>
<dd><p>An optional vector of upper bounds for
<code>sdmTMBcontrol()</code>. Values of <code>NA</code> indicate an unbounded right-censored to
distribution, values greater that the observation indicate and upper bound,
and values equal to the observation indicate no censoring.</p></dd>


<dt id="arg-multiphase">multiphase<a class="anchor" aria-label="anchor" href="#arg-multiphase"></a></dt>
<dd><p>Logical: estimate the fixed and random effects in phases?
Phases are usually faster and more stable.</p></dd>


<dt id="arg-profile">profile<a class="anchor" aria-label="anchor" href="#arg-profile"></a></dt>
<dd><p>Logical: should population-level/fixed effects be profiled
out of the likelihood? These are then appended to the random effects
vector without the Laplace approximation. See <code><a href="https://rdrr.io/pkg/TMB/man/MakeADFun.html" class="external-link">TMB::MakeADFun()</a></code>. <em>This
can dramatically speed up model fit if there are many fixed effects but is
experimental at this stage.</em></p></dd>


<dt id="arg-get-joint-precision">get_joint_precision<a class="anchor" aria-label="anchor" href="#arg-get-joint-precision"></a></dt>
<dd><p>Logical. Passed to <code>getJointPrecision</code> in
<code><a href="https://rdrr.io/pkg/TMB/man/sdreport.html" class="external-link">TMB::sdreport()</a></code>. Must be <code>TRUE</code> to use simulation-based methods in
<code><a href="predict.sdmTMB.html">predict.sdmTMB()</a></code> or <code>[get_index_sims()]</code>. If not needed, setting this
<code>FALSE</code> will reduce object size.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Argument currently ignored. For parallel processing with 3
cores, as an example, use <code>TMB::openmp(n = 3, DLL = "sdmTMB")</code>. But be
careful, because it's not always faster with more cores and there is
definitely an upper limit.</p></dd>


<dt id="arg-suppress-nlminb-warnings">suppress_nlminb_warnings<a class="anchor" aria-label="anchor" href="#arg-suppress-nlminb-warnings"></a></dt>
<dd><p>Suppress uninformative warnings
from <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code> arising when a function evaluation is <code>NA</code>, which
are then replaced with <code>Inf</code> and avoided during estimation?</p></dd>


<dt id="arg-collapse-spatial-variance">collapse_spatial_variance<a class="anchor" aria-label="anchor" href="#arg-collapse-spatial-variance"></a></dt>
<dd><p>Logical: should spatial and/or spatiotemporal
random fields be automatically dropped if their estimated standard deviation
is effectively zero (i.e., below <code>collapse_threshold</code>)? This helps prevent
overfitting and numerical instability when the data provide little evidence
for spatial or spatiotemporal variation. I.e., when the variance parameter is
estimated on or near the boundary of zero. When enabled, the model will be
automatically refitted via <code><a href="update.sdmTMB.html">update.sdmTMB()</a></code> with the corresponding field(s)
disabled. This adds a computational cost (a single model refit if
collapsing occurs) but can yield a simpler, more stable model and more
reliable inference. Default is <code>FALSE</code> for backwards compatibility.</p></dd>


<dt id="arg-collapse-threshold">collapse_threshold<a class="anchor" aria-label="anchor" href="#arg-collapse-threshold"></a></dt>
<dd><p>Numeric: the standard deviation threshold below which random
fields are considered to be collapsing to zero. Only used when
<code>collapse_spatial_variance = TRUE</code>. Values are on the standard deviation
scale (i.e., square root of variance). Default is 0.01.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Anything else. See the 'Control parameters' section of
<code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of control arguments</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Usually used within <code><a href="sdmTMB.html">sdmTMB()</a></code>. For example:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">sdmTMB</span>(..., <span class="at">control =</span> <span class="fu">sdmTMBcontrol</span>(<span class="at">newton_loops =</span> <span class="dv">2</span>))</span></code></pre><p></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu">sdmTMBcontrol</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $eval.max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $iter.max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $normalize</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $nlminb_loops</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $newton_loops</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $getsd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $profile</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $quadratic_roots</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $start</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $map</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $lower</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $censored_upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $multiphase</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $parallel</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $get_joint_precision</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $collapse_spatial_variance</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $collapse_threshold</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean C. Anderson, Eric J. Ward, Philina A. English, Lewis A. K. Barnett, James T. Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

