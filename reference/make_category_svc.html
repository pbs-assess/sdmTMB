<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Set up spatially varying coefficients for category composition models — make_category_svc • sdmTMB</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Set up spatially varying coefficients for category composition models — make_category_svc"><meta name="description" content="This function helps set up the data structure, formula, and mapping needed
for fitting spatially varying coefficient models with categories (e.g., ages,
length bins, species) that have both spatial and spatiotemporal random
fields. It's particularly useful for age or length composition
standardization models."><meta property="og:description" content="This function helps set up the data structure, formula, and mapping needed
for fitting spatially varying coefficient models with categories (e.g., ages,
length bins, species) that have both spatial and spatiotemporal random
fields. It's particularly useful for age or length composition
standardization models."><meta property="og:image" content="https://sdmTMB.github.io/sdmTMB/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sdmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.4.9024</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sdmTMB/sdmTMB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Set up spatially varying coefficients for category composition models</h1>
      <small class="dont-index">Source: <a href="https://github.com/sdmTMB/sdmTMB/blob/main/R/utils.R" class="external-link"><code>R/utils.R</code></a></small>
      <div class="d-none name"><code>make_category_svc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function helps set up the data structure, formula, and mapping needed
for fitting spatially varying coefficient models with categories (e.g., ages,
length bins, species) that have both spatial and spatiotemporal random
fields. It's particularly useful for age or length composition
standardization models.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">make_category_svc</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">category_column</span>,</span>
<span>  <span class="va">time_column</span>,</span>
<span>  share_spatial_sd <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  share_spatiotemporal_sd <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data frame containing the composition data.</p></dd>


<dt id="arg-category-column">category_column<a class="anchor" aria-label="anchor" href="#arg-category-column"></a></dt>
<dd><p>Character. Name of the category column (e.g., "Age",
"length_bin", "species").</p></dd>


<dt id="arg-time-column">time_column<a class="anchor" aria-label="anchor" href="#arg-time-column"></a></dt>
<dd><p>Character. Name of the time column (e.g., "Year").</p></dd>


<dt id="arg-share-spatial-sd">share_spatial_sd<a class="anchor" aria-label="anchor" href="#arg-share-spatial-sd"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, all categories share the same
spatial SD. If <code>FALSE</code>, each category gets its own spatial SD.</p></dd>


<dt id="arg-share-spatiotemporal-sd">share_spatiotemporal_sd<a class="anchor" aria-label="anchor" href="#arg-share-spatiotemporal-sd"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, all category-time
combinations share the same spatiotemporal SD. If <code>FALSE</code>, each gets its
own.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing:</p><ul><li><p><code>data_expanded</code>: Data frame with added model matrix columns for use in <code><a href="sdmTMB.html">sdmTMB()</a></code>.</p></li>
<li><p><code>svc_formula</code>: Formula for the <code>spatial_varying</code> argument in <code><a href="sdmTMB.html">sdmTMB()</a></code>.</p></li>
<li><p><code>svc_map</code>: Map list for the <code>map</code> argument in <code><a href="sdmTMBcontrol.html">sdmTMBcontrol()</a></code>.</p></li>
<li><p><code>info</code>: List with summary information about the model structure.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function creates spatially varying coefficient structures for
composition models by setting up:</p><ol><li><p><strong>Spatial fields</strong>: One field per category (e.g., age-specific spatial
fields) 2. <strong>Spatiotemporal fields</strong>: One field per category-time combination
(e.g., age-year fields)</p></li>
</ol><p>The sharing of variance parameters is controlled by <code>share_spatial_sd</code> and
<code>share_spatiotemporal_sd</code>. When <code>TRUE</code>, all fields of that type share the
same variance parameter, which is more parsimonious but assumes similar
variance magnitudes across categories.</p>
<p>The resulting model structure allows each category to have its own spatial
pattern and temporal variation while controlling parameter sharing for
identifiability and computational efficiency.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, each <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">:</span><span class="fl">2022</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  abundance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">60</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">60</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">60</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set up model components</span></span></span>
<span class="r-in"><span><span class="va">setup</span> <span class="op">&lt;-</span> <span class="fu">make_category_svc</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>  category_column <span class="op">=</span> <span class="st">"age"</span>,</span></span>
<span class="r-in"><span>  time_column <span class="op">=</span> <span class="st">"year"</span>,</span></span>
<span class="r-in"><span>  share_spatial_sd <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  share_spatiotemporal_sd <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the setup</span></span></span>
<span class="r-in"><span><span class="va">setup</span><span class="op">$</span><span class="va">info</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n_categories</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n_times</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n_spatial_terms</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n_spatiotemporal_terms</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n_variance_parameters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $spatial_terms</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "age1" "age2" "age3"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $spatiotemporal_terms</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "factor(year)2020:age1" "factor(year)2021:age1" "factor(year)2022:age1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4] "factor(year)2020:age2" "factor(year)2021:age2" "factor(year)2022:age2"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7] "factor(year)2020:age3" "factor(year)2021:age3" "factor(year)2022:age3"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $share_spatial_sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $share_spatiotemporal_sd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># See the age composition standardization vignette for more details</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean C. Anderson, Eric J. Ward, Philina A. English, Lewis A. K. Barnett, James T. Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

