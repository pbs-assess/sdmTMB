<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate range edges via simulation from the joint precision matrix — get_range_edge • sdmTMB</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate range edges via simulation from the joint precision matrix — get_range_edge"><meta name="description" content="
Calculate range edges as density-weighted quantiles along a spatial axis.
Range edges are calculated as the positions along a user-supplied spatial
axis (e.g., latitude, coastal distance) where the cumulative proportion of
density equals specified quantiles (e.g., 0.01 and 0.99 for the lower and
upper 1% range edges). Uncertainty is calculated via simulation from the
joint precision matrix."><meta property="og:description" content="
Calculate range edges as density-weighted quantiles along a spatial axis.
Range edges are calculated as the positions along a user-supplied spatial
axis (e.g., latitude, coastal distance) where the cumulative proportion of
density equals specified quantiles (e.g., 0.01 and 0.99 for the lower and
upper 1% range edges). Uncertainty is calculated via simulation from the
joint precision matrix."><meta property="og:image" content="https://sdmTMB.github.io/sdmTMB/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sdmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.4.9024</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sdmTMB/sdmTMB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate range edges via simulation from the joint precision matrix</h1>
      <small class="dont-index">Source: <a href="https://github.com/sdmTMB/sdmTMB/blob/main/R/get-range-edge.R" class="external-link"><code>R/get-range-edge.R</code></a></small>
      <div class="d-none name"><code>get_range_edge.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p>
<p>Calculate range edges as density-weighted quantiles along a spatial axis.
Range edges are calculated as the positions along a user-supplied spatial
axis (e.g., latitude, coastal distance) where the cumulative proportion of
density equals specified quantiles (e.g., 0.01 and 0.99 for the lower and
upper 1% range edges). Uncertainty is calculated via simulation from the
joint precision matrix.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_range_edge</span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  <span class="va">axis</span>,</span>
<span>  quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span>,</span>
<span>  level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  return_sims <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-obj">obj<a class="anchor" aria-label="anchor" href="#arg-obj"></a></dt>
<dd><p><code><a href="predict.sdmTMB.html">predict.sdmTMB()</a></code> output with <code>nsim &gt; 0</code>. The prediction object
should include predictions on a spatial grid that covers the area of interest.</p></dd>


<dt id="arg-axis">axis<a class="anchor" aria-label="anchor" href="#arg-axis"></a></dt>
<dd><p>Numeric vector of the same length as the prediction data,
representing the spatial axis along which to calculate range edges
(e.g., latitude, coastal distance values). This should align with
the rows of the prediction matrix.</p></dd>


<dt id="arg-quantiles">quantiles<a class="anchor" aria-label="anchor" href="#arg-quantiles"></a></dt>
<dd><p>Numeric vector of quantiles to calculate. Default is
<code>c(0.025, 0.975)</code> for lower and upper 1% range edges. Common alternatives
include <code>c(0.01, 0.99)</code> for 1% edges or <code>c(0.05, 0.5, 0.95)</code> to
include the median.</p></dd>


<dt id="arg-level">level<a class="anchor" aria-label="anchor" href="#arg-level"></a></dt>
<dd><p>The confidence level for uncertainty intervals.</p></dd>


<dt id="arg-return-sims">return_sims<a class="anchor" aria-label="anchor" href="#arg-return-sims"></a></dt>
<dd><p>Logical. Return simulation draws? The default (<code>FALSE</code>)
returns a quantile summary of the simulation draws.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame. If <code>return_sims = FALSE</code>:</p><ul><li><p>name of time column (e.g., <code>year</code>) that was supplied to <code><a href="sdmTMB.html">sdmTMB()</a></code> time argument</p></li>
<li><p><code>quantile</code>: the quantile value (from <code>quantiles</code> argument)</p></li>
<li><p><code>est</code>: estimated range edge position</p></li>
<li><p><code>lwr</code>: lower confidence interval</p></li>
<li><p><code>upr</code>: upper confidence interval</p></li>
<li><p><code>se</code>: standard error</p></li>
</ul><p>If <code>return_sims = TRUE</code>, simulation draws from range edge positions in long format:</p><ul><li><p>name of time column (e.g., <code>year</code>)</p></li>
<li><p><code>quantile</code>: the quantile value</p></li>
<li><p><code>.value</code>: simulated range edge position</p></li>
<li><p><code>.iteration</code>: simulation number</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function implements a similar approach to VAST's range edge
calculations, following methods from Fredston et al. (2021) and similar
studies. The method:</p><ol><li><p>Orders spatial locations by position along the specified axis</p></li>
<li><p>Calculates cumulative proportion of total density along that axis</p></li>
<li><p>Finds positions where cumulative proportion equals target quantiles</p></li>
<li><p>Uses simulation from the joint precision to quantify uncertainty</p></li>
</ol><p>To find the exact position where the cumulative proportion equals a target
quantile, the function uses linear interpolation between adjacent grid
points. This provides more accurate range edge estimates than selecting the
closest grid point, especially on coarser grids or for extreme quantiles
(e.g., 0.01, 0.99).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Fredston, A. L., Pinsky, M., Selden, R. L., Szuwalski, C., Thorson, J. T.,
Gaines, S. D., &amp; Halpern, B. S. (2021). Range edges of North American
marine species are tracking temperature over decades. Global Change Biology,
27(13), 3145-3156. <a href="https://doi.org/10.1111/gcb.15614" class="external-link">doi:10.1111/gcb.15614</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Fit a spatiotemporal model</span></span></span>
<span class="r-in"><span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="make_mesh.html">make_mesh</a></span><span class="op">(</span><span class="va">pcod</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, n_knots <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="sdmTMB.html">sdmTMB</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">density</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod</span>, mesh <span class="op">=</span> <span class="va">mesh</span>, family <span class="op">=</span> <span class="fu"><a href="families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  time <span class="op">=</span> <span class="st">"year"</span>, spatiotemporal <span class="op">=</span> <span class="st">"iid"</span>, spatial <span class="op">=</span> <span class="st">"on"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create prediction grid</span></span></span>
<span class="r-in"><span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="replicate_df.html">replicate_df</a></span><span class="op">(</span><span class="va">qcs_grid</span>, <span class="st">"year"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get predictions with simulations</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, newdata <span class="op">=</span> <span class="va">nd</span>, nsim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate range edges along latitude (Y coordinate)</span></span></span>
<span class="r-in"><span><span class="va">edges</span> <span class="op">&lt;-</span> <span class="fu">get_range_edge</span><span class="op">(</span><span class="va">p</span>, axis <span class="op">=</span> <span class="va">nd</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">edges</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    year quantile      est     lwr     upr       se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  2003    0.025 5640.000 5636.00 5646.00 3.053840</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  2003    0.975 5834.000 5832.00 5836.00 1.249849</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  2004    0.025 5640.000 5636.00 5647.05 3.092228</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  2004    0.975 5832.000 5826.00 5836.00 2.714172</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  2005    0.025 5644.000 5638.00 5657.05 5.723988</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  2005    0.975 5834.000 5832.00 5836.00 1.462175</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  2007    0.025 5640.000 5636.00 5643.05 2.045542</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  2007    0.975 5834.000 5832.00 5836.00 1.328268</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  2009    0.025 5638.000 5636.00 5642.00 2.058832</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 2009    0.975 5832.000 5828.00 5836.00 2.378243</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 2011    0.025 5640.000 5636.00 5647.05 3.151000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 2011    0.975 5832.932 5830.00 5836.00 1.603341</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 2013    0.025 5640.000 5636.00 5654.00 4.218813</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14 2013    0.975 5834.000 5830.00 5836.00 1.575239</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15 2015    0.025 5640.000 5636.00 5651.05 4.092417</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16 2015    0.975 5832.000 5828.95 5836.00 1.873009</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17 2017    0.025 5641.000 5636.00 5652.10 4.652098</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18 2017    0.975 5834.000 5832.00 5836.00 1.311238</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot range edges over time</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">edges</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">est</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">quantile</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lwr</span>, ymax <span class="op">=</span> <span class="va">upr</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">quantile</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Latitude"</span>, colour <span class="op">=</span> <span class="st">"Quantile"</span>, fill <span class="op">=</span> <span class="st">"Quantile"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="get_range_edge-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get simulation draws for further analysis</span></span></span>
<span class="r-in"><span><span class="va">edges_sims</span> <span class="op">&lt;-</span> <span class="fu">get_range_edge</span><span class="op">(</span><span class="va">p</span>, axis <span class="op">=</span> <span class="va">nd</span><span class="op">$</span><span class="va">Y</span>, return_sims <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean C. Anderson, Eric J. Ward, Philina A. English, Lewis A. K. Barnett, James T. Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

