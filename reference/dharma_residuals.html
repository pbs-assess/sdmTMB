<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>DHARMa residuals — dharma_residuals • sdmTMB</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="DHARMa residuals — dharma_residuals"><meta name="description" content='Plot (and possibly return) DHARMa residuals. This is a wrapper function
around DHARMa::createDHARMa() to facilitate its use with sdmTMB() models.
Note: It is recommended to set type = "mle-mvn" in
simulate.sdmTMB() for the resulting residuals to have the
expected distribution. This is not the default.'><meta property="og:description" content='Plot (and possibly return) DHARMa residuals. This is a wrapper function
around DHARMa::createDHARMa() to facilitate its use with sdmTMB() models.
Note: It is recommended to set type = "mle-mvn" in
simulate.sdmTMB() for the resulting residuals to have the
expected distribution. This is not the default.'><meta property="og:image" content="https://sdmTMB.github.io/sdmTMB/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sdmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.4.9024</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sdmTMB/sdmTMB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>DHARMa residuals</h1>
      <small class="dont-index">Source: <a href="https://github.com/sdmTMB/sdmTMB/blob/main/R/dharma.R" class="external-link"><code>R/dharma.R</code></a></small>
      <div class="d-none name"><code>dharma_residuals.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Plot (and possibly return) <span class="pkg">DHARMa</span> residuals. This is a wrapper function
around <code><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html" class="external-link">DHARMa::createDHARMa()</a></code> to facilitate its use with <code><a href="sdmTMB.html">sdmTMB()</a></code> models.
<strong>Note:</strong> It is recommended to set <code>type = "mle-mvn"</code> in
<code><a href="simulate.sdmTMB.html">simulate.sdmTMB()</a></code> for the resulting residuals to have the
expected distribution. This is <em>not</em> the default.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dharma_residuals</span><span class="op">(</span></span>
<span>  <span class="va">simulated_response</span>,</span>
<span>  <span class="va">object</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  return_DHARMa <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  test_uniformity <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  test_outliers <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  test_dispersion <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-simulated-response">simulated_response<a class="anchor" aria-label="anchor" href="#arg-simulated-response"></a></dt>
<dd><p>Output from <code><a href="simulate.sdmTMB.html">simulate.sdmTMB()</a></code>. It is recommended
to set <code>type = "mle-mvn"</code> in the call to <code><a href="simulate.sdmTMB.html">simulate.sdmTMB()</a></code> for the
residuals to have the expected distribution.</p></dd>


<dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>Output from <code><a href="sdmTMB.html">sdmTMB()</a></code>.</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>Logical. Calls <code><a href="https://rdrr.io/pkg/DHARMa/man/plotQQunif.html" class="external-link">DHARMa::plotQQunif()</a></code>.</p></dd>


<dt id="arg-return-dharma">return_DHARMa<a class="anchor" aria-label="anchor" href="#arg-return-dharma"></a></dt>
<dd><p>Logical. Return object from <code><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html" class="external-link">DHARMa::createDHARMa()</a></code>?</p></dd>


<dt id="arg-test-uniformity">test_uniformity<a class="anchor" aria-label="anchor" href="#arg-test-uniformity"></a></dt>
<dd><p>Passed to <code>testUniformity</code> in <code><a href="https://rdrr.io/pkg/DHARMa/man/plotQQunif.html" class="external-link">DHARMa::plotQQunif()</a></code>.</p></dd>


<dt id="arg-test-outliers">test_outliers<a class="anchor" aria-label="anchor" href="#arg-test-outliers"></a></dt>
<dd><p>Passed to <code>testOutliers</code> in <code><a href="https://rdrr.io/pkg/DHARMa/man/plotQQunif.html" class="external-link">DHARMa::plotQQunif()</a></code>.</p></dd>


<dt id="arg-test-dispersion">test_dispersion<a class="anchor" aria-label="anchor" href="#arg-test-dispersion"></a></dt>
<dd><p>Passed to <code>testDispersion</code> in <code><a href="https://rdrr.io/pkg/DHARMa/man/plotQQunif.html" class="external-link">DHARMa::plotQQunif()</a></code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other arguments to pass to <code><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html" class="external-link">DHARMa::createDHARMa()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame of observed and expected values is invisibly returned
so you can assign the output to an object and
plot the residuals yourself. See the examples.</p>
<p>If <code>return_DHARMa = TRUE</code>, the object from <code><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html" class="external-link">DHARMa::createDHARMa()</a></code>
is returned and any subsequent <span class="pkg">DHARMa</span> functions can be applied.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>See the <a href="https://sdmTMB.github.io/sdmTMB/articles/residual-checking.html">residuals vignette</a>.</p>
<p>Advantages to these residuals over the ones from the <code><a href="residuals.sdmTMB.html">residuals.sdmTMB()</a></code>
method are (1) they work with delta/hurdle models for the combined
predictions, not the just the two parts separately, (2) they should work for
all families, not the just the families where we have worked out the
analytical quantile function, and (3) they can be used with the various
diagnostic tools and plots from the <span class="pkg">DHARMa</span> package.</p>
<p>Disadvantages are (1) they are slower to calculate since one must first
simulate from the model, (2) the stability of the distribution of the
residuals depends on having a sufficient number of simulation draws, (3)
uniformly distributed residuals put less emphasis on the tails visually
than normally distributed residuals
(which may or may not be desired).</p>
<p>Note that <span class="pkg">DHARMa</span> returns residuals that are uniform(0, 1) if the data
are consistent with the model whereas randomized quantile residuals from
<code><a href="residuals.sdmTMB.html">residuals.sdmTMB()</a></code> are expected to be normal(0, 1).</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="simulate.sdmTMB.html">simulate.sdmTMB()</a></code>, <code><a href="residuals.sdmTMB.html">residuals.sdmTMB()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Try Tweedie family:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="sdmTMB.html">sdmTMB</a></span><span class="op">(</span><span class="va">density</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">pcod_mesh_2011</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>, spatial <span class="op">=</span> <span class="st">"on"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The `simulated_response` argument is first so the output from</span></span></span>
<span class="r-in"><span><span class="co"># simulate() can be piped to `dharma_residuals()`.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We will work with 100 simulations for fast examples, but you'll</span></span></span>
<span class="r-in"><span><span class="co"># likely want to work with more than this (enough that the results</span></span></span>
<span class="r-in"><span><span class="co"># are stable from run to run).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># not great:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">fit</span>, nsim <span class="op">=</span> <span class="fl">100</span>, type <span class="op">=</span> <span class="st">"mle-mvn"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dharma_residuals</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="dharma_residuals-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># delta-lognormal looks better:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit_dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fit</span>, family <span class="op">=</span> <span class="fu"><a href="families.html">delta_lognormal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">fit_dl</span>, nsim <span class="op">=</span> <span class="fl">100</span>, type <span class="op">=</span> <span class="st">"mle-mvn"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dharma_residuals</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="dharma_residuals-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># or skip the pipe:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">fit_dl</span>, nsim <span class="op">=</span> <span class="fl">100</span>, type <span class="op">=</span> <span class="st">"mle-mvn"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># and manually plot it:</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">dharma_residuals</span><span class="op">(</span><span class="va">s</span>, <span class="va">fit_dl</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       observed    expected</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.0002512885 0.001030928</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.0003998549 0.002061856</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.0017916820 0.003092784</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 0.0030243763 0.004123711</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 0.0032777465 0.005154639</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 0.0060709249 0.006185567</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">expected</span>, <span class="va">r</span><span class="op">$</span><span class="va">observed</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="dharma_residuals-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># return the DHARMa object and work with the DHARMa methods</span></span></span>
<span class="r-in"><span><span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">fit_dl</span>, nsim <span class="op">=</span> <span class="fl">100</span>, type <span class="op">=</span> <span class="st">"mle-mvn"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dharma_residuals</span><span class="op">(</span><span class="va">fit</span>, return_DHARMa <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="dharma_residuals-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean C. Anderson, Eric J. Ward, Philina A. English, Lewis A. K. Barnett, James T. Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

