<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit a spatial or spatiotemporal GLMM with TMB — sdmTMB • sdmTMB</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a spatial or spatiotemporal GLMM with TMB — sdmTMB"><meta name="description" content="Fit a spatial or spatiotemporal generalized linear mixed effects model (GLMM)
with the TMB (Template Model Builder) R package. Spatial and spatiotemporal
random fields are approximated using the SPDE (stochastic partial differential
equation) approach, which allows for efficient modeling of data that are
correlated in space and/or time. See the model description vignette for
details."><meta property="og:description" content="Fit a spatial or spatiotemporal generalized linear mixed effects model (GLMM)
with the TMB (Template Model Builder) R package. Spatial and spatiotemporal
random fields are approximated using the SPDE (stochastic partial differential
equation) approach, which allows for efficient modeling of data that are
correlated in space and/or time. See the model description vignette for
details."><meta property="og:image" content="https://sdmTMB.github.io/sdmTMB/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sdmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.4.9024</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sdmTMB/sdmTMB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fit a spatial or spatiotemporal GLMM with TMB</h1>
      <small class="dont-index">Source: <a href="https://github.com/sdmTMB/sdmTMB/blob/main/R/fit.R" class="external-link"><code>R/fit.R</code></a></small>
      <div class="d-none name"><code>sdmTMB.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fit a spatial or spatiotemporal generalized linear mixed effects model (GLMM)
with the TMB (Template Model Builder) R package. Spatial and spatiotemporal
random fields are approximated using the SPDE (stochastic partial differential
equation) approach, which allows for efficient modeling of data that are
correlated in space and/or time. See the <a href="https://sdmTMB.github.io/sdmTMB/articles/model-description.html">model description vignette</a> for
details.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sdmTMB</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">mesh</span>,</span>
<span>  time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"on"</span>, <span class="st">"off"</span><span class="op">)</span>,</span>
<span>  spatiotemporal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iid"</span>, <span class="st">"ar1"</span>, <span class="st">"rw"</span>, <span class="st">"off"</span><span class="op">)</span>,</span>
<span>  share_range <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  time_varying <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  time_varying_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rw"</span>, <span class="st">"rw0"</span>, <span class="st">"ar1"</span><span class="op">)</span>,</span>
<span>  spatial_varying <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  offset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  extra_time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  reml <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  anisotropy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="sdmTMBcontrol.html">sdmTMBcontrol</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  priors <span class="op">=</span> <span class="fu"><a href="priors.html">sdmTMBpriors</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bayesian <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  previous_fit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  do_fit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  do_index <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  predict_args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  index_args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  experimental <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>Model formula. IID random intercepts and slopes are possible using
<span class="pkg">lme4</span> syntax, e.g., <code>+ (1 | g)</code> or <code>+ (0 + depth | g)</code> or <code>+ (1 + depth | g)</code> where <code>g</code> is a column of class
character or factor representing groups. Penalized splines are possible via
<span class="pkg">mgcv</span> with <code>s()</code>. Optionally a list for delta (hurdle) models.  See
examples and details below.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame.</p></dd>


<dt id="arg-mesh">mesh<a class="anchor" aria-label="anchor" href="#arg-mesh"></a></dt>
<dd><p>An object from <code><a href="make_mesh.html">make_mesh()</a></code>.</p></dd>


<dt id="arg-time">time<a class="anchor" aria-label="anchor" href="#arg-time"></a></dt>
<dd><p>An optional time column name (as character). Can be left as
<code>NULL</code> for a model with only spatial random fields; however, if the data
are actually spatiotemporal and you wish to use <code><a href="get_index.html">get_index()</a></code> or <code><a href="get_index.html">get_cog()</a></code>
downstream, supply the time argument.</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>The family and link. Supports <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian()</a></code>, <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">Gamma()</a></code>,
<code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code>, <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson()</a></code>, <code><a href="families.html">Beta()</a></code>,
<code><a href="families.html">betabinomial()</a></code>,
<code><a href="families.html">nbinom2()</a></code>,
<code><a href="families.html">truncated_nbinom2()</a></code>,
<code><a href="families.html">nbinom1()</a></code>,
<code><a href="families.html">truncated_nbinom1()</a></code>,
<code><a href="families.html">censored_poisson()</a></code>,
<code><a href="families.html">gamma_mix()</a></code>,
<code><a href="families.html">lognormal_mix()</a></code>,
<code><a href="families.html">student()</a></code>,
<code><a href="families.html">tweedie()</a></code>, and
<code><a href="families.html">gengamma()</a></code>.
Delta/hurdle models (for zero-inflated data) include:
<code><a href="families.html">delta_beta()</a></code>,
<code><a href="families.html">delta_gamma()</a></code>,
<code><a href="families.html">delta_gamma_mix()</a></code>,
<code><a href="families.html">delta_lognormal_mix()</a></code>,
<code><a href="families.html">delta_lognormal()</a></code>, and
<code><a href="families.html">delta_truncated_nbinom2()</a></code>.
See the <a href="https://sdmTMB.github.io/sdmTMB/articles/delta-models.html">delta-model vignette</a> for
details. For binomial family options, see 'Binomial families' in the Details
section below.</p></dd>


<dt id="arg-spatial">spatial<a class="anchor" aria-label="anchor" href="#arg-spatial"></a></dt>
<dd><p>Estimate spatial random fields? Options are <code>'on'</code> / <code>'off'</code>
or <code>TRUE</code> / <code>FALSE</code>. Optionally, a list for delta models, e.g. <code>list('on', 'off')</code>.</p></dd>


<dt id="arg-spatiotemporal">spatiotemporal<a class="anchor" aria-label="anchor" href="#arg-spatiotemporal"></a></dt>
<dd><p>Estimate the spatiotemporal random fields as <code>'iid'</code>
(independent and identically distributed; default), stationary <code>'ar1'</code>
(first-order autoregressive), a random walk (<code>'rw'</code>), or fixed at 0
<code>'off'</code>. Will be set to <code>'off'</code> if <code>time = NULL</code>. If a delta model, can be
a list. E.g., <code>list('off', 'ar1')</code>. Guidance: Use <code>'iid'</code> if temporal
correlation is negligible or already accounted for in fixed effects; <code>'ar1'</code>
if correlation between consecutive time steps decays gradually; <code>'rw'</code> if
changes between time steps are cumulative (each step builds on the last). If
the AR1 correlation coefficient (rho) is estimated close to 1 (say &gt; 0.99),
consider switching to <code>'rw'</code>. See the <a href="https://sdmTMB.github.io/sdmTMB/articles/model-description.html">model description vignette</a> for
mathematical details. Capitalization is ignored. <code>TRUE</code> gets converted to
<code>'iid'</code> and <code>FALSE</code> gets converted to <code>'off'</code>.</p></dd>


<dt id="arg-share-range">share_range<a class="anchor" aria-label="anchor" href="#arg-share-range"></a></dt>
<dd><p>Logical: estimate a shared spatial and spatiotemporal
range parameter (<code>TRUE</code>, default) or independent range parameters
(<code>FALSE</code>). If a delta model, can be a list. E.g., <code>list(TRUE, FALSE)</code>.</p></dd>


<dt id="arg-time-varying">time_varying<a class="anchor" aria-label="anchor" href="#arg-time-varying"></a></dt>
<dd><p>An optional one-sided formula describing covariates
that should be modelled as a time-varying process. Set the type of
process with <code>time_varying_type</code>. See the help for <code>time_varying_type</code>
for warnings about modelling the first time step. Structure shared in
delta models.</p></dd>


<dt id="arg-time-varying-type">time_varying_type<a class="anchor" aria-label="anchor" href="#arg-time-varying-type"></a></dt>
<dd><p>Type of time-varying process to apply to
<code>time_varying</code> formula. Options: <code>'rw'</code> (random walk, default), <code>'rw0'</code>
(random walk with mean-zero prior on first time step), or <code>'ar1'</code>
(autoregressive, for coefficients that fluctuate around a mean). For <code>'rw0'</code>
and <code>'ar1'</code>, the coefficient starts at zero in the first time step. For
<code>'rw'</code> (default), the first time step is estimated separately—in this case,
avoid including the same covariates in both <code>formula</code> and <code>time_varying</code> to
prevent non-identifiability (use <code>~ 0</code> or <code>~ -1</code> in at least one). Structure
shared in delta models.</p></dd>


<dt id="arg-spatial-varying">spatial_varying<a class="anchor" aria-label="anchor" href="#arg-spatial-varying"></a></dt>
<dd><p>An optional one-sided formula of coefficients that
should vary in space as random fields. Allows the effect of a covariate to
differ spatially. You likely want to include the same variable as a fixed
effect in <code>formula</code> to estimate the average effect—the spatial field then
represents deviations from that average (since it has mean zero). For example,
use <code>formula = y ~ depth</code> and <code>spatial_varying = ~ 0 + depth</code> to model an
average depth effect plus spatially varying deviations. If a (scaled) time
column is used, this creates a local-time-trend model. See
<a href="https://doi.org/10.1111/ecog.05176" class="external-link">doi:10.1111/ecog.05176</a>
 and the <a href="https://sdmTMB.github.io/sdmTMB/articles/spatial-trend-models.html">spatial trends vignette</a>.
Predictors should usually be centered to have mean zero and standard deviation
approximately 1. <strong>The spatial intercept is controlled by the <code>spatial</code>
argument</strong>; set <code>spatial = 'on'</code> or <code>'off'</code> to include or exclude it. For
factor predictors, if <code>spatial_varying</code> excludes the intercept (<code>~ 0</code> or <code>~ -1</code>), set <code>spatial = 'off'</code> to match. Structure must be shared in delta
models.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>A numeric vector representing optional likelihood weights for
the conditional model. Implemented as in <span class="pkg">glmmTMB</span>: weights do not have
to sum to one and are not internally modified. Can also be used for trials
with the binomial family; the <code>weights</code> argument needs to be a vector and not
a name of the variable in the data frame. See the Details section below.</p></dd>


<dt id="arg-offset">offset<a class="anchor" aria-label="anchor" href="#arg-offset"></a></dt>
<dd><p>A numeric vector representing the model offset <em>or</em> a character
value representing the column name of the offset. In delta/hurdle models,
this applies only to the positive component. Usually a log transformed
variable.</p></dd>


<dt id="arg-extra-time">extra_time<a class="anchor" aria-label="anchor" href="#arg-extra-time"></a></dt>
<dd><p>Optional extra time slices (e.g., years) to include for
interpolation or forecasting with the predict function. See the Details
section below.</p></dd>


<dt id="arg-reml">reml<a class="anchor" aria-label="anchor" href="#arg-reml"></a></dt>
<dd><p>Logical: use REML (restricted maximum likelihood) estimation
rather than maximum likelihood? REML accounts for uncertainty in estimating
fixed effects and can reduce bias in variance parameter estimates, but
prevents likelihood-based model comparison (e.g., AIC) between models with
different fixed effects. Use <code>TRUE</code> if your focus is on random effect
variance parameters; use <code>FALSE</code> (default) if comparing models with different
fixed effects or performing index standardization.</p></dd>


<dt id="arg-silent">silent<a class="anchor" aria-label="anchor" href="#arg-silent"></a></dt>
<dd><p>Silent or include optimization details? Helpful to set to
<code>FALSE</code> for models that take a while to fit.</p></dd>


<dt id="arg-anisotropy">anisotropy<a class="anchor" aria-label="anchor" href="#arg-anisotropy"></a></dt>
<dd><p>Logical: allow for anisotropy (spatial correlation that is
directionally dependent)? See <code><a href="plot_anisotropy.html">plot_anisotropy()</a></code>.
Must be shared across delta models.</p></dd>


<dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>Optimization control options via <code><a href="sdmTMBcontrol.html">sdmTMBcontrol()</a></code>.</p></dd>


<dt id="arg-priors">priors<a class="anchor" aria-label="anchor" href="#arg-priors"></a></dt>
<dd><p>Optional penalties/priors via <code><a href="priors.html">sdmTMBpriors()</a></code>. Must currently
be shared across delta models.</p></dd>


<dt id="arg-knots">knots<a class="anchor" aria-label="anchor" href="#arg-knots"></a></dt>
<dd><p>Optional named list containing knot values to be used for basis
construction of smoothing terms. See <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">mgcv::gam()</a></code> and <code><a href="https://rdrr.io/pkg/mgcv/man/gamm.html" class="external-link">mgcv::gamm()</a></code>.
E.g., <code>s(x, bs = 'cc', k = 4), knots = list(x = c(1, 2, 3, 4))</code></p></dd>


<dt id="arg-bayesian">bayesian<a class="anchor" aria-label="anchor" href="#arg-bayesian"></a></dt>
<dd><p>Logical indicating if the model will be passed to
<span class="pkg">tmbstan</span>. If <code>TRUE</code>, Jacobian adjustments are applied to account for
parameter transformations when priors are applied.</p></dd>


<dt id="arg-previous-fit">previous_fit<a class="anchor" aria-label="anchor" href="#arg-previous-fit"></a></dt>
<dd><p>A previously fitted sdmTMB model to initialize the
optimization with. Can greatly speed up fitting. Note that the model must
be set up <em>exactly</em> the same way. However, the data and <code>weights</code> arguments
can change, which can be useful for cross-validation.</p></dd>


<dt id="arg-do-fit">do_fit<a class="anchor" aria-label="anchor" href="#arg-do-fit"></a></dt>
<dd><p>Fit the model (<code>TRUE</code>) or return the processed data without
fitting (<code>FALSE</code>)?</p></dd>


<dt id="arg-do-index">do_index<a class="anchor" aria-label="anchor" href="#arg-do-index"></a></dt>
<dd><p>Do index standardization calculations while fitting? Saves
memory and time when working with large datasets or projection grids since
the TMB object doesn't have to be rebuilt with <code><a href="predict.sdmTMB.html">predict.sdmTMB()</a></code> and
<code><a href="get_index.html">get_index()</a></code>. If <code>TRUE</code>, then <code>predict_args</code> must have a <code>newdata</code> element
supplied and <code>area</code> can be supplied to <code>index_args</code>.
Most users can ignore this option. The fitted object can be passed directly
to <code><a href="get_index.html">get_index()</a></code>.</p></dd>


<dt id="arg-predict-args">predict_args<a class="anchor" aria-label="anchor" href="#arg-predict-args"></a></dt>
<dd><p>A list of arguments to pass to <code><a href="predict.sdmTMB.html">predict.sdmTMB()</a></code> <strong>if</strong>
<code>do_index = TRUE</code>. Most users can ignore this option.</p></dd>


<dt id="arg-index-args">index_args<a class="anchor" aria-label="anchor" href="#arg-index-args"></a></dt>
<dd><p>A list of arguments to pass to <code><a href="get_index.html">get_index()</a></code> <strong>if</strong>
<code>do_index = TRUE</code>. Currently, only <code>area</code> is supported. Bias correction
can be done when calling <code><a href="get_index.html">get_index()</a></code> on the resulting fitted object.
Most users can ignore this option.</p></dd>


<dt id="arg-experimental">experimental<a class="anchor" aria-label="anchor" href="#arg-experimental"></a></dt>
<dd><p>A named list for esoteric or in-development options. Here
be dragons.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object (list) of class <code>sdmTMB</code>. Useful elements include:</p><ul><li><p><code>sd_report</code>: output from <code><a href="https://rdrr.io/pkg/TMB/man/sdreport.html" class="external-link">TMB::sdreport()</a></code></p></li>
<li><p><code>gradients</code>: marginal log likelihood gradients with respect to each fixed effect</p></li>
<li><p><code>model</code>: output from <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code></p></li>
<li><p><code>data</code>: the fitted data</p></li>
<li><p><code>spde</code>: the object that was supplied to the <code>mesh</code> argument</p></li>
<li><p><code>family</code>: the family object, which includes the inverse link function as <code>family$linkinv()</code></p></li>
<li><p><code>tmb_params</code>: The parameters list passed to <code><a href="https://rdrr.io/pkg/TMB/man/MakeADFun.html" class="external-link">TMB::MakeADFun()</a></code></p></li>
<li><p><code>tmb_map</code>: The 'map' list passed to <code><a href="https://rdrr.io/pkg/TMB/man/MakeADFun.html" class="external-link">TMB::MakeADFun()</a></code></p></li>
<li><p><code>tmb_data</code>: The data list passed to <code><a href="https://rdrr.io/pkg/TMB/man/MakeADFun.html" class="external-link">TMB::MakeADFun()</a></code></p></li>
<li><p><code>tmb_obj</code>: The TMB object created by <code><a href="https://rdrr.io/pkg/TMB/man/MakeADFun.html" class="external-link">TMB::MakeADFun()</a></code></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Model description</strong></p>
<p>sdmTMB fits GLMMs with spatial and/or spatiotemporal random fields, which
account for correlation in the data due to spatial proximity, or alternatively,
latent spatial and spatiotemporal effects. Spatial fields represent
consistent spatial patterns, while
spatiotemporal fields represent spatial patterns that vary over time. See the <a href="https://sdmTMB.github.io/sdmTMB/articles/model-description.html">model description</a>
vignette for mathematical details and the paper: <a href="https://doi.org/10.1101/2022.03.24.485545" class="external-link">doi:10.1101/2022.03.24.485545</a></p>
<p><strong>Binomial families</strong></p>
<p>Following the structure of <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code> and <span class="pkg">glmmTMB</span>, a binomial
family can be specified in one of 4 ways: (1) the response may be a factor
(and the model classifies the first level versus all others), (2) the
response may be binomial (0/1), (3) the response can be a matrix of form
<code>cbind(success, failure)</code>, and (4) the response may be the observed
proportions, and the 'weights' argument is used to specify the Binomial size
(N) parameter (<code>prob ~ ..., weights = N</code>).</p>
<p><strong>Smooth terms</strong></p>
<p>Smooth terms can be included following GAMs (generalized additive models)
using <code>+ s(x)</code>, which implements a smooth from <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">mgcv::s()</a></code>. <span class="pkg">sdmTMB</span> uses
penalized smooths, constructed via <code><a href="https://rdrr.io/pkg/mgcv/man/smooth2random.html" class="external-link">mgcv::smooth2random()</a></code>. This is a similar
approach implemented in <span class="pkg">gamm4</span> and <span class="pkg">brms</span>, among other packages.
Within these smooths, the same syntax commonly used in <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">mgcv::s()</a></code> or
<code><a href="https://rdrr.io/pkg/mgcv/man/t2.html" class="external-link">mgcv::t2()</a></code> can be applied, e.g. 2-dimensional smooths may be constructed
with <code>+ s(x, y)</code> or <code>+ t2(x, y)</code>; smooths can be specific to various factor
levels, <code>+ s(x, by = group)</code>; the basis function dimensions may be specified,
e.g. <code>+ s(x, k = 4)</code>; and various types of splines may be constructed such as
cyclic splines to model seasonality (perhaps with the <code>knots</code> argument also
be supplied).</p>
<p><strong>Threshold models</strong></p>
<p>A linear break-point relationship for a covariate can be included via
<code>+ breakpt(variable)</code> in the formula, where <code>variable</code> is a single covariate
corresponding to a column in <code>data</code>. In this case, the relationship is linear
up to a point and then constant (hockey-stick shaped).</p>
<p>Similarly, a logistic-function threshold model can be included via
<code>+ logistic(variable)</code>. This option models the relationship as a logistic
function of the 50% and 95% values. This is similar to length- or size-based
selectivity in fisheries, and is parameterized by the points at which f(x) =
0.5 or 0.95. See the
<a href="https://sdmTMB.github.io/sdmTMB/articles/threshold-models.html">threshold vignette</a>.</p>
<p>Note that only a single threshold covariate can be included and the same covariate
is included in both components for the delta families.</p>
<p><strong>Extra time: forecasting or interpolating</strong></p>
<p>Extra time slices (e.g., years) can be included for interpolation or
forecasting with the predict function via the <code>extra_time</code> argument. The
predict function requires all time slices to be defined when fitting the
model to ensure the various time indices are set up correctly. Be careful if
including extra time slices that the model remains identifiable. For example,
including <code>+ as.factor(year)</code> in <code>formula</code> will render a model with no data
to inform the expected value in a missing year. <code>sdmTMB()</code> makes no attempt
to determine if the model makes sense for forecasting or interpolation. The
options <code>time_varying</code>, <code>spatiotemporal = "rw"</code>, <code>spatiotemporal = "ar1"</code>,
or a smoother on the time column provide mechanisms to predict over missing
time slices with process error.</p>
<p><code>extra_time</code> can also be used to fill in missing time steps for the purposes
of a random walk or AR(1) process if the gaps between time steps are uneven.</p>
<p><code>extra_time</code> can include only extra time steps or all time steps including
those found in the fitted data. This latter option may be simpler.</p>
<p><strong>Regularization and priors</strong></p>
<p>You can achieve regularization via penalties (priors) on the fixed effect
parameters. See <code><a href="priors.html">sdmTMBpriors()</a></code>. You can fit the model once without
penalties and look at the output of <code>print(your_model)</code> or <code>tidy(your_model)</code>
or fit the model with <code>do_fit = FALSE</code> and inspect
<code>head(your_model$tmb_data$X_ij[[1]])</code> if you want to see how the formula is
translated to the fixed effect model matrix. Also see the
<a href="https://sdmTMB.github.io/sdmTMB/articles/bayesian.html">Bayesian vignette</a>.</p>
<p><strong>Delta/hurdle models</strong></p>
<p>Delta models (also known as hurdle models) can be fit as two separate models
or at the same time by using an appropriate delta family. E.g.:
<code><a href="families.html">delta_gamma()</a></code>,
<code><a href="families.html">delta_beta()</a></code>,
<code><a href="families.html">delta_lognormal()</a></code>, and
<code><a href="families.html">delta_truncated_nbinom2()</a></code>.
If fit with a delta family, by default the formula, spatial, and spatiotemporal
components are shared. Some elements can be specified independently for the two models
using a list format. These include <code>formula</code>, <code>spatial</code>, <code>spatiotemporal</code>,
and <code>share_range</code>. The first element of the list is for the binomial component
and the second element is for the positive component (e.g., Gamma).
Other elements must be shared for now (e.g., spatially varying coefficients,
time-varying coefficients). Furthermore, there are currently limitations if
specifying two formulas as a list: the two formulas cannot have smoothers or
threshold effects. For now, these must be specified
through a single formula that is shared across the two models.</p>
<p>The main advantage of specifying such models using a delta family (compared
to fitting two separate models) is (1) coding simplicity and (2) calculation
of uncertainty on derived quantities such as an index of abundance with
<code><a href="get_index.html">get_index()</a></code> using the generalized delta method within TMB. Also, selected
parameters can be shared across the models.</p>
<p>See the <a href="https://sdmTMB.github.io/sdmTMB/articles/delta-models.html">delta-model vignette</a>.</p>
<p><strong>Index standardization</strong></p>
<p>For index standardization, you may wish to include <code>0 + as.factor(year)</code>
(or whatever the time column is called) in the formula. See a basic
example of index standardization in the relevant
<a href="https://sdmTMB.github.io/sdmTMB/articles/index-standardization.html">package vignette</a>.
You will need to specify the <code>time</code> argument. See <code><a href="get_index.html">get_index()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p><strong>Main reference introducing the package to cite when using sdmTMB:</strong></p>
<p>Anderson, S.C., E.J. Ward, P.A. English, L.A.K. Barnett. 2022. sdmTMB: an R
package for fast, flexible, and user-friendly generalized linear mixed effects
models with spatial and spatiotemporal random fields.
bioRxiv 2022.03.24.485545; <a href="https://doi.org/10.1101/2022.03.24.485545" class="external-link">doi:10.1101/2022.03.24.485545</a>
.</p>
<p><em>Reference for local trends:</em></p>
<p>Barnett, L.A.K., E.J. Ward, S.C. Anderson. 2021. Improving estimates of species
distribution change by incorporating local trends. Ecography. 44(3):427-439.
<a href="https://doi.org/10.1111/ecog.05176" class="external-link">doi:10.1111/ecog.05176</a>
.</p>
<p><em>Further explanation of the model and application to calculating climate
velocities:</em></p>
<p>English, P., E.J. Ward, C.N. Rooper, R.E. Forrest, L.A. Rogers, K.L. Hunter,
A.M. Edwards, B.M. Connors, S.C. Anderson. 2021. Contrasting climate velocity
impacts in warm and cool locations show that effects of marine warming are
worse in already warmer temperate waters. Fish and Fisheries. 23(1) 239-255.
<a href="https://doi.org/10.1111/faf.12613" class="external-link">doi:10.1111/faf.12613</a>
.</p>
<p><em>Discussion of and illustration of some decision points when fitting these
models:</em></p>
<p>Commander, C.J.C., L.A.K. Barnett, E.J. Ward, S.C. Anderson, T.E.
Essington. 2022. The shadow model: how and why small choices in
spatially explicit species distribution models affect predictions. PeerJ 10:
e12783. <a href="https://doi.org/10.7717/peerj.12783" class="external-link">doi:10.7717/peerj.12783</a>
.</p>
<p><em>Application and description of threshold/break-point models:</em></p>
<p>Essington, T.E., S.C. Anderson, L.A.K. Barnett, H.M. Berger, S.A. Siedlecki,
E.J. Ward. 2022. Advancing statistical models to reveal the effect of
dissolved oxygen on the spatial distribution of marine taxa using thresholds
and a physiologically based index. Ecography. 2022: e06249
<a href="https://doi.org/10.1111/ecog.06249" class="external-link">doi:10.1111/ecog.06249</a>
.</p>
<p><em>Application to fish body condition:</em></p>
<p>Lindmark, M., S.C. Anderson, M. Gogina, M. Casini. Evaluating drivers of
spatiotemporal individual condition of a bottom-associated marine fish.
bioRxiv 2022.04.19.488709. <a href="https://doi.org/10.1101/2022.04.19.488709" class="external-link">doi:10.1101/2022.04.19.488709</a>
.</p>
<p><em>Several sections of the original TMB model code were adapted from the
VAST R package:</em></p>
<p>Thorson, J.T. 2019. Guidance for decisions using the Vector Autoregressive
Spatio-Temporal (VAST) package in stock, ecosystem, habitat and climate
assessments. Fish. Res. 210:143–161.
<a href="https://doi.org/10.1016/j.fishres.2018.10.013" class="external-link">doi:10.1016/j.fishres.2018.10.013</a>
.</p>
<p><em>Code for the <code>family</code> R-to-TMB implementation, selected parameterizations of
the observation likelihoods, general package structure inspiration, and the
idea behind the TMB prediction approach were adapted from the glmmTMB R
package:</em></p>
<p>Brooks, M.E., K. Kristensen, K.J. van Benthem, A. Magnusson,
C.W. Berg, A. Nielsen, H.J. Skaug, M. Maechler, B.M. Bolker.
2017. glmmTMB Balances Speed and Flexibility Among Packages for
Zero-inflated Generalized Linear Mixed Modeling. The R Journal, 9(2):378-400.
<a href="https://doi.org/10.32614/rj-2017-066" class="external-link">doi:10.32614/rj-2017-066</a>
.</p>
<p><em>Implementation of geometric anisotropy with the SPDE and use of random
field GLMMs for index standardization</em>:</p>
<p>Thorson, J.T., A.O. Shelton, E.J. Ward, H.J. Skaug. 2015.
Geostatistical delta-generalized linear mixed models improve precision for
estimated abundance indices for West Coast groundfishes. ICES J. Mar. Sci.
72(5): 1297–1310. <a href="https://doi.org/10.1093/icesjms/fsu243" class="external-link">doi:10.1093/icesjms/fsu243</a>
.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sdmTMB.github.io/sdmTMB/">sdmTMB</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Build a mesh to implement the SPDE approach:</span></span></span>
<span class="r-in"><span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="make_mesh.html">make_mesh</a></span><span class="op">(</span><span class="va">pcod_2011</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, cutoff <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># - this example uses a fairly coarse mesh so these examples run quickly</span></span></span>
<span class="r-in"><span><span class="co"># - 'cutoff' is the minimum distance between mesh vertices in units of the</span></span></span>
<span class="r-in"><span><span class="co">#   x and y coordinates</span></span></span>
<span class="r-in"><span><span class="co"># - 'cutoff = 10' might make more sense in applied situations for this dataset</span></span></span>
<span class="r-in"><span><span class="co"># - or build any mesh in 'fmesher' and pass it to the 'mesh' argument in make_mesh()`</span></span></span>
<span class="r-in"><span><span class="co"># - the mesh is not needed if you will be turning off all</span></span></span>
<span class="r-in"><span><span class="co">#   spatial/spatiotemporal random fields</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Quick mesh plot:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="sdmTMB-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit a Tweedie spatial random field GLMM with a smoother for depth:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">density</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: density ~ s(depth)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: tweedie(link = 'log')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)     2.16    0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sdepth          1.94    3.13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Smooth terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Std. Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sd__s(depth)     13.07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter: 13.68</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Tweedie p: 1.58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matérn range: 16.84</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial SD: 2.20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 2937.789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract coefficients:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">fit</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   term        estimate std.error conf.low conf.high</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> (Intercept)     2.16     0.340     1.50      2.83</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> sdepth          1.94     3.13     -<span style="color: #BB0000;">4.19</span>      8.07</span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">fit</span>, effects <span class="op">=</span> <span class="st">"ran_par"</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   term         estimate std.error conf.low conf.high</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> range           16.8    13.7       3.40      83.3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> phi             13.7     0.663    12.4       15.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> sigma_O          2.20    1.23      0.735      6.59</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> tweedie_p        1.58    0.015<span style="text-decoration: underline;">3</span>    1.55       1.61</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> sd__s(depth)    13.1    <span style="color: #BB0000;">NA</span>         6.07      28.2 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Perform several 'sanity' checks:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="sanity.html">sanity</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Non-linear minimizer suggests successful convergence</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Hessian matrix is positive definite</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> No extreme or very small eigenvalues detected</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> No gradients with respect to fixed effects are &gt;= 0.001</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> No fixed-effect standard errors are NA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> No standard errors look unreasonably large</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> No sigma parameters are &lt; 0.01</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> No sigma parameters are &gt; 100</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Range parameter doesn't look unreasonably large</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Predict on the fitted data; see ?predict.sdmTMB</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Predict on new data:</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">qcs_grid</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     X    Y    depth depth_scaled depth_scaled2       est est_non_rf      est_rf</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 456 5636 347.0834    1.5608122    2.43613479 -4.726631  -4.567379 -0.15925224</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 458 5636 223.3348    0.5697699    0.32463771  2.342471   2.368314 -0.02584342</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 460 5636 203.7408    0.3633693    0.13203724  3.087513   2.979948  0.10756540</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 462 5636 183.2987    0.1257046    0.01580166  3.878560   3.637586  0.24097423</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 464 5636 182.9998    0.1220368    0.01489297  4.020914   3.646531  0.37438305</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 466 5636 186.3892    0.1632882    0.02666303  4.050895   3.543104  0.50779187</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       omega_s</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -0.15925224</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 -0.02584342</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  0.10756540</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  0.24097423</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  0.37438305</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  0.50779187</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Visualize the depth effect with ggeffects:</span></span></span>
<span class="r-in"><span><span class="fu">ggeffects</span><span class="fu">::</span><span class="fu"><a href="https://strengejacke.github.io/ggeffects/reference/ggpredict.html" class="external-link">ggpredict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"depth [all]"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="sdmTMB-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Visualize depth effect with visreg: (see ?visreg_delta)</span></span></span>
<span class="r-in"><span><span class="fu">visreg</span><span class="fu">::</span><span class="fu"><a href="https://pbreheny.github.io/visreg/reference/visreg.html" class="external-link">visreg</a></span><span class="op">(</span><span class="va">fit</span>, xvar <span class="op">=</span> <span class="st">"depth"</span><span class="op">)</span> <span class="co"># link space; randomized quantile residuals</span></span></span>
<span class="r-plt img"><img src="sdmTMB-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">visreg</span><span class="fu">::</span><span class="fu"><a href="https://pbreheny.github.io/visreg/reference/visreg.html" class="external-link">visreg</a></span><span class="op">(</span><span class="va">fit</span>, xvar <span class="op">=</span> <span class="st">"depth"</span>, scale <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="sdmTMB-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">visreg</span><span class="fu">::</span><span class="fu"><a href="https://pbreheny.github.io/visreg/reference/visreg.html" class="external-link">visreg</a></span><span class="op">(</span><span class="va">fit</span>, xvar <span class="op">=</span> <span class="st">"depth"</span>, scale <span class="op">=</span> <span class="st">"response"</span>, gg <span class="op">=</span> <span class="cn">TRUE</span>, rug <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>`aes_string()` was deprecated in ggplot2 3.0.0.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Please use tidy evaluation idioms with `aes()`.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> See also `vignette("ggplot2-in-packages")` for more information.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">visreg</span> package.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>   Please report the issue at <span style="color: #0000BB; font-style: italic;">&lt;https://github.com/pbreheny/visreg/issues&gt;</span>.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">ggplot2</span> package.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>   Please report the issue at <span style="color: #0000BB; font-style: italic;">&lt;https://github.com/tidyverse/ggplot2/issues&gt;</span>.</span>
<span class="r-plt img"><img src="sdmTMB-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add spatiotemporal random fields:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">density</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  time <span class="op">=</span> <span class="st">"year"</span>, <span class="co">#&lt;</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatiotemporal model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: density ~ 0 + as.factor(year)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time column: year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: tweedie(link = 'log')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> as.factor(year)2011     2.76    0.36</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> as.factor(year)2013     3.10    0.35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> as.factor(year)2015     3.21    0.35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> as.factor(year)2017     2.47    0.36</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter: 14.83</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Tweedie p: 1.57</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matérn range: 13.31</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial SD: 3.16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatiotemporal IID SD: 1.79</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 3007.552</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Make the fields AR1:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">density</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  time <span class="op">=</span> <span class="st">"year"</span>,</span></span>
<span class="r-in"><span>  spatial <span class="op">=</span> <span class="st">"off"</span>,</span></span>
<span class="r-in"><span>  spatiotemporal <span class="op">=</span> <span class="st">"ar1"</span>, <span class="co">#&lt;</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatiotemporal model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: density ~ s(depth)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time column: year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: tweedie(link = 'log')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)     1.84    0.33</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sdepth          1.96    3.27</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Smooth terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Std. Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sd__s(depth)      13.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter: 12.84</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Tweedie p: 1.55</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatiotemporal AR1 correlation (rho): 0.67</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matérn range: 12.22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatiotemporal marginal AR1 SD: 3.28</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 2914.393</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Make the fields a random walk:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">density</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  time <span class="op">=</span> <span class="st">"year"</span>,</span></span>
<span class="r-in"><span>  spatial <span class="op">=</span> <span class="st">"off"</span>,</span></span>
<span class="r-in"><span>  spatiotemporal <span class="op">=</span> <span class="st">"rw"</span>, <span class="co">#&lt;</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatiotemporal model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: density ~ s(depth)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time column: year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: tweedie(link = 'log')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)     1.95    0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sdepth          1.96    3.18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Smooth terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Std. Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sd__s(depth)     13.22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter: 12.84</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Tweedie p: 1.56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matérn range: 14.66</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatiotemporal RW SD: 2.17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 2919.181</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Depth smoothers by year:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">density</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>, <span class="co">#&lt;</span></span></span>
<span class="r-in"><span>  time <span class="op">=</span> <span class="st">"year"</span>,</span></span>
<span class="r-in"><span>  spatial <span class="op">=</span> <span class="st">"off"</span>,</span></span>
<span class="r-in"><span>  spatiotemporal <span class="op">=</span> <span class="st">"rw"</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatiotemporal model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: density ~ s(depth, by = as.factor(year))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time column: year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: tweedie(link = 'log')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                             coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)                     1.76    0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sdepth):as.factor(year)2011     0.07    4.02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sdepth):as.factor(year)2013     4.59    3.28</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sdepth):as.factor(year)2015     5.97    6.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sdepth):as.factor(year)2017    -1.97    3.22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Smooth terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                  Std. Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sd__s(depth):as.factor(year)2011     16.62</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sd__s(depth):as.factor(year)2013     13.57</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sd__s(depth):as.factor(year)2015     28.24</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sd__s(depth):as.factor(year)2017     18.65</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter: 12.70</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Tweedie p: 1.55</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matérn range: 8.62</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatiotemporal RW SD: 3.14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 2924.193</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 2D depth-year smoother:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">density</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth</span>, <span class="va">year</span><span class="op">)</span>, <span class="co">#&lt;</span></span></span>
<span class="r-in"><span>  spatial <span class="op">=</span> <span class="st">"off"</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: density ~ s(depth, year)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: tweedie(link = 'log')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)      2.55    0.24</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sdepthyear_1     0.15    0.09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sdepthyear_2     2.93    2.07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Smooth terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Std. Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sd__s(depth,year)      6.08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter: 14.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Tweedie p: 1.60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 2974.143</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Turn off spatial random fields:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">present</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">depth</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  spatial <span class="op">=</span> <span class="st">"off"</span>, <span class="co">#&lt;</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: present ~ poly(log(depth))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: binomial(link = 'logit')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)         -0.16    0.07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> poly(log(depth))   -13.19    2.14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 648.334</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Which, matches glm():</span></span></span>
<span class="r-in"><span><span class="va">fit_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">present</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">depth</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_glm</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> glm(formula = present ~ poly(log(depth)), family = binomial(), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     data = pcod_2011)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)       -0.16433    0.06583  -2.496   0.0126 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> poly(log(depth)) -13.18981    2.14179  -6.158 7.35e-10 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for binomial family taken to be 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Null deviance: 1337.2  on 968  degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual deviance: 1296.7  on 967  degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 1300.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">fit_glm</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         df      AIC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fit      2 1300.668</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fit_glm  2 1300.668</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Delta/hurdle binomial-Gamma model:</span></span></span>
<span class="r-in"><span><span class="va">fit_dg</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">density</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">depth</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  spatial <span class="op">=</span> <span class="st">"off"</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">delta_gamma</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#&lt;</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit_dg</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: density ~ poly(log(depth), 2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: delta_gamma(link1 = 'logit', link2 = 'log')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Delta/hurdle model 1: -----------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: binomial(link = 'logit') </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)             -0.48    0.09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> poly(log(depth), 2)1   -23.06    3.15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> poly(log(depth), 2)2   -48.79    4.45</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Delta/hurdle model 2: -----------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: Gamma(link = 'log') </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)              4.24    0.08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> poly(log(depth), 2)1    -5.49    3.50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> poly(log(depth), 2)2   -13.26    3.23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter: 0.64</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 2936.579</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Delta model with different formulas and spatial structure:</span></span></span>
<span class="r-in"><span><span class="va">fit_dg</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">density</span> <span class="op">~</span> <span class="va">depth_scaled</span>, <span class="va">density</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">depth_scaled</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="co">#&lt;</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"off"</span>, <span class="st">"on"</span><span class="op">)</span>, <span class="co">#&lt;</span></span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">delta_gamma</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit_dg</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: list(density ~ depth_scaled, density ~ poly(depth_scaled, 2))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: delta_gamma(link1 = 'logit', link2 = 'log')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Delta/hurdle model 1: -----------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: binomial(link = 'logit') </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)     -0.17    0.07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> depth_scaled    -0.43    0.07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Delta/hurdle model 2: -----------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: Gamma(link = 'log') </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                        coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)                4.08    0.14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> poly(depth_scaled, 2)1    -6.15    4.52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> poly(depth_scaled, 2)2   -12.58    4.14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter: 0.72</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matérn range: 0.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial SD: 2148.87</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 3034.512</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **Possible issues detected! Check output of sanity().**</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Delta/hurdle truncated NB2:</span></span></span>
<span class="r-in"><span><span class="va">pcod_2011</span><span class="op">$</span><span class="va">count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pcod_2011</span><span class="op">$</span><span class="va">density</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit_nb2</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">count</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  spatial <span class="op">=</span> <span class="st">"off"</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">delta_truncated_nbinom2</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#&lt;</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit_nb2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: count ~ s(depth)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: delta_truncated_nbinom2(link1 = 'logit', link2 = 'log')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Delta/hurdle model 1: -----------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: binomial(link = 'logit') </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)    -0.69    0.21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sdepth          0.29    2.37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Smooth terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Std. Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sd__s(depth)       9.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Delta/hurdle model 2: -----------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: truncated_nbinom2(link = 'log') </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)     4.18    0.22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sdepth         -0.37    1.77</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Smooth terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Std. Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sd__s(depth)      6.73</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter: 0.49</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 2915.733</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Regular NB2:</span></span></span>
<span class="r-in"><span><span class="va">fit_nb2</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">count</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  spatial <span class="op">=</span> <span class="st">"off"</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">nbinom2</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#&lt;</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit_nb2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: count ~ s(depth)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: nbinom2(link = 'log')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)     2.49    0.27</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sdepth          3.61    3.96</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Smooth terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Std. Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sd__s(depth)      16.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter: 0.14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 3006.939</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># IID random intercepts by year:</span></span></span>
<span class="r-in"><span><span class="va">pcod_2011</span><span class="op">$</span><span class="va">fyear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">pcod_2011</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">density</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">fyear</span><span class="op">)</span>, <span class="co">#&lt;</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: density ~ s(depth) + (1 | fyear)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: tweedie(link = 'log')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random intercepts and/or slopes:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Groups        Name    Variance    Std.Dev. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       fyear (Intercept)        0.09        0.30 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)     2.13    0.37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sdepth          1.82    2.99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Smooth terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Std. Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sd__s(depth)     12.51</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter: 13.55</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Tweedie p: 1.58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matérn range: 16.66</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial SD: 2.21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 2933.138</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># IID random slopes and intercepts (implicit) by year:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">density</span> <span class="op">~</span> <span class="op">(</span><span class="va">depth</span> <span class="op">|</span> <span class="va">fyear</span><span class="op">)</span>, <span class="co">#&lt;</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Spatially varying coefficient of year:</span></span></span>
<span class="r-in"><span><span class="va">pcod_2011</span><span class="op">$</span><span class="va">year_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">pcod_2011</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">density</span> <span class="op">~</span> <span class="va">year_scaled</span>,</span></span>
<span class="r-in"><span>  spatial_varying <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">year_scaled</span>, <span class="co">#&lt;</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, mesh <span class="op">=</span> <span class="va">mesh</span>, family <span class="op">=</span> <span class="fu"><a href="families.html">tweedie</a></span><span class="op">(</span><span class="op">)</span>, time <span class="op">=</span> <span class="st">"year"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatiotemporal model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: density ~ year_scaled</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time column: year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: tweedie(link = 'log')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)     2.86    0.33</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> year_scaled    -0.06    0.15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter: 14.79</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Tweedie p: 1.56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matérn range: 20.56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial SD: 2.38</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatially varying coefficient SD (year_scaled): 0.81</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatiotemporal IID SD: 1.11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 3008.886</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Time-varying effects of depth and depth squared:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">density</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  time_varying <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">depth_scaled</span> <span class="op">+</span> <span class="va">depth_scaled2</span>, <span class="co">#&lt;</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>, time <span class="op">=</span> <span class="st">"year"</span>, mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">tweedie</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatiotemporal model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: density ~ 0 + as.factor(year)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time column: year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: tweedie(link = 'log')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> as.factor(year)2011     3.73    0.30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> as.factor(year)2013     3.64    0.28</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> as.factor(year)2015     4.00    0.29</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> as.factor(year)2017     3.31    0.32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time-varying parameters:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> depth_scaled-2011     -0.87    0.16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> depth_scaled-2013     -0.81    0.13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> depth_scaled-2015     -0.75    0.13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> depth_scaled-2017     -1.11    0.23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> depth_scaled2-2011    -1.92    0.29</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> depth_scaled2-2013    -0.92    0.14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> depth_scaled2-2015    -1.59    0.22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> depth_scaled2-2017    -2.20    0.35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter: 12.80</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Tweedie p: 1.56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matérn range: 0.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial SD: 2572.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatiotemporal IID SD: 2087.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 2911.371</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **Possible issues detected! Check output of sanity().**</span>
<span class="r-in"><span><span class="co"># Extract values:</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sd_report</span>, <span class="st">"Estimate"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sd_report</span>, <span class="st">"Std. Error"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">est</span><span class="op">$</span><span class="va">b_rw_t</span><span class="op">[</span>, , <span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            [,1]       [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -0.8738038 -1.9199722</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -0.8115162 -0.9195934</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] -0.7514766 -1.5858307</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] -1.1064060 -2.1992575</span>
<span class="r-in"><span><span class="va">se</span><span class="op">$</span><span class="va">b_rw_t</span><span class="op">[</span>, , <span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           [,1]      [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.1619744 0.2944087</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.1287059 0.1386946</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 0.1346182 0.2197914</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] 0.2305927 0.3514650</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Linear break-point effect of depth:</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">density</span> <span class="op">~</span> <span class="fu">breakpt</span><span class="op">(</span><span class="va">depth_scaled</span><span class="op">)</span>, <span class="co">#&lt;</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">pcod_2011</span>,</span></span>
<span class="r-in"><span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="families.html">tweedie</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial model fit by ML ['sdmTMB']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: density ~ breakpt(depth_scaled)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mesh: mesh (isotropic covariance)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: pcod_2011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: tweedie(link = 'log')</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      coef.est coef.se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)              4.11    0.33</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> depth_scaled-slope       1.07    0.22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> depth_scaled-breakpt    -1.30    0.25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter: 15.19</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Tweedie p: 1.58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matérn range: 23.57</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial SD: 1.92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ML criterion at convergence: 2997.241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> See ?tidy.sdmTMB to extract these values as a data frame.</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean C. Anderson, Eric J. Ward, Philina A. English, Lewis A. K. Barnett, James T. Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

