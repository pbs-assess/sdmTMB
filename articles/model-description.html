<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>sdmTMB model description â€¢ sdmTMB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="â€image/svg+xmlâ€" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="sdmTMB model description">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sdmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.4.9024</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sdmTMB/sdmTMB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>sdmTMB model description</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sdmTMB/sdmTMB/blob/main/vignettes/model-description.Rmd" class="external-link"><code>vignettes/model-description.Rmd</code></a></small>
      <div class="d-none name"><code>model-description.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette describes the statistical model underlying sdmTMB.
Further details are available in the sdmTMB paper <span class="citation">(Anderson <em>et al.</em> 2024)</span>, which should be
referenced and cited when using sdmTMB in a publication.</p>
</div>
<div class="section level2">
<h2 id="other-vignettes-available">Other vignettes available<a class="anchor" aria-label="anchor" href="#other-vignettes-available"></a>
</h2>
<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class="blue">
<p><strong>If this vignette is being viewed on CRAN, note that many
other vignettes describing how to use sdmTMB are available on the <a href="https://sdmTMB.github.io/sdmTMB/">documentation site</a> under <a href="https://sdmTMB.github.io/sdmTMB/articles/">Articles</a>.</strong></p>
</div>
<!-- Generic commands -->
<!-- bold symbol (Greek) -->
<!-- bold upright (Latin) -->
<!-- roman/upright text -->
<!-- Specific commonly used symbols -->
</div>
<div class="section level2">
<h2 id="notation-conventions">Notation conventions<a class="anchor" aria-label="anchor" href="#notation-conventions"></a>
</h2>
<p>This appendix uses the following notation conventions, which
generally follow the guidance in <span class="citation">Edwards &amp;
Auger-MÃ©thÃ© (2019)</span>:</p>
<ul>
<li><p>Greek symbols for parameters,</p></li>
<li><p>the Latin/Roman alphabet for data except for cases where another
symbol is used by convention,</p></li>
<li><p>bold symbols for vectors or matrices (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›š</mi><annotation encoding="application/x-tex">\boldsymbol{\omega}</annotation></semantics></math>
is a vector and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï‰</mi><mi>ğ¬</mi></msub><annotation encoding="application/x-tex">\omega_{\mathbf{s}}</annotation></semantics></math>
is the value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›š</mi><annotation encoding="application/x-tex">\boldsymbol{\omega}</annotation></semantics></math>
at point in space
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ¬</mi><annotation encoding="application/x-tex">\mathbf{s}</annotation></semantics></math>),
with Latin/Roman symbols in non-italics (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ—</mi><annotation encoding="application/x-tex">\mathbf{X}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ</mi><annotation encoding="application/x-tex">\mathbf{Q}</annotation></semantics></math>),</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
for all distribution dispersion parameters for consistency with the
code,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ”¼</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{E}[y]</annotation></semantics></math>
to define the expected value (mean) of variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathrm{Var}[y]</annotation></semantics></math>
to define the expected variance of the variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>,</p></li>
<li><p>a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^*</annotation></semantics></math>
superscript represents interpolated or projected values as opposed to
values at knot locations (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›š</mi><annotation encoding="application/x-tex">\boldsymbol{\omega}</annotation></semantics></math>
vs.Â <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>ğ›š</mi><mo>*</mo></msup><annotation encoding="application/x-tex">\boldsymbol{\omega}^*</annotation></semantics></math>),
and</p></li>
<li><p>where possible, notation has been chosen to match VAST <span class="citation">(Thorson 2019)</span> to maintain consistency (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›š</mi><annotation encoding="application/x-tex">\boldsymbol{\omega}</annotation></semantics></math>
for spatial fields and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›œ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\epsilon}_t</annotation></semantics></math>
for spatiotemporal fields).</p></li>
</ul>
<p>Tables of indices and symbols are summarized in <a href="#notation-reference-tables">notation reference tables</a> at the
end of this vignette.</p>
</div>
<div class="section level2">
<h2 id="sdmtmb-model-structure">sdmTMB model structure<a class="anchor" aria-label="anchor" href="#sdmtmb-model-structure"></a>
</h2>
<p>The complete sdmTMB model can be written as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î·</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msubsup><mi>ğ—</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow></msubsup><mi>ğ›ƒ</mi><mo>+</mo><msub><mi>O</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>ğ™</mi><mi>g</mi></msub><msub><mi>ğ›</mi><mi>g</mi></msub><mo>+</mo><msubsup><mi>ğ—</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">v</mi><mi mathvariant="normal">c</mi></mrow></msubsup><msub><mi>ğ›„</mi><mi>t</mi></msub><mo>+</mo><msubsup><mi>ğ—</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">v</mi><mi mathvariant="normal">c</mi></mrow></msubsup><msub><mi>ğ›‡</mi><mi>ğ¬</mi></msub><mo>+</mo><msub><mi>Ï‰</mi><mi>ğ¬</mi></msub><mo>+</mo><msub><mi>Ïµ</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¼</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>f</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î·</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>ğ”¼</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>y</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>Î¼</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\eta_{\mathbf{s},t} &amp;=
\mathbf{X}^{\mathrm{main}}_{\mathbf{s},t} \boldsymbol{\beta}+
O_{\mathbf{s},t} +
\mathbf{Z}_{g} \mathbf{b}_{g} +
\mathbf{X}^{\mathrm{tvc}}_{\mathbf{s},t} \boldsymbol{\gamma}_{t} +
\mathbf{X}^{\mathrm{svc}}_{\mathbf{s},t} \boldsymbol{\zeta}_{\mathbf{s}} +
\omega_{\mathbf{s}} +
\epsilon_{\mathbf{s},t},\\
\mu_{\mathbf{s},t} &amp;= f^{-1} \left( \eta_{\mathbf{s},t} \right),\\
\mathbb{E}[y_{\mathbf{s},t}] &amp;= \mu_{\mathbf{s},t},
\end{aligned}
</annotation></semantics></math></p>
<p>where</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">y_{\mathbf{s},t}</annotation></semantics></math>
represents the response data at point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ¬</mi><annotation encoding="application/x-tex">\mathbf{s}</annotation></semantics></math>
and time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î·</mi><annotation encoding="application/x-tex">\eta</annotation></semantics></math>
represents the linear predictor (i.e., in link space)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
represents the conditional mean on the response/data scale (after
applying the inverse link);</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>
represents a link function (e.g., log or logit) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>f</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">f^{-1}</annotation></semantics></math>
represents its inverse, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î·</mi><annotation encoding="application/x-tex">\eta</annotation></semantics></math>
represents the linear predictor before applying
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>f</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">f^{-1}</annotation></semantics></math>;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>ğ—</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow></msup><annotation encoding="application/x-tex">\mathbf{X}^{\mathrm{main}}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>ğ—</mi><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">v</mi><mi mathvariant="normal">c</mi></mrow></msup><annotation encoding="application/x-tex">\mathbf{X}^{\mathrm{tvc}}</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>ğ—</mi><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">v</mi><mi mathvariant="normal">c</mi></mrow></msup><annotation encoding="application/x-tex">\mathbf{X}^{\mathrm{svc}}</annotation></semantics></math>
represent design matrices (the superscript identifiers â€˜mainâ€™ = main
effects, â€˜tvcâ€™ = time varying coefficients, and â€˜svcâ€™ = spatially
varying coefficients);</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›ƒ</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math>
represents a vector of fixed-effect coefficients;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>O</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">O_{\mathbf{s},t}</annotation></semantics></math>
represents an offset: a covariate (usually log transformed) with a
coefficient fixed at one that enters on the linear predictor scale
(before the inverse link);</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ™</mi><mi>g</mi></msub><annotation encoding="application/x-tex">\mathbf{Z}_{g}</annotation></semantics></math>
represents the random-effect design row(s) for group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>
(a subset of the matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ™</mi><annotation encoding="application/x-tex">\mathbf{Z}</annotation></semantics></math>)
corresponding to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›</mi><mi>g</mi></msub><annotation encoding="application/x-tex">\mathbf{b}_{g}</annotation></semantics></math>;
these random effects enter on the linear predictor scale; the scalar
special case is a random intercept
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mi>g</mi></msub><mo>âˆ¼</mo><mi mathvariant="normal">N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha_{g}\sim \mathrm{N}(0,\sigma_\alpha^2)</annotation></semantics></math>,
and more generally random slopes and intercepts are vector-valued with
full covariance as described below;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›„</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\gamma}_{t}</annotation></semantics></math>
represents a vector of time-varying coefficients, where each coefficient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î³</mi><mrow><mi>p</mi><mo>,</mo><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">\gamma_{p,t}</annotation></semantics></math>
can follow a random walk or AR(1) process;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›‡</mi><mi>ğ¬</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\zeta}_{\mathbf{s}}</annotation></semantics></math>
represents a vector of spatially varying coefficients (random fields),
where each coefficient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¶</mi><mrow><mi>l</mi><mo>,</mo><mi>ğ¬</mi></mrow></msub><mo>âˆ¼</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">N</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>ğŸ</mn><mo>,</mo><msub><mi>ğšº</mi><mrow><mi>Î¶</mi><mo>,</mo><mi>l</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\zeta_{l,\mathbf{s}} \sim \mathrm{MVN}(\boldsymbol{0},\boldsymbol{\Sigma}_{\zeta,l})</annotation></semantics></math>;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï‰</mi><mi>ğ¬</mi></msub><annotation encoding="application/x-tex">\omega_{\mathbf{s}}</annotation></semantics></math>
represents a spatial component (a Gaussian Markov random field, GMRF),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ï‰</mi><mi>ğ¬</mi></msub><mo>âˆ¼</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">N</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>ğŸ</mn><mo>,</mo><msub><mi>ğšº</mi><mi>Ï‰</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\omega_{\mathbf{s}} \sim \mathrm{MVN}(\boldsymbol{0},\boldsymbol{\Sigma}_\omega)</annotation></semantics></math>
with MatÃ©rn covariance built from the mesh; and</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïµ</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">\epsilon_{\mathbf{s},t}</annotation></semantics></math>
represents a spatiotemporal component (a GMRF),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ïµ</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><mo>âˆ¼</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">N</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>ğŸ</mn><mo>,</mo><msub><mi>ğšº</mi><mi>Ïµ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\epsilon_{\mathbf{s},t} \sim \mathrm{MVN}(\boldsymbol{0},\boldsymbol{\Sigma}_{\epsilon})</annotation></semantics></math>
with MatÃ©rn covariance over space and temporal evolution as
specified.</li>
</ul>
<p>A single sdmTMB model will rarely, if ever, contain all of the above
components. Next, we will split the model to describe the various parts
in more detail using
â€˜<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>â€¦</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math>â€™
to represent the other optional components.</p>
<div class="section level3">
<h3 id="main-effects">Main effects<a class="anchor" aria-label="anchor" href="#main-effects"></a>
</h3>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¼</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>f</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>ğ—</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow></msubsup><mi>ğ›ƒ</mi><mo>+</mo><mi>â€¦</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\mu_{\mathbf{s},t} &amp;= f^{-1} \left( \mathbf{X}^{\mathrm{main}}_{\mathbf{s},t} \boldsymbol{\beta}+ \ldots \right)
\end{aligned}
</annotation></semantics></math></p>
<p>Within <code><a href="../reference/sdmTMB.html">sdmTMB()</a></code>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>ğ—</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow></msubsup><mi>ğ›ƒ</mi></mrow><annotation encoding="application/x-tex">\mathbf{X}^{\mathrm{main}}_{\mathbf{s},t} \boldsymbol{\beta}</annotation></semantics></math>
is defined by the <code>formula</code> argument and represents the
main-effect model matrix and a corresponding vector of coefficients.
This main effect formula can contain optional penalized smoothers or
non-linear functions as defined below.</p>
<div class="section level4">
<h4 id="smoothers">Smoothers<a class="anchor" aria-label="anchor" href="#smoothers"></a>
</h4>
<p>Smoothers in sdmTMB are implemented with the same formula syntax
familiar to mgcv <span class="citation">(Wood 2017)</span> users fitting
GAMs (generalized additive models). Smooths are implemented in the
formula using <code>+ s(x)</code>, which implements a smooth from
<code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">mgcv::s()</a></code>. Within these smooths, the same syntax commonly
used in <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">mgcv::s()</a></code> can be applied, e.g.Â 2-dimensional
smooths may be constructed with <code>+ s(x, y)</code>; smooths can be
specific to various factor levels, <code>+ s(x, by = group)</code>;
smooths can vary according to a continuous variable,
<code>+ s(x, by = x2)</code>; the basis function dimensions may be
specified, e.g.Â <code>+ s(x, k = 4)</code> (see
<code><a href="https://rdrr.io/pkg/mgcv/man/choose.k.html" class="external-link">?mgcv::choose.k</a></code>); and various types of splines may be
constructed such as cyclic splines to model seasonality,
e.g.Â <code>+ s(month, bs = "cc", k = 12)</code>.</p>
<p>While mgcv can fit unpenalized (e.g., B-splines) or penalized splines
(P-splines), sdmTMB only implements penalized splines. The penalized
splines are constructed in sdmTMB using the function
<code><a href="https://rdrr.io/pkg/mgcv/man/smooth2random.html" class="external-link">mgcv::smooth2random()</a></code>, which transforms splines into random
effects (and associated design matrices) that are estimable in a
mixed-effects modelling framework. This is the same approach as is
implemented in the R packages gamm4 <span class="citation">(Wood &amp;
Scheipl 2020)</span> and brms <span class="citation">(BÃ¼rkner
2017)</span>.</p>
</div>
<div class="section level4">
<h4 id="linear-break-point-threshold-models">Linear break-point threshold models<a class="anchor" aria-label="anchor" href="#linear-break-point-threshold-models"></a>
</h4>
<p>The linear break-point or â€œhockey stickâ€ model can be used to
describe threshold or asymptotic responses. This function consists of
two pieces, so that for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&lt;</mo><msub><mi>b</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x &lt; b_{1}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>x</mi><mo>â‹…</mo><msub><mi>b</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">s(x) = x \cdot b_{0}</annotation></semantics></math>,
and for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&gt;</mo><msub><mi>b</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x &gt; b_{1}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>b</mi><mn>1</mn></msub><mo>â‹…</mo><msub><mi>b</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">s(x) = b_{1} \cdot b_{0}</annotation></semantics></math>.
In both cases,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mn>0</mn></msub><annotation encoding="application/x-tex">b_{0}</annotation></semantics></math>
represents the slope of the function up to a threshold, and the product
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mn>1</mn></msub><mo>â‹…</mo><msub><mi>b</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">b_{1} \cdot b_{0}</annotation></semantics></math>
represents the value at the asymptote. No constraints are placed on
parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mn>0</mn></msub><annotation encoding="application/x-tex">b_{0}</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mn>1</mn></msub><annotation encoding="application/x-tex">b_{1}</annotation></semantics></math>.</p>
<p>These models can be fit by including <code>+ breakpt(x)</code> in the
model formula, where <code>x</code> is a covariate. The formula can
contain a single break-point covariate.</p>
</div>
<div class="section level4">
<h4 id="logistic-threshold-models">Logistic threshold models<a class="anchor" aria-label="anchor" href="#logistic-threshold-models"></a>
</h4>
<p>Models with logistic threshold relationships between a predictor and
the response can be fit with the form</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>Ï„</mi><mo>+</mo><mi>Ïˆ</mi><mspace width="0.222em"></mspace><msup><mrow><mo stretchy="true" form="prefix">[</mo><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mo>ln</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>19</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>âˆ’</mo><mi>s</mi><mn>50</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mn>95</mn><mo>âˆ’</mo><mi>s</mi><mn>50</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mo>,</mo></mrow><annotation encoding="application/x-tex">
s(x)=\tau + \psi\ { \left[ 1+{ e }^{ -\ln \left(19\right) \cdot \left( x-s50 \right)
     / \left(s95 - s50 \right) } \right] }^{-1},
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
represents the logistic function,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ïˆ</mi><annotation encoding="application/x-tex">\psi</annotation></semantics></math>
is a scaling parameter (controlling the height of the y-axis for the
response; unconstrained),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï„</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
is an intercept,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mn>50</mn></mrow><annotation encoding="application/x-tex">s50</annotation></semantics></math>
is a parameter controlling the point at which the function reaches 50%
of the maximum
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ïˆ</mi><annotation encoding="application/x-tex">\psi</annotation></semantics></math>),
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mn>95</mn></mrow><annotation encoding="application/x-tex">s95</annotation></semantics></math>
is a parameter controlling the point at which the function reaches 95%
of the maximum. The parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mn>50</mn></mrow><annotation encoding="application/x-tex">s50</annotation></semantics></math>
is unconstrained but
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mn>95</mn></mrow><annotation encoding="application/x-tex">s95</annotation></semantics></math>
is constrained to be larger than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mn>50</mn></mrow><annotation encoding="application/x-tex">s50</annotation></semantics></math>.</p>
<p>These models can be fit by including <code>+ logistic(x)</code> in
the model formula, where <code>x</code> is a covariate. The formula can
contain a single logistic covariate.</p>
</div>
</div>
<div class="section level3">
<h3 id="spatial-random-fields">Spatial random fields<a class="anchor" aria-label="anchor" href="#spatial-random-fields"></a>
</h3>
<p>Spatial random fields,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï‰</mi><mi>ğ¬</mi></msub><annotation encoding="application/x-tex">\omega_{\mathbf{s}}</annotation></semantics></math>,
are included if <code>spatial = 'on'</code> (or <code>TRUE</code>) and
omitted if <code>spatial = 'off'</code> (or <code>FALSE</code>).</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¼</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>f</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>â€¦</mi><mo>+</mo><msub><mi>Ï‰</mi><mi>ğ¬</mi></msub><mo>+</mo><mi>â€¦</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>ğ›š</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>ğŸ</mn><mo>,</mo><msub><mi>ğšº</mi><mi>Ï‰</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\mu_{\mathbf{s},t} &amp;= f^{-1} \left( \ldots + \omega_{\mathbf{s}} + \ldots \right),\\
\boldsymbol{\omega}&amp;\sim \mathrm{MVNormal} \left( \boldsymbol{0}, \boldsymbol{\Sigma}_\omega \right),\\
\end{aligned}
</annotation></semantics></math> The marginal standard deviation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›š</mi><annotation encoding="application/x-tex">\boldsymbol{\omega}</annotation></semantics></math>
is indicated by <code>Spatial SD</code> in the printed model output or
as <code>sigma_O</code> in the output of
<code>sdmTMB::tidy(fit, "ran_pars")</code>. The â€˜Oâ€™ is for â€˜omegaâ€™
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï‰</mi><annotation encoding="application/x-tex">\omega</annotation></semantics></math>).</p>
<p>Internally, the random fields follow a Gaussian Markov random field
(GMRF)</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›š</mi><mo>âˆ¼</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>ğŸ</mn><mo>,</mo><msubsup><mi>Ïƒ</mi><mi>Ï‰</mi><mn>2</mn></msubsup><msubsup><mi>ğ</mi><mi>Ï‰</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\boldsymbol{\omega}\sim \mathrm{MVNormal}\left(\boldsymbol{0}, \sigma_\omega^2 \mathbf{Q}^{-1}_\omega\right),
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ</mi><mi>Ï‰</mi></msub><annotation encoding="application/x-tex">\mathbf{Q}_\omega</annotation></semantics></math>
is a sparse precision matrix and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>Ïƒ</mi><mi>Ï‰</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_\omega^2</annotation></semantics></math>
is the marginal variance.</p>
</div>
<div class="section level3">
<h3 id="spatiotemporal-random-fields">Spatiotemporal random fields<a class="anchor" aria-label="anchor" href="#spatiotemporal-random-fields"></a>
</h3>
<p>Spatiotemporal random fields are included by default if there are
multiple time elements (<code>time</code> argument is not
<code>NULL</code>) and can be set to IID (independent and identically
distributed, <code>'iid'</code>; default), AR(1) (<code>'ar1'</code>),
random walk (<code>'rw'</code>), or off (<code>'off'</code>) via the
<code>spatiotemporal</code> argument. These text values are case
insensitive.</p>
<p>Spatiotemporal random fields are represented by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›œ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\epsilon}_t</annotation></semantics></math>
within sdmTMB. This has been chosen to match the representation in VAST
<span class="citation">(Thorson 2019)</span>. The marginal standard
deviation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›œ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\epsilon}_t</annotation></semantics></math>
is indicated by <code>Spatiotemporal SD</code> in the printed model
output or as <code>sigma_E</code> in the output of
<code>sdmTMB::tidy(fit, "ran_pars")</code>. The â€˜Eâ€™ is for â€˜epsilonâ€™
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ïµ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math>).</p>
<div class="section level4">
<h4 id="iid-spatiotemporal-random-fields">IID spatiotemporal random fields<a class="anchor" aria-label="anchor" href="#iid-spatiotemporal-random-fields"></a>
</h4>
<p>IID spatiotemporal random fields
(<code>spatiotemporal = 'iid'</code>) can be represented as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¼</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>f</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>â€¦</mi><mo>+</mo><msub><mi>Ïµ</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><mo>+</mo><mi>â€¦</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>ğ›œ</mi><mi>t</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>ğŸ</mn><mo>,</mo><msub><mi>ğšº</mi><mi>Ïµ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\mu_{\mathbf{s},t} &amp;= f^{-1} \left( \ldots + \epsilon_{\mathbf{s},t} + \ldots \right),\\
\boldsymbol{\epsilon}_{t} &amp;\sim \mathrm{MVNormal} \left( \boldsymbol{0}, \boldsymbol{\Sigma}_{\epsilon} \right).
\end{aligned}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïµ</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">\epsilon_{\mathbf{s},t}</annotation></semantics></math>
represent random field deviations at point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ¬</mi><annotation encoding="application/x-tex">\mathbf{s}</annotation></semantics></math>
and time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
The random fields are assumed independent across time steps.</p>
<p>Similarly to the spatial random fields, these spatiotemporal random
fields (including all versions described below) are parameterized
internally with a sparse precision matrix
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ</mi><mi>Ïµ</mi></msub><annotation encoding="application/x-tex">\mathbf{Q}_\epsilon</annotation></semantics></math>)</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ›œ</mi><mi>t</mi></msub><mo>âˆ¼</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>ğŸ</mn><mo>,</mo><msubsup><mi>Ïƒ</mi><mi>Ïµ</mi><mn>2</mn></msubsup><msubsup><mi>ğ</mi><mi>Ïµ</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\boldsymbol{\epsilon}_{t} \sim \mathrm{MVNormal}\left(\boldsymbol{0}, \sigma_\epsilon^2 \mathbf{Q}^{-1}_\epsilon\right).
</annotation></semantics></math></p>
</div>
<div class="section level4">
<h4 id="ar1-spatiotemporal-random-fields">AR(1) spatiotemporal random fields<a class="anchor" aria-label="anchor" href="#ar1-spatiotemporal-random-fields"></a>
</h4>
<p>First-order auto regressive, AR(1), spatiotemporal random fields
(<code>spatiotemporal = 'ar1'</code>) add a parameter defining the
correlation between random field deviations from one time step to the
next. They are defined as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¼</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>f</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>â€¦</mi><mo>+</mo><msub><mi>Î´</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><mo>+</mo><mi>â€¦</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>ğ›…</mi><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>ğŸ</mn><mo>,</mo><msub><mi>ğšº</mi><mi>Ïµ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>ğ›…</mi><mrow><mi>t</mi><mo>&gt;</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>Ï</mi><msub><mi>ğ›…</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><msqrt><mrow><mn>1</mn><mo>âˆ’</mo><msup><mi>Ï</mi><mn>2</mn></msup></mrow></msqrt><msub><mi>ğ›œ</mi><mi>t</mi></msub><mo>,</mo><mspace width="0.222em"></mspace><msub><mi>ğ›œ</mi><mi>t</mi></msub><mo>âˆ¼</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>ğŸ</mn><mo>,</mo><msub><mi>ğšº</mi><mi>Ïµ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\mu_{\mathbf{s},t} &amp;= f^{-1} \left( \ldots + \delta_{\mathbf{s},t} + \ldots \right),\\
\boldsymbol{\delta}_{t=1} &amp;\sim \mathrm{MVNormal} (\boldsymbol{0}, \boldsymbol{\Sigma}_{\epsilon}),\\
\boldsymbol{\delta}_{t&gt;1} &amp;= \rho \boldsymbol{\delta}_{t-1} + \sqrt{1 - \rho^2} \boldsymbol{\epsilon}_{t},  \:
\boldsymbol{\epsilon}_{t} \sim \mathrm{MVNormal} \left(\boldsymbol{0}, \boldsymbol{\Sigma}_{\epsilon} \right),
\end{aligned}
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
is the correlation between subsequent spatiotemporal random fields. The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï</mi><msub><mi>ğ›…</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><msqrt><mrow><mn>1</mn><mo>âˆ’</mo><msup><mi>Ï</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">\rho \boldsymbol{\delta}_{t-1} + \sqrt{1 - \rho^2}</annotation></semantics></math>
term scales the spatiotemporal variance by the correlation such that it
represents the steady-state marginal variance. The correlation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
allows for mean-reverting spatiotemporal fields, and is constrained to
be
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ’</mo><mn>1</mn><mo>&lt;</mo><mi>Ï</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">-1 &lt; \rho &lt; 1</annotation></semantics></math>.
Internally, the parameter is estimated as <code>ar1_phi</code>, which is
unconstrained. The parameter <code>ar1_phi</code> is transformed to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï</mi><mo>=</mo><mn>2</mn><mrow><mo stretchy="true" form="prefix">(</mo><msup><mrow><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi></mrow><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="monospace">ğšŠğš›ğŸ·_ğš™ğš‘ğš’</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\rho = 2 \left( \mathrm{logit}^{-1}(\texttt{ar1\_phi}) \right) - 1</annotation></semantics></math>,
mapping <code>ar1_phi</code> to the range
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mo>âˆ’</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(-1, 1)</annotation></semantics></math>.</p>
</div>
<div class="section level4">
<h4 id="random-walk-spatiotemporal-random-fields-rw">Random walk spatiotemporal random fields (RW)<a class="anchor" aria-label="anchor" href="#random-walk-spatiotemporal-random-fields-rw"></a>
</h4>
<p>Random walk spatiotemporal random fields
(<code>spatiotemporal = 'rw'</code>) represent a model where the
difference in spatiotemporal deviations from one time step to the next
are IID. They are defined as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¼</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>f</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>â€¦</mi><mo>+</mo><msub><mi>Î´</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><mo>+</mo><mi>â€¦</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>ğ›…</mi><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>ğŸ</mn><mo>,</mo><msub><mi>ğšº</mi><mi>Ïµ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>ğ›…</mi><mrow><mi>t</mi><mo>&gt;</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>ğ›…</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>ğ›œ</mi><mi>t</mi></msub><mo>,</mo><mspace width="0.222em"></mspace><msub><mi>ğ›œ</mi><mi>t</mi></msub><mo>âˆ¼</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>ğŸ</mn><mo>,</mo><msub><mi>ğšº</mi><mi>Ïµ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\mu_{\mathbf{s},t} &amp;= f^{-1} \left( \ldots + \delta_{\mathbf{s},t} + \ldots \right),\\
\boldsymbol{\delta}_{t=1} &amp;\sim \mathrm{MVNormal} (\boldsymbol{0}, \boldsymbol{\Sigma}_{\epsilon}),\\
\boldsymbol{\delta}_{t&gt;1} &amp;= \boldsymbol{\delta}_{t-1} +  \boldsymbol{\epsilon}_{t},  \:
\boldsymbol{\epsilon}_{t} \sim \mathrm{MVNormal} \left(\boldsymbol{0}, \boldsymbol{\Sigma}_{\epsilon} \right),
\end{aligned}
</annotation></semantics></math></p>
<p>where the distribution of the spatiotemporal field in the initial
time step is the same as for the AR(1) model, but the absence of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
parameter allows the spatiotemporal field to be non-stationary in time.
Note that, in contrast to the AR(1) parametrization, the variance is no
longer the steady-state marginal variance.</p>
</div>
</div>
<div class="section level3">
<h3 id="time-varying-regression-parameters">Time-varying regression parameters<a class="anchor" aria-label="anchor" href="#time-varying-regression-parameters"></a>
</h3>
<p>Parameters can be modelled as time-varying according to a random walk
or first-order autoregressive, AR(1), process. The time-series model is
defined by <code>time_varying_type</code>. For all types:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¼</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>f</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>â€¦</mi><mo>+</mo><msubsup><mi>ğ—</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">v</mi><mi mathvariant="normal">c</mi></mrow></msubsup><msub><mi>ğ›„</mi><mi>t</mi></msub><mo>+</mo><mi>â€¦</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  \mu_{\mathbf{s},t} &amp;= f^{-1} \left( \ldots +  \mathbf{X}^{\mathrm{tvc}}_{\mathbf{s},t} \boldsymbol{\gamma}_{t} + \ldots \right),
\end{aligned}
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›„</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\gamma}_{t}</annotation></semantics></math>
is an optional vector of time-varying regression parameters and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>ğ—</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">v</mi><mi mathvariant="normal">c</mi></mrow></msubsup><annotation encoding="application/x-tex">\mathbf{X}^{\mathrm{tvc}}_{\mathbf{s},t}</annotation></semantics></math>
is the corresponding model matrix with covariate values. This is defined
via the <code>time_varying</code> argument, assuming that the
<code>time</code> argument is also supplied a column name.
<code>time_varying</code> takes a <em>one-sided</em> formula.
<code>~ 1</code> implies a time-varying intercept.</p>
<p>The following equations describe the time-series process for a single
time-varying coefficient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î³</mi><mrow><mi>p</mi><mo>,</mo><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">\gamma_{p,t}</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
indexes the time-varying coefficient. When multiple time-varying
coefficients are specified, each follows its time-series process
independently with its own variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>Ïƒ</mi><mrow><mi>Î³</mi><mo>,</mo><mi>p</mi></mrow><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_{\gamma,p}^2</annotation></semantics></math>
and (for AR1) correlation parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï</mi><mrow><mi>Î³</mi><mo>,</mo><mi>p</mi></mrow></msub><annotation encoding="application/x-tex">\rho_{\gamma,p}</annotation></semantics></math>.</p>
<p>For <code>time_varying_type = 'rw'</code>, the first time step is
estimated independently:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î³</mi><mrow><mi>p</mi><mo>,</mo><mi>t</mi><mo>=</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi mathvariant="normal">U</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mo>âˆ’</mo><mi>âˆ</mi><mo>,</mo><mi>âˆ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> (treated as an unconstrained parameter)</mtext></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î³</mi><mrow><mi>p</mi><mo>,</mo><mi>t</mi><mo>&gt;</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î³</mi><mrow><mi>p</mi><mo>,</mo><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>,</mo><msubsup><mi>Ïƒ</mi><mrow><mi>Î³</mi><mo>,</mo><mi>p</mi></mrow><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  \gamma_{p,t=1} &amp;\sim \mathrm{Uniform} \left(-\infty, \infty \right) \text{ (treated as an unconstrained parameter)},\\
  \gamma_{p,t&gt;1} &amp;\sim \mathrm{Normal} \left(\gamma_{p,t-1}, \sigma_{\gamma,p}^2 \right).
\end{aligned}
</annotation></semantics></math></p>
<p>In this case, the first time-step value is given an implicit uniform
prior. I.e., the same variable should not appear in the fixed effect
formula since the initial value is estimated as part of the time-varying
formula. The formula <code>time_varying = ~ 1</code> implicitly
represents a time-varying intercept (assuming the <code>time</code>
argument has been supplied) and, this case, the intercept should be
omitted from the main effects (<code>formula ~ + 0 + ...</code> or
<code>formula ~ -1 + ...</code>).</p>
<p>For <code>time_varying_type = 'rw0'</code>, the first time step is
estimated from a mean-zero prior:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î³</mi><mrow><mi>p</mi><mo>,</mo><mi>t</mi><mo>=</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>Ïƒ</mi><mrow><mi>Î³</mi><mo>,</mo><mi>p</mi></mrow><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î³</mi><mrow><mi>p</mi><mo>,</mo><mi>t</mi><mo>&gt;</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î³</mi><mrow><mi>p</mi><mo>,</mo><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>,</mo><msubsup><mi>Ïƒ</mi><mrow><mi>Î³</mi><mo>,</mo><mi>p</mi></mrow><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  \gamma_{p,t=1} &amp;\sim \mathrm{Normal} \left(0, \sigma_{\gamma,p}^2 \right),\\
  \gamma_{p,t&gt;1} &amp;\sim \mathrm{Normal} \left(\gamma_{p,t-1}, \sigma_{\gamma,p}^2 \right).
\end{aligned}
</annotation></semantics></math> In this case, the time-varying variable
(including the intercept) <em>should</em> be included in the main
effects.</p>
<p>For <code>time_varying_type = 'ar1'</code>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î³</mi><mrow><mi>p</mi><mo>,</mo><mi>t</mi><mo>=</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>Ïƒ</mi><mrow><mi>Î³</mi><mo>,</mo><mi>p</mi></mrow><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î³</mi><mrow><mi>p</mi><mo>,</mo><mi>t</mi><mo>&gt;</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ï</mi><mrow><mi>Î³</mi><mo>,</mo><mi>p</mi></mrow></msub><msub><mi>Î³</mi><mrow><mi>p</mi><mo>,</mo><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>,</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><msubsup><mi>Ï</mi><mrow><mi>Î³</mi><mo>,</mo><mi>p</mi></mrow><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><msubsup><mi>Ïƒ</mi><mrow><mi>Î³</mi><mo>,</mo><mi>p</mi></mrow><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  \gamma_{p,t=1} &amp;\sim \mathrm{Normal} \left(0, \sigma_{\gamma,p}^2 \right),\\
  \gamma_{p,t&gt;1} &amp;\sim \mathrm{Normal} \left(\rho_{\gamma,p}\gamma_{p,t-1}, (1 - \rho_{\gamma,p}^2) \sigma_{\gamma,p}^2 \right),
\end{aligned}
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï</mi><mrow><mi>Î³</mi><mo>,</mo><mi>p</mi></mrow></msub><annotation encoding="application/x-tex">\rho_{\gamma,p}</annotation></semantics></math>
is the correlation between subsequent time steps. The first time step is
given a mean-zero prior.</p>
</div>
<div class="section level3">
<h3 id="spatially-varying-coefficients-svc">Spatially varying coefficients (SVC)<a class="anchor" aria-label="anchor" href="#spatially-varying-coefficients-svc"></a>
</h3>
<p>Spatially varying coefficient models are defined as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¼</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>f</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>â€¦</mi><mo>+</mo><msubsup><mi>ğ—</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">v</mi><mi mathvariant="normal">c</mi></mrow></msubsup><msub><mi>ğ›‡</mi><mi>ğ¬</mi></msub><mo>+</mo><mi>â€¦</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¶</mi><mrow><mi>l</mi><mo>,</mo><mi>ğ¬</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>ğŸ</mn><mo>,</mo><msub><mi>ğšº</mi><mrow><mi>Î¶</mi><mo>,</mo><mi>l</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  \mu_{\mathbf{s},t} &amp;= f^{-1} \left( \ldots + \mathbf{X}^{\mathrm{svc}}_{\mathbf{s}, t} \boldsymbol{\zeta}_{\mathbf{s}} + \ldots \right),\\
  \zeta_{l,\mathbf{s}} &amp;\sim \mathrm{MVNormal} \left( \boldsymbol{0}, \boldsymbol{\Sigma}_{\zeta,l} \right),
\end{aligned}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¶</mi><mrow><mi>l</mi><mo>,</mo><mi>ğ¬</mi></mrow></msub><annotation encoding="application/x-tex">\zeta_{l,\mathbf{s}}</annotation></semantics></math>
represents the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>-th
spatially varying coefficient field at location
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ¬</mi><annotation encoding="application/x-tex">\mathbf{s}</annotation></semantics></math>.
When multiple spatially varying coefficients are specified, each is
estimated as an independent spatial random field with its own marginal
variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>Ïƒ</mi><mrow><mi>Î¶</mi><mo>,</mo><mi>l</mi></mrow><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_{\zeta,l}^2</annotation></semantics></math>.
Usually,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>ğ—</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">v</mi><mi mathvariant="normal">c</mi></mrow></msubsup><annotation encoding="application/x-tex">\mathbf{X}^{\mathrm{svc}}_{\mathbf{s}, t}</annotation></semantics></math>
would represent a prediction matrix that is constant spatially for a
given time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
as defined by a one-sided formula supplied to
<code>spatial_varying</code>. For example
<code>spatial_varying = ~ 0 + x</code>, where <code>0</code> omits the
intercept.</p>
<p>The random fields are parameterized internally with a sparse
precision matrix
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ</mi><mi>Î¶</mi></msub><annotation encoding="application/x-tex">\mathbf{Q}_\zeta</annotation></semantics></math>)</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¶</mi><mrow><mi>l</mi><mo>,</mo><mi>ğ¬</mi></mrow></msub><mo>âˆ¼</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>ğŸ</mn><mo>,</mo><msubsup><mi>Ïƒ</mi><mrow><mi>Î¶</mi><mo>,</mo><mi>l</mi></mrow><mn>2</mn></msubsup><msubsup><mi>ğ</mi><mi>Î¶</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\zeta_{l,\mathbf{s}} \sim \mathrm{MVNormal}\left(\boldsymbol{0}, \sigma_{\zeta,l}^2 \mathbf{Q}^{-1}_\zeta\right).
</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="random-intercepts-and-slopes">Random intercepts and slopes<a class="anchor" aria-label="anchor" href="#random-intercepts-and-slopes"></a>
</h3>
<p>Multilevel (hierarchical) intercepts and slopes follow the familiar
lme4/glmmTMB formulation. A single grouping factor can carry an
intercept-only term or a vector of random effects (intercept plus
slopes) with a full covariance:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¼</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>f</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>â€¦</mi><mo>+</mo><msub><mi>ğ™</mi><mi>g</mi></msub><msub><mi>ğ›</mi><mi>g</mi></msub><mo>+</mo><mi>â€¦</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>ğ›</mi><mi>g</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ¼</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">V</mi><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>ğŸ</mn><mo>,</mo><msub><mi>ğšº</mi><mi>g</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  \mu_{\mathbf{s},t} &amp;= f^{-1} \left( \ldots + \mathbf{Z}_{g} \mathbf{b}_{g} + \ldots \right),\\
  \mathbf{b}_{g} &amp;\sim \mathrm{MVNormal} \left( \boldsymbol{0}, \boldsymbol{\Sigma}_{g} \right),
\end{aligned}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ™</mi><mi>g</mi></msub><annotation encoding="application/x-tex">\mathbf{Z}_{g}</annotation></semantics></math>
is the design row(s) for group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>
(e.g., intercept and covariate values) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›</mi><mi>g</mi></msub><annotation encoding="application/x-tex">\mathbf{b}_{g}</annotation></semantics></math>
is the corresponding vector of random effects for that group. The scalar
special case
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><mi>g</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(1|g)</annotation></semantics></math>
corresponds to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n=1</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mi>g</mi></msub><mo>âˆ¼</mo><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha_{g} \sim \mathrm{Normal}(0, \sigma_{\alpha}^2)</annotation></semantics></math>.</p>
<p>Use lme4-style syntax in <code>formula</code>,
e.g.Â <code>(1 | g)</code> for random intercepts,
<code>(1 + x | g)</code> for correlated intercepts and slopes, or
<code>(1 | g1) + (1 + x | g2)</code> to give each grouping factor its
own (co)variance.</p>
<p>Internally, standard deviations are estimated on the log scale, and
correlations are represented by unconstrained Cholesky parameters (via
<code>UNSTRUCTURED_CORR</code>), yielding a positive-definite
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğšº</mi><mi>g</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\Sigma}_{g}</annotation></semantics></math>
per grouping factor.</p>
</div>
<div class="section level3">
<h3 id="offset-terms">Offset terms<a class="anchor" aria-label="anchor" href="#offset-terms"></a>
</h3>
<p>Offset terms can be included through the <code>offset</code> argument
in <code><a href="../reference/sdmTMB.html">sdmTMB()</a></code>. These are included in the linear predictor
as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Î¼</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>f</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>â€¦</mi><mo>+</mo><msub><mi>O</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><mo>+</mo><mi>â€¦</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  \mu_{\mathbf{s},t} &amp;= f^{-1} \left( \ldots + O_{\mathbf{s},t} + \ldots \right),
\end{aligned}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>O</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">O_{\mathbf{s},t}</annotation></semantics></math>
is an offset termâ€”a <strong>log transformed</strong> variable without a
coefficient (assuming a log link). The offset is <em>not</em> included
in the prediction. Therefore, if <code>offset</code> represents a
measure of effort, for example, the prediction is for one unit of effort
(<code>log(1) = 0</code>).</p>
</div>
</div>
<div class="section level2">
<h2 id="observation-model-families">Observation model families<a class="anchor" aria-label="anchor" href="#observation-model-families"></a>
</h2>
<p>Here we describe the main observation families that are available in
sdmTMB and comment on their parametrization, statistical properties,
utility, and code representation in sdmTMB. Families are grouped by
outcome type to make it easier to locate an appropriate observation
model.</p>
<div class="section level3">
<h3 id="bounded-or-binary-outcomes-01-proportions">Bounded or binary outcomes (0â€“1, proportions)<a class="anchor" aria-label="anchor" href="#bounded-or-binary-outcomes-01-proportions"></a>
</h3>
<div class="section level4">
<h4 id="binomial">Binomial<a class="anchor" aria-label="anchor" href="#binomial"></a>
</h4>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Binomial</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mo>,</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\operatorname{Binomial} \left(N, \mu \right)
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
is the size or number of trials, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
is the probability of success for each trial. If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">N = 1</annotation></semantics></math>,
the distribution becomes the Bernoulli distribution. Internally, the
distribution is parameterized as the <a href="https://kaskr.github.io/adcomp/group__R__style__distribution.html#gaecb5a18095a320b42e2d20c4b120f5f5" class="external-link">robust
version</a> in TMB, which is numerically stable when probabilities
approach 0 or 1. Following the structure of <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code>,
lme4, and glmmTMB, a binomial family can be specified in one of 4
ways:</p>
<ol style="list-style-type: decimal">
<li>the response may be a factor (and the model classifies the first
level versus all others)</li>
<li>the response may be binomial (0/1)</li>
<li>the response can be a matrix of form
<code>cbind(success, failure)</code>, or</li>
<li>the response may be the observed proportions, and the
<code>weights</code> argument is used to specify the Binomial size
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>)
parameter (<code>probability ~ ..., weights = N</code>).</li>
</ol>
<p>Code defined <a href="https://kaskr.github.io/adcomp/group__R__style__distribution.html#gaee11f805f02bc1febc6d7bf0487671be" class="external-link">within
TMB</a>.</p>
<p>Example: <code>family = binomial(link = "logit")</code></p>
</div>
<div class="section level4">
<h4 id="beta-binomial">Beta-binomial<a class="anchor" aria-label="anchor" href="#beta-binomial"></a>
</h4>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>BetaBinomial</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mo>,</mo><mi>Î¼</mi><mo>,</mo><mi>Ï•</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\operatorname{BetaBinomial} \left(N, \mu, \phi \right)
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
is the number of trials,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
is the mean success probability, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
is a precision parameter that controls overdispersion relative to a
Binomial. The implied Beta parameters are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î±</mi><mo>=</mo><mi>Î¼</mi><mi>Ï•</mi></mrow><annotation encoding="application/x-tex">\alpha = \mu \phi</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î²</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>Ï•</mi></mrow><annotation encoding="application/x-tex">\beta = (1 - \mu)\phi</annotation></semantics></math>,
and the variance is $ [y] = N (1 - ), , $ which exceeds the Binomial
variance unless
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï•</mi><mo>â†’</mo><mi>âˆ</mi></mrow><annotation encoding="application/x-tex">\phi \to \infty</annotation></semantics></math>.
Available links are logit and cloglog. This family is useful for
overdispersed counts of successes/failures (e.g., aggregated Bernoulli
data, proportions with extra-binomial variation).</p>
<p>Code defined <a href="https://github.com/sdmTMB/sdmTMB/blob/18a39eabc111e2179fa589f942c8820d87ad10df/src/utils.h#L505-L512" class="external-link">within
sdmTMB</a> and implemented in the TMB likelihood at
<code>src/sdmTMB.cpp</code> (e.g., lines 974â€“982).</p>
<p>Example: <code>family = betabinomial(link = "logit")</code></p>
</div>
<div class="section level4">
<h4 id="beta">Beta<a class="anchor" aria-label="anchor" href="#beta"></a>
</h4>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Beta</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mi>Ï•</mi><mo>,</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>Ï•</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\operatorname{Beta} \left(\mu \phi, (1 - \mu) \phi \right)
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
is the mean and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
is a precision parameter. This parametrization follows <span class="citation">Ferrari &amp; Cribari-Neto (2004)</span> and the
betareg R package <span class="citation">(Cribari-Neto &amp; Zeileis
2010)</span>. The variance is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï•</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu (1 - \mu) / (\phi + 1)</annotation></semantics></math>.</p>
<p>Code defined <a href="https://kaskr.github.io/adcomp/group__R__style__distribution.html#ga5324c83759d5211c7c2fbbad37fa8e59" class="external-link">within
TMB</a>.</p>
<p>Example: <code>family = Beta(link = "logit")</code></p>
</div>
</div>
<div class="section level3">
<h3 id="count-data">Count data<a class="anchor" aria-label="anchor" href="#count-data"></a>
</h3>
<div class="section level4">
<h4 id="poisson">Poisson<a class="anchor" aria-label="anchor" href="#poisson"></a>
</h4>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Poisson</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\operatorname{Poisson} \left( \mu \right)
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
represents the mean and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>Î¼</mi></mrow><annotation encoding="application/x-tex">\mathrm{Var}[y] = \mu</annotation></semantics></math>.</p>
<p>Code defined <a href="https://kaskr.github.io/adcomp/group__R__style__distribution.html#gaa1ed15503e1441a381102a8c4c9baaf1" class="external-link">within
TMB</a>.</p>
<p>Example: <code>family = poisson(link = "log")</code></p>
</div>
<div class="section level4">
<h4 id="negative-binomial-2-nb2">Negative Binomial 2 (NB2)<a class="anchor" aria-label="anchor" href="#negative-binomial-2-nb2"></a>
</h4>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>NB2</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><mi>Ï•</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\operatorname{NB2} \left( \mu, \phi \right)
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
is the mean and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
is the dispersion parameter. The variance scales quadratically with the
mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>Î¼</mi><mo>+</mo><msup><mi>Î¼</mi><mn>2</mn></msup><mi>/</mi><mi>Ï•</mi></mrow><annotation encoding="application/x-tex">\mathrm{Var}[y] = \mu + \mu^2 / \phi</annotation></semantics></math><span class="citation">(Hilbe 2011)</span>. The NB2 parametrization is
more commonly seen in ecology than the NB1. Internally, the distribution
is parameterized as the <a href="https://kaskr.github.io/adcomp/group__R__style__distribution.html#gaa23e3ede4669d941b0b54314ed42a75c" class="external-link">robust
version</a> in TMB.</p>
<p>Code defined <a href="https://kaskr.github.io/adcomp/group__R__style__distribution.html#ga76266c19046e04b651fce93aa0810351" class="external-link">within
TMB</a>.</p>
<p>Example: <code>family = nbinom2(link = "log")</code></p>
</div>
<div class="section level4">
<h4 id="negative-binomial-1-nb1">Negative Binomial 1 (NB1)<a class="anchor" aria-label="anchor" href="#negative-binomial-1-nb1"></a>
</h4>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>NB1</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><mi>Ï•</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\operatorname{NB1} \left( \mu, \phi \right)
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
is the mean and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
is the dispersion parameter. The variance scales linearly with the mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>Î¼</mi><mo>+</mo><mi>Î¼</mi><mi>/</mi><mi>Ï•</mi></mrow><annotation encoding="application/x-tex">\mathrm{Var}[y] = \mu + \mu / \phi</annotation></semantics></math><span class="citation">(Hilbe 2011)</span>. Internally, the distribution
is parameterized as the <a href="https://kaskr.github.io/adcomp/group__R__style__distribution.html#gaa23e3ede4669d941b0b54314ed42a75c" class="external-link">robust
version</a> in TMB.</p>
<p>Code defined <a href="https://github.com/sdmTMB/sdmTMB/blob/18a39eabc111e2179fa589f942c8820d87ad10df/src/sdmTMB.cpp#L577-L582" class="external-link">within
sdmTMB</a> based on NB2 and borrowed from glmmTMB.</p>
<p>Example: <code>family = nbinom1(link = "log")</code></p>
</div>
<div class="section level4">
<h4 id="negative-binomial-2-mixture">Negative binomial 2 mixture<a class="anchor" aria-label="anchor" href="#negative-binomial-2-mixture"></a>
</h4>
<p>This is a 2 component mixture that extends the NB2 distribution,
following mixture-distribution approaches for shoaling/aggregation in
survey data <span class="citation">(Thorson <em>et al.</em>
2011)</span>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mo>NB2</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mn>1</mn></msub><mo>,</mo><mi>Ï•</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>p</mi><mo>â‹…</mo><mo>NB2</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mn>2</mn></msub><mo>,</mo><mi>Ï•</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
(1 - p) \cdot \operatorname{NB2} \left( \mu_1, \phi \right) + p \cdot \operatorname{NB2} \left( \mu_2, \phi \right)
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¼</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\mu_1</annotation></semantics></math>
is the mean of the first (smaller component) of the distribution,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¼</mi><mn>2</mn></msub><annotation encoding="application/x-tex">\mu_2</annotation></semantics></math>
is the mean of the larger component, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
controls the contribution of each component to the mixture.</p>
<p>Example: <code>family = nbinom2_mix(link = "log")</code></p>
</div>
</div>
<div class="section level3">
<h3 id="positive-continuous-outcomes">Positive continuous outcomes<a class="anchor" aria-label="anchor" href="#positive-continuous-outcomes"></a>
</h3>
<div class="section level4">
<h4 id="gamma">Gamma<a class="anchor" aria-label="anchor" href="#gamma"></a>
</h4>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Gamma</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï•</mi><mo>,</mo><mfrac><mi>Î¼</mi><mi>Ï•</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\operatorname{Gamma} \left( \phi, \frac{\mu}{\phi}  \right)
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
represents the Gamma shape and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mi>/</mi><mi>Ï•</mi></mrow><annotation encoding="application/x-tex">\mu / \phi</annotation></semantics></math>
represents the scale. The mean is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
and variance is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Î¼</mi><mn>2</mn></msup><mi>/</mi><mi>Ï•</mi></mrow><annotation encoding="application/x-tex">\mu^2 / \phi</annotation></semantics></math>.</p>
<p>Code defined <a href="https://kaskr.github.io/adcomp/group__R__style__distribution.html#gab0e2205710a698ad6a0ed39e0652c9a3" class="external-link">within
TMB</a>.</p>
<p>Example: <code>family = Gamma(link = "log")</code></p>
</div>
<div class="section level4">
<h4 id="lognormal">Lognormal<a class="anchor" aria-label="anchor" href="#lognormal"></a>
</h4>
<p>sdmTMB uses the â€œbias-correctedâ€ lognormal distribution where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
represents the standard deviation in log-space:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Lognormal</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><mi>Î¼</mi><mo>âˆ’</mo><mfrac><msup><mi>Ï•</mi><mn>2</mn></msup><mn>2</mn></mfrac><mo>,</mo><msup><mi>Ï•</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\operatorname{Lognormal} \left( \log \mu - \frac{\phi^2}{2}, \phi^2 \right).
</annotation></semantics></math> Because of the bias correction,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ”¼</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>Î¼</mi></mrow><annotation encoding="application/x-tex">\mathbb{E}[y] = \mu</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mo>log</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><msup><mi>Ï•</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\mathrm{Var}[\log y] = \phi^2</annotation></semantics></math>.</p>
<p>Code defined <a href="https://github.com/sdmTMB/sdmTMB/blob/18a39eabc111e2179fa589f942c8820d87ad10df/src/utils.h#L47-L54" class="external-link">within
sdmTMB</a> based on the TMB <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm()</a></code> normal density.</p>
<p>Example: <code>family = lognormal(link = "log")</code></p>
</div>
<div class="section level4">
<h4 id="generalized-gamma">Generalized gamma<a class="anchor" aria-label="anchor" href="#generalized-gamma"></a>
</h4>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>GenGamma</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><mi>Ï•</mi><mo>,</mo><msup><mi>Q</mi><mrow><mi mathvariant="normal">g</mi><mi mathvariant="normal">g</mi></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\operatorname{GenGamma} \left( \mu, \phi, Q^{\mathrm{gg}}\right)
</annotation></semantics></math></p>
<p>sdmTMB implements the <span class="citation">Prentice (1974)</span>
parameterization introduced for spatiotemporal models and index
standardization by <span class="citation">Dunic <em>et al.</em>
(2025)</span>, with parameters mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>,
scale
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
(standard deviation on the log scale), and a shape parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Q</mi><mrow><mi mathvariant="normal">g</mi><mi mathvariant="normal">g</mi></mrow></msup><annotation encoding="application/x-tex">Q^{\mathrm{gg}}</annotation></semantics></math>
(reported as <code>Generalized gamma Q</code>).</p>
<p>Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
is the mean on the data scale,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
is the log-scale standard deviation, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Q</mi><mrow><mi mathvariant="normal">g</mi><mi mathvariant="normal">g</mi></mrow></msup><annotation encoding="application/x-tex">Q^{\mathrm{gg}}</annotation></semantics></math>
controls the shape
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Q</mi><mrow><mi mathvariant="normal">g</mi><mi mathvariant="normal">g</mi></mrow></msup><mo>â†’</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Q^{\mathrm{gg}}\to 0</annotation></semantics></math>
yields the lognormal;
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Q</mi><mrow><mi mathvariant="normal">g</mi><mi mathvariant="normal">g</mi></mrow></msup><mo>=</mo><mi>Ï•</mi></mrow><annotation encoding="application/x-tex">Q^{\mathrm{gg}}= \phi</annotation></semantics></math>
yields the gamma). See <span class="citation">Dunic <em>et al.</em>
(2025)</span> for the full PDF in the Prentice formulation as
implemented. Links available: identity, log, inverse. This flexibility
is useful for right-skewed positive responses with tails heavier or
lighter than gamma/lognormal, and is often paired in a hurdle/mixture as
<code><a href="../reference/families.html">delta_gengamma()</a></code> for zero-inflated biomass or catch data
(see <span class="citation">Dunic <em>et al.</em> (2025)</span>).</p>
<p>Code defined <a href="https://github.com/sdmTMB/sdmTMB/blob/18a39eabc111e2179fa589f942c8820d87ad10df/src/utils.h#L7-L43" class="external-link">within
sdmTMB</a>.</p>
<p>Example: <code>family = gengamma(link = "log")</code>; delta/hurdle:
<code>family = delta_gengamma(link1 = "logit", link2 = "log")</code>.</p>
</div>
<div class="section level4">
<h4 id="tweedie">Tweedie<a class="anchor" aria-label="anchor" href="#tweedie"></a>
</h4>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Tweedie</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><mi>p</mi><mo>,</mo><mi>Ï•</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="0.222em"></mspace><mn>1</mn><mo>&lt;</mo><mi>p</mi><mo>&lt;</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">
\operatorname{Tweedie} \left(\mu, p, \phi \right), \: 1 &lt; p &lt; 2
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
is the mean,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
is the power parameter constrained between 1 and 2, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
is the dispersion parameter. The Tweedie distribution can be helpful for
modelling data that are positive and continuous but also contain
zeros.</p>
<p>Internally,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
is transformed from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi></mrow><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="monospace">ğšğš‘ğšğšğšŠğš</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\mathrm{logit}^{-1} (\texttt{thetaf}) + 1</annotation></semantics></math>
to constrain it between 1 and 2 and is estimated as an unconstrained
variable.</p>
<p>The <a href="https://kaskr.github.io/adcomp/tweedie_8cpp_source.html" class="external-link">source
code</a> is implemented as in the <a href="https://CRAN.R-project.org/package=cplm" class="external-link">cplm</a> package <span class="citation">(Zhang 2013)</span> and is based on <span class="citation">Dunn &amp; Smyth (2005)</span>. The TMB version is
defined <a href="https://kaskr.github.io/adcomp/group__R__style__distribution.html#ga262f3c2d1cf36f322a62d902a608aae0" class="external-link">here</a>.</p>
<p>Example: <code>family = tweedie(link = "log")</code></p>
</div>
<div class="section level4">
<h4 id="gamma-mixture">Gamma mixture<a class="anchor" aria-label="anchor" href="#gamma-mixture"></a>
</h4>
<p>This is a 2 component mixture that extends the Gamma distribution,
motivated by mixture-distribution treatments of aggregation in survey
data <span class="citation">(Thorson <em>et al.</em> 2011)</span>,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mo>Gamma</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï•</mi><mo>,</mo><mfrac><msub><mi>Î¼</mi><mn>1</mn></msub><mi>Ï•</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>p</mi><mo>â‹…</mo><mo>Gamma</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï•</mi><mo>,</mo><mfrac><msub><mi>Î¼</mi><mn>2</mn></msub><mi>Ï•</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
(1 - p) \cdot \operatorname{Gamma} \left( \phi, \frac{\mu_{1}}{\phi}  \right) + p \cdot \operatorname{Gamma} \left( \phi, \frac{\mu_{2}}{\phi}  \right),
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
represents the Gamma shape,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¼</mi><mn>1</mn></msub><mi>/</mi><mi>Ï•</mi></mrow><annotation encoding="application/x-tex">\mu_{1} / \phi</annotation></semantics></math>
represents the scale for the first (smaller component) of the
distribution,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¼</mi><mn>2</mn></msub><mi>/</mi><mi>Ï•</mi></mrow><annotation encoding="application/x-tex">\mu_{2} / \phi</annotation></semantics></math>
represents the scale for the second (larger component) of the
distribution, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
controls the contribution of each component to the mixture (also
interpreted as the probability of larger events).</p>
<p>The mean is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><msub><mi>Î¼</mi><mn>1</mn></msub><mo>+</mo><mi>p</mi><mo>â‹…</mo><msub><mi>Î¼</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">(1-p) \cdot \mu_{1} + p \cdot \mu_{2}</annotation></semantics></math>.
The variance follows the usual mixture formula:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>Î¼</mi><mn>1</mn><mn>2</mn></msubsup><mi>/</mi><mi>Ï•</mi><mo>+</mo><msubsup><mi>Î¼</mi><mn>1</mn><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>Î¼</mi><mn>2</mn><mn>2</mn></msubsup><mi>/</mi><mi>Ï•</mi><mo>+</mo><msubsup><mi>Î¼</mi><mn>2</mn><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>âˆ’</mo><msup><mrow><mo stretchy="true" form="prefix">[</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>Î¼</mi><mn>1</mn></msub><mo>+</mo><mi>p</mi><msub><mi>Î¼</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">]</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">(1-p)\left(\mu_1^2 / \phi + \mu_1^2\right) + p\left(\mu_2^2 / \phi + \mu_2^2\right) - \left[(1-p)\mu_1 + p\mu_2\right]^2</annotation></semantics></math>.</p>
<p>Here, and for the other mixture distributions, the probability of the
larger mean can be obtained from
<code>plogis(fit$model$par[["logit_p_extreme"]])</code> and the ratio of
the larger mean to the smaller mean can be obtained from
<code>1 + exp(fit$model$par[["log_ratio_mix"]])</code>. The standard
errors are available in the TMB sdreport:
<code>fit$sd_report</code>.</p>
<p>If you wish to fix the probability of a large (i.e., extreme) mean,
which can be hard to estimate, you can fix this value and pass this to
the family:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span><span class="va">...</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">gamma_mix</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span>, p_extreme <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>See also <code>family = delta_gamma_mix()</code> for an extension
incorporating this distribution with delta models.</p>
</div>
<div class="section level4">
<h4 id="lognormal-mixture">Lognormal mixture<a class="anchor" aria-label="anchor" href="#lognormal-mixture"></a>
</h4>
<p>This is a 2 component mixture that extends the lognormal
distribution, again in the spirit of mixture approaches for aggregating/
shoaling data <span class="citation">(Thorson <em>et al.</em>
2011)</span>,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mo>Lognormal</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><msub><mi>Î¼</mi><mn>1</mn></msub><mo>âˆ’</mo><mfrac><msup><mi>Ï•</mi><mn>2</mn></msup><mn>2</mn></mfrac><mo>,</mo><msup><mi>Ï•</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>p</mi><mo>â‹…</mo><mo>Lognormal</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><msub><mi>Î¼</mi><mn>2</mn></msub><mo>âˆ’</mo><mfrac><msup><mi>Ï•</mi><mn>2</mn></msup><mn>2</mn></mfrac><mo>,</mo><msup><mi>Ï•</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
(1 - p) \cdot \operatorname{Lognormal} \left( \log \mu_{1} - \frac{\phi^2}{2}, \phi^2 \right) + p \cdot \operatorname{Lognormal} \left( \log \mu_{2} - \frac{\phi^2}{2}, \phi^2 \right).
</annotation></semantics></math></p>
<p>Because of the bias correction,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ”¼</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>âˆ’</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><msub><mi>Î¼</mi><mn>1</mn></msub><mo>+</mo><mi>p</mi><mo>â‹…</mo><msub><mi>Î¼</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\mathbb{E}[y] = (1-p) \cdot \mu_{1} + p \cdot \mu_{2}</annotation></semantics></math>.
The log-scale variance of the mixture is not simply
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Ï•</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\phi^2</annotation></semantics></math>;
it can be obtained with the standard mixture-variance formula using
component log-means
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo>âˆ’</mo><msup><mi>Ï•</mi><mn>2</mn></msup><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\log \mu_i - \phi^2/2</annotation></semantics></math>
and log-variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Ï•</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\phi^2</annotation></semantics></math>.</p>
<p>As with the Gamma mixture,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
controls the contribution of each component to the mixture (also
interpreted as the probability of larger events).</p>
<p>Example: <code>family = lognormal_mix(link = "log")</code>. See also
<code>family = delta_lognormal_mix()</code> for an extension
incorporating this distribution with delta models. Like with the gamma
mixture, fixed probabilities of extreme events
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
in notation above) can be passed in, e.g.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span><span class="va">...</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">delta_lognormal_mix</a></span><span class="op">(</span>p_extreme <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="continuous-real-valued-outcomes">Continuous real-valued outcomes<a class="anchor" aria-label="anchor" href="#continuous-real-valued-outcomes"></a>
</h3>
<div class="section level4">
<h4 id="gaussian">Gaussian<a class="anchor" aria-label="anchor" href="#gaussian"></a>
</h4>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Normal</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><msup><mi>Ï•</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\operatorname{Normal} \left( \mu, \phi^2 \right)
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
is the mean and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
is the standard deviation. The variance is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Ï•</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\phi^2</annotation></semantics></math>.</p>
<p>Example: <code>family = Gaussian(link = "identity")</code></p>
<p>Code defined <a href="https://kaskr.github.io/adcomp/dnorm_8hpp.html" class="external-link">within
TMB</a>.</p>
</div>
<div class="section level4">
<h4 id="student-t">Student-t<a class="anchor" aria-label="anchor" href="#student-t"></a>
</h4>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Student-t</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><mi>Ï•</mi><mo>,</mo><mi>Î½</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\operatorname{Student-t} \left( \mu, \phi, \nu \right)
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î½</mi><annotation encoding="application/x-tex">\nu</annotation></semantics></math>,
the degrees of freedom (<code>df</code>), is a user-supplied fixed
parameter. Lower values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î½</mi><annotation encoding="application/x-tex">\nu</annotation></semantics></math>
result in heavier tails compared to the Gaussian distribution. Above
approximately <code>df = 20</code>, the distribution becomes very
similar to the Gaussian. The Student-t distribution with a low degrees
of freedom (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î½</mi><mo>â‰¤</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">\nu \le 7</annotation></semantics></math>)
can be helpful for modelling data that would otherwise be suitable for
Gaussian but needs an approach that is robust to outliers <span class="citation">(e.g., Anderson <em>et al.</em> 2017)</span>.</p>
<p>Code defined <a href="https://github.com/sdmTMB/sdmTMB/blob/18a39eabc111e2179fa589f942c8820d87ad10df/src/utils.h#L37-L45" class="external-link">within
sdmTMB</a> based on the <code><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt()</a></code> distribution in TMB.</p>
<p>Example: <code>family = student(link = "log", df = 7)</code></p>
</div>
</div>
<div class="section level3">
<h3 id="zero-inflated-and-hurdle-structures">Zero-inflated and hurdle structures<a class="anchor" aria-label="anchor" href="#zero-inflated-and-hurdle-structures"></a>
</h3>
<div class="section level4">
<h4 id="delta-models">Delta models<a class="anchor" aria-label="anchor" href="#delta-models"></a>
</h4>
<p>sdmTMB allows for several different kinds of delta (also known as
hurdle) models. These families are implemented by specifying the family
as a delta distribution. For example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">delta_gamma</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The list of supported families is included in the documentation on <a href="https://sdmTMB.github.io/sdmTMB/reference/families.html">additional
families</a>, <a href="https://sdmTMB.github.io/sdmTMB/articles/delta-models.html">delta
models</a>, and <a href="https://sdmTMB.github.io/sdmTMB/articles/poisson-link.html">Poisson-link
delta models</a>. By default, the <code>delta_*</code> families donâ€™t
use the Poisson link, but this structure can be specified with
<code>delta_gamma(type = "poisson-link")</code>, which follows the
formulation in <span class="citation">Thorson (2018)</span>.</p>
<p>In the â€œstandardâ€ delta model implementation, sdmTMB constructs two
internal models (formally, two â€œlinear predictorsâ€), with the first
model representing presence-absence and the second model representing
the positive component (such as catch rates in fisheries applications).
Default links associated with each family can be inspected with
<code><a href="../reference/families.html">delta_lognormal()</a></code> and equivalent functions. For the
standard delta models, the default first linear predictor link is logit.
For the Poisson-link type, the first linear predictor link is log.</p>
<p>The <code>formula</code>, <code>spatial</code>,
<code>spatiotemporal</code>, and <code>share_range</code> arguments of
<code><a href="../reference/sdmTMB.html">sdmTMB()</a></code> can be specified independently as a 2-element
list. For example, the spatial random field might be estimated for only
the first linear predictor with:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">delta_gamma</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"on"</span>, <span class="st">"off"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Or for we may want separate main-effects formulas. For example:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">y</span> <span class="op">~</span> <span class="va">depth</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">depth</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>    <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">delta_gamma</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>All other arguments are shared between the linear predictors.</p>
<p>Currently if delta models contain smoothers, both components must
have the same main-effects formula.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="gaussian-random-fields">Gaussian random fields<a class="anchor" aria-label="anchor" href="#gaussian-random-fields"></a>
</h2>
<div class="section level3">
<h3 id="matÃ©rn-parameterization">MatÃ©rn parameterization<a class="anchor" aria-label="anchor" href="#mat%C3%A9rn-parameterization"></a>
</h3>
<p>The MatÃ©rn defines the covariance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¦</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>j</mi></msub><mo>,</mo><msub><mi>s</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Phi \left( s_j, s_k \right)</annotation></semantics></math>
between spatial locations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mi>j</mi></msub><annotation encoding="application/x-tex">s_j</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mi>k</mi></msub><annotation encoding="application/x-tex">s_k</annotation></semantics></math>
as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¦</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>j</mi></msub><mo>,</mo><msub><mi>s</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>Ï„</mi><mn>2</mn></msup><msup><mrow><mo stretchy="true" form="prefix">[</mo><msup><mn>2</mn><mrow><mi>Î½</mi><mo>âˆ’</mo><mn>1</mn></mrow></msup><mi>Î“</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î½</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Îº</mi><msub><mi>d</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>Î½</mi></msup><msub><mi>K</mi><mi>Î½</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Îº</mi><msub><mi>d</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\Phi\left( s_j,s_k \right) = \tau^2 \left[ 2^{\nu - 1}\Gamma(\nu) \right]^{-1} (\kappa d_{jk})^\nu K_\nu \left( \kappa d_{jk} \right),
</annotation></semantics></math><!-- TODO: paraphrase this to avoid self plagiarizing the synopsis report! --></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Ï„</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\tau^2</annotation></semantics></math>
is a scale/precision factor (higher
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï„</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
means lower marginal variance),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î½</mi><annotation encoding="application/x-tex">\nu</annotation></semantics></math>
controls the smoothness,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î“</mi><annotation encoding="application/x-tex">\Gamma</annotation></semantics></math>
represents the Gamma function,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">d_{jk}</annotation></semantics></math>
represents the distance between locations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mi>j</mi></msub><annotation encoding="application/x-tex">s_j</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mi>k</mi></msub><annotation encoding="application/x-tex">s_k</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>Î½</mi></msub><annotation encoding="application/x-tex">K_\nu</annotation></semantics></math>
represents the modified Bessel function of the second kind, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Îº</mi><annotation encoding="application/x-tex">\kappa</annotation></semantics></math>
represents the decorrelation rate. The parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î½</mi><annotation encoding="application/x-tex">\nu</annotation></semantics></math>
is set to 1 because the SPDE approach that gives us sparse matrices (and
therefore major computational speedups) requires
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î±</mi><mo>=</mo><mi>Î½</mi><mo>+</mo><mi>d</mi><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\alpha = \nu + d/2</annotation></semantics></math>
to be an integer when working in 2D (so
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î½</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\nu = 1</annotation></semantics></math>)
<span class="citation">(Lindgren <em>et al.</em> 2011)</span>.
Internally, the parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Îº</mi><annotation encoding="application/x-tex">\kappa</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï„</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
are converted to range and marginal standard deviation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ïƒ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">range</mtext><mo>=</mo><msqrt><mn>8</mn></msqrt><mi>/</mi><mi>Îº</mi></mrow><annotation encoding="application/x-tex">\textrm{range} = \sqrt{8} / \kappa</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ïƒ</mi><mo>=</mo><mn>1</mn><mi>/</mi><msqrt><mrow><mn>4</mn><mi>Ï€</mi><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï„</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>2</mn><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Îº</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msqrt></mrow><annotation encoding="application/x-tex">\sigma = 1 / \sqrt{4 \pi \exp \left(2 \log(\tau) + 2 \log(\kappa) \right) }</annotation></semantics></math>,
so increasing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Îº</mi><annotation encoding="application/x-tex">\kappa</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï„</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
decreases
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ïƒ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>.</p>
<p>In the case of a spatiotemporal model with both spatial and
spatiotemporal fields, if <code>share_range = TRUE</code> in
<code><a href="../reference/sdmTMB.html">sdmTMB()</a></code> (the default), then a single
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Îº</mi><annotation encoding="application/x-tex">\kappa</annotation></semantics></math>
and range are estimated with separate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïƒ</mi><mi>Ï‰</mi></msub><annotation encoding="application/x-tex">\sigma_\omega</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïƒ</mi><mi>Ïµ</mi></msub><annotation encoding="application/x-tex">\sigma_\epsilon</annotation></semantics></math>.
This often makes sense since data are often only weakly informative
about
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Îº</mi><annotation encoding="application/x-tex">\kappa</annotation></semantics></math>.
If <code>share_range = FALSE</code>, then separate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Îº</mi><mi>Ï‰</mi></msub><annotation encoding="application/x-tex">\kappa_\omega</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Îº</mi><mi>Ïµ</mi></msub><annotation encoding="application/x-tex">\kappa_\epsilon</annotation></semantics></math>
are estimated. The spatially varying coefficient field always shares
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Îº</mi><annotation encoding="application/x-tex">\kappa</annotation></semantics></math>
with the spatial random field.</p>
</div>
<div class="section level3">
<h3 id="projection-mathbfa-matrix">Projection
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ€</mi><annotation encoding="application/x-tex">\mathbf{A}</annotation></semantics></math>
matrix<a class="anchor" aria-label="anchor" href="#projection-mathbfa-matrix"></a>
</h3>
<p>The values of the spatial variables at the knots are multiplied by a
projection matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ€</mi><annotation encoding="application/x-tex">\mathbf{A}</annotation></semantics></math>
that bilinearly interpolates from the knot locations to the values at
the locations of the observed or predicted data <span class="citation">(Lindgren &amp; Rue 2015)</span></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>ğ›š</mi><mo>*</mo></msup><mo>=</mo><mi>ğ€</mi><mi>ğ›š</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">
\boldsymbol{\omega}^* = \mathbf{A}\boldsymbol{\omega},
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>ğ›š</mi><mo>*</mo></msup><annotation encoding="application/x-tex">\boldsymbol{\omega}^*</annotation></semantics></math>
represents the values of the spatial random fields at the observed
locations or predicted data locations. The matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ€</mi><annotation encoding="application/x-tex">\mathbf{A}</annotation></semantics></math>
has a row for each data point or prediction point and a column for each
knot. Three non-zero elements on each row define the weight of the
neighbouring 3 knot locations for location
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ¬</mi><annotation encoding="application/x-tex">\mathbf{s}</annotation></semantics></math>.
The same bilinear interpolation happens for any spatiotemporal random
fields</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>ğ›œ</mi><mi>t</mi><mo>*</mo></msubsup><mo>=</mo><mi>ğ€</mi><msub><mi>ğ›œ</mi><mi>t</mi></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">
\boldsymbol{\epsilon}_t^* = \mathbf{A}\boldsymbol{\epsilon}_t.
</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="anisotropy">Anisotropy<a class="anchor" aria-label="anchor" href="#anisotropy"></a>
</h3>
<p>TMB allows for anisotropy, where spatial covariance may be asymmetric
with respect to latitude and longitude (<a href="https://kaskr.github.io/adcomp/namespaceR__inla.html" class="external-link">full
details</a>). Anisotropy can be turned on or off with the logical
<code>anisotropy</code> argument to <code><a href="../reference/sdmTMB.html">sdmTMB()</a></code>. There are a
number of ways to implement anisotropic covariance <span class="citation">(Fuglstad <em>et al.</em> 2015)</span>, and we adopt a
2-parameter rotation matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ‡</mi><annotation encoding="application/x-tex">\mathbf{H}</annotation></semantics></math>.
The elements of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ‡</mi><annotation encoding="application/x-tex">\mathbf{H}</annotation></semantics></math>
are defined by the parameter vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ±</mi><annotation encoding="application/x-tex">\boldsymbol{x}</annotation></semantics></math>
so that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mrow><mn>1</mn><mo>,</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">H_{1,1} = x_{1}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mrow><mn>1</mn><mo>,</mo><mn>2</mn></mrow></msub><mo>=</mo><msub><mi>H</mi><mrow><mn>2</mn><mo>,</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">H_{1,2} = H_{2,1} = x_{2}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mrow><mn>2</mn><mo>,</mo><mn>2</mn></mrow></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><msubsup><mi>x</mi><mn>2</mn><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">H_{2,2} = (1 + x_{2}^2) / x_{1}</annotation></semantics></math>.</p>
<p>Once a model is fitted with <code><a href="../reference/sdmTMB.html">sdmTMB()</a></code>, the anisotropy
relationships may be plotted using the <code><a href="../reference/plot_anisotropy.html">plot_anisotropy()</a></code>
function, which takes the fitted object as an argument. If a barrier
mesh is used, anisotropy is disabled.</p>
</div>
<div class="section level3">
<h3 id="incorporating-physical-barriers-into-the-spde">Incorporating physical barriers into the SPDE<a class="anchor" aria-label="anchor" href="#incorporating-physical-barriers-into-the-spde"></a>
</h3>
<p>In some cases the spatial domain of interest may be complex and
bounded by some barrier such as by land or water (e.g., coastlines,
islands, lakes). SPDE models allow for physical barriers to be
incorporated into the modelling <span class="citation">(Bakka <em>et
al.</em> 2019)</span>. With <code><a href="../reference/sdmTMB.html">sdmTMB()</a></code> models, the mesh
construction occurs in two steps: the user (1) constructs a mesh with a
call to <code>sdmTMBextra::make_mesh()</code>, and (2) passes the mesh
to <code><a href="https://rdrr.io/pkg/sdmTMBextra/man/add_barrier_mesh.html" class="external-link">sdmTMBextra::add_barrier_mesh()</a></code>. The barriers must be
constructed as <code>sf</code> objects <span class="citation">(Pebesma
2018)</span> with polygons defining the barriers. See
<code><a href="https://rdrr.io/pkg/sdmTMBextra/man/add_barrier_mesh.html" class="external-link">?sdmTMBextra::add_barrier_mesh</a></code> for an example.</p>
<p>The barrier implementation requires the user to select a fraction
value (<code>range_fraction</code> argument) that defines the fraction
of the usual spatial range when crossing the barrier <span class="citation">(Bakka <em>et al.</em> 2019)</span>. For example, if
the range was estimated at 10 km, <code>range_fraction = 0.2</code>
would assign a 2 km range to the triangles marked as barrier. That makes
correlation decay much faster through the barrier than around it, which
effectively discourages spatial smoothing from â€œjumpingâ€ across
landmasses. From experimentation, values around 0.1 or 0.2 seem to work
well but values much lower than 0.1 can result in convergence
issues.</p>
<p><a href="https://haakonbakkagit.github.io/btopic128.html" class="external-link">This
website</a> by Francesco Serafini and Haakon Bakka provides an
illustration with INLA. The implementation within TMB was borrowed from
code written by Olav Nikolai Breivik and Hans Skaug at the <a href="https://github.com/skaug/tmb-case-studies" class="external-link">TMB Case Studies</a>
Github site.</p>
</div>
</div>
<div class="section level2">
<h2 id="optimization">Optimization<a class="anchor" aria-label="anchor" href="#optimization"></a>
</h2>
<div class="section level3">
<h3 id="optimization-details">Optimization details<a class="anchor" aria-label="anchor" href="#optimization-details"></a>
</h3>
<p>The sdmTMB model is fit by maximum marginal likelihood. Internally, a
TMB <span class="citation">(Kristensen <em>et al.</em> 2016)</span>
model template calculates the marginal log likelihood and its gradient,
and the negative log likelihood is minimized via the non-linear
optimization routine <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code> in R <span class="citation">(Gay 1990; R Core Team 2021)</span>. Random effects are
represented by the values that maximize the log likelihood conditional
on the fixed effects (their conditional modes), and the Laplace
approximation integrates over them when evaluating the likelihood <span class="citation">(Kristensen <em>et al.</em> 2016)</span>.</p>
<p>Like AD Model Builder <span class="citation">(Fournier <em>et
al.</em> 2012)</span>, TMB allows for parameters to be fit in phases and
we include the <code>multiphase</code> argument in
<code><a href="../reference/sdmTMBcontrol.html">sdmTMB::sdmTMBcontrol()</a></code> to allow this. For high-dimensional
models (many fixed and random effects), phased estimation may be faster,
but this is not always the case because it requires an extra call to
<code><a href="https://rdrr.io/pkg/TMB/man/MakeADFun.html" class="external-link">TMB::MakeADFun()</a></code>. In sdmTMB, phased estimation proceeds by
first estimating all fixed-effect parameters contributing to the
likelihood (holding random effects constant at initial values). In the
second phase, the random-effect parameters (and their variances) are
also estimated. Fixed-effect parameters are also estimated in the second
phase and are initialized at their estimates from the first phase.</p>
<p>In some cases, a single call to <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code> may not
be result in convergence (e.g., the maximum gradient of the marginal
likelihood with respect to fixed-effect parameters is not small enough
yet), and the algorithm may need to be run multiple times. In the
<code><a href="../reference/sdmTMBcontrol.html">sdmTMB::sdmTMBcontrol()</a></code> function, we include an argument
<code>nlminb_loops</code> that will restart the optimization at the
previous best values. The number of <code>nlminb_loops</code> should
generally be small (e.g., 2 or 3), and defaults to 1. For some sdmTMB
models, the Hessian may also be unstable and need to be re-evaluated. We
do this optionally with the <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optimHess()</a></code> routine
after the call to <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code>. The
<code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optimHess()</a></code> function implements a Newton
optimization routine to find the Hessian, and we include the argument
<code>newton_loops</code> in <code><a href="../reference/sdmTMBcontrol.html">sdmTMB::sdmTMBcontrol()</a></code> to
allow for multiple function evaluations (each starting at the previous
best value). By default, this is set to 1 evaluation. The updated
parameters are only accepted if they result in a lower negative marginal
log likelihood. If a model is already fit, the function
<code><a href="../reference/run_extra_optimization.html">sdmTMB::run_extra_optimization()</a></code> can run additional
optimization loops with either routine to further reduce the maximum
gradient.</p>
</div>
<div class="section level3">
<h3 id="assessing-convergence">Assessing convergence<a class="anchor" aria-label="anchor" href="#assessing-convergence"></a>
</h3>
<p>Much of the guidance around diagnostics and glmmTMB also applies to
sdmTMB, e.g.Â <a href="https://CRAN.R-project.org/package=glmmTMB" class="external-link">the
glmmTMB vignette on troubleshooting</a>. Optimization with
<code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code> involves specifying the number of
iterations and evaluations (<code>eval.max</code> and
<code>iter.max</code>) and the tolerances (<code>abs.tol</code>,
<code>rel.tol</code>, <code>x.tol</code>, <code>xf.tol</code>)â€”a greater
number of iterations and smaller tolerance thresholds increase the
chance that the optimal solution is found, but more evaluations
translates into longer computation time. Warnings of
non-positive-definite Hessian matrices (accompanied by parameters with
<code>NA</code>s for standard errors) often mean models are improperly
specified given the data. Standard errors can be observed in the output
of <code>print.sdmTMB()</code> or by checking
<code>fit$sd_report</code>. The maximum gradient of the marginal
likelihood with respect to fixed-effect parameters can be checked by
inspecting (<code>fit$gradients</code>). Guidance varies, but gradients
should be very close to zero (e.g., on the order of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>10</mn><mrow><mo>âˆ’</mo><mn>3</mn></mrow></msup><annotation encoding="application/x-tex">10^{-3}</annotation></semantics></math>
or smaller after reasonable parameter scaling) before assuming the
fitting routine is consistent with convergence. If maximum gradients are
already relatively small, they can sometimes be reduced further with
additional optimization calls beginning at the previous best parameter
vector as described above with
<code><a href="../reference/run_extra_optimization.html">sdmTMB::run_extra_optimization()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="notation-reference-tables">Notation reference tables<a class="anchor" aria-label="anchor" href="#notation-reference-tables"></a>
</h2>
<p>Tables of all major indices (Table 1) and symbols (Table 2) are
provided here for quick reference.</p>
<table class="table">
<caption>Table 1: Subscript notation</caption>
<thead><tr class="header">
<th align="left">Symbol</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ¬</mi><annotation encoding="application/x-tex">\mathbf{s}</annotation></semantics></math></td>
<td align="left">Index for space; a vector of x and y coordinates</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math></td>
<td align="left">Index for time</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math></td>
<td align="left">Group</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math></td>
<td align="left">Index for time-varying coefficient</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math></td>
<td align="left">Index for spatially varying coefficient (SVC)</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Table 2: Symbol notation, code representation (in model output
or in model template code), and descriptions.</caption>
<colgroup>
<col width="19%">
<col width="13%">
<col width="67%">
</colgroup>
<thead><tr class="header">
<th align="left">Symbol</th>
<th align="left">Code</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math></td>
<td align="left"><code>y_i</code></td>
<td align="left">Observed response data</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math></td>
<td align="left"><code>mu_i</code></td>
<td align="left">Mean</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î·</mi><annotation encoding="application/x-tex">\eta</annotation></semantics></math></td>
<td align="left"><code>eta_i</code></td>
<td align="left">Linear predictor before applying the inverse link
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>f</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">f^{-1}</annotation></semantics></math>)</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math></td>
<td align="left"><code>phi</code></td>
<td align="left">A dispersion parameter for a distribution</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math></td>
<td align="left"><code>fit$family$link</code></td>
<td align="left">Link function</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>f</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">f^{-1}</annotation></semantics></math></td>
<td align="left"><code>fit$family$linkinv</code></td>
<td align="left">Inverse link function</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›ƒ</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math></td>
<td align="left"><code>b_j</code></td>
<td align="left">Parameter vector</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ—</mi><annotation encoding="application/x-tex">\mathbf{X}</annotation></semantics></math></td>
<td align="left"><code>X_ij</code></td>
<td align="left">A predictor model matrix</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ™</mi><annotation encoding="application/x-tex">\mathbf{Z}</annotation></semantics></math></td>
<td align="left"><code>Zt_list</code></td>
<td align="left">Random effect design matrix (list of sparse blocks;
rows correspond to observations; subset by group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>)</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>O</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">O_{\mathbf{s}, t}</annotation></semantics></math></td>
<td align="left"><code>offset</code></td>
<td align="left">An offset variable at point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ¬</mi><annotation encoding="application/x-tex">\mathbf{s}</annotation></semantics></math>
and time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï‰</mi><mi>ğ¬</mi></msub><annotation encoding="application/x-tex">\omega_{\mathbf{s}}</annotation></semantics></math></td>
<td align="left"><code>omega_s</code></td>
<td align="left">Spatial random field at point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ¬</mi><annotation encoding="application/x-tex">\mathbf{s}</annotation></semantics></math>
(knot)</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>Ï‰</mi><mi>ğ¬</mi><mo>*</mo></msubsup><annotation encoding="application/x-tex">\omega_{\mathbf{s}}^*</annotation></semantics></math></td>
<td align="left"><code>omega_s_A</code></td>
<td align="left">Spatial random field at point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ¬</mi><annotation encoding="application/x-tex">\mathbf{s}</annotation></semantics></math>
(interpolated)</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¶</mi><mi>ğ¬</mi></msub><annotation encoding="application/x-tex">\zeta_{\mathbf{s}}</annotation></semantics></math></td>
<td align="left"><code>zeta_s</code></td>
<td align="left">Spatially varying coefficient random field at point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ¬</mi><annotation encoding="application/x-tex">\mathbf{s}</annotation></semantics></math>
(knot)</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>Î¶</mi><mi>ğ¬</mi><mo>*</mo></msubsup><annotation encoding="application/x-tex">\zeta_{\mathbf{s}}^*</annotation></semantics></math></td>
<td align="left"><code>zeta_s_A</code></td>
<td align="left">Spatially varying coefficient random field at point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ¬</mi><annotation encoding="application/x-tex">\mathbf{s}</annotation></semantics></math>
(interpolated)</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïµ</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">\epsilon_{\mathbf{s}, t}</annotation></semantics></math></td>
<td align="left"><code>epsilon_st</code></td>
<td align="left">Spatiotemporal random field at point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ¬</mi><annotation encoding="application/x-tex">\mathbf{s}</annotation></semantics></math>
and time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
(knot)</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>Ïµ</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow><mo>*</mo></msubsup><annotation encoding="application/x-tex">\epsilon_{\mathbf{s}, t}^*</annotation></semantics></math></td>
<td align="left"><code>epsilon_st_A</code></td>
<td align="left">Spatiotemporal random field at point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ¬</mi><annotation encoding="application/x-tex">\mathbf{s}</annotation></semantics></math>
and time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
(interpolated)</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î´</mi><mrow><mi>ğ¬</mi><mo>,</mo><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">\delta_{\mathbf{s},t}</annotation></semantics></math></td>
<td align="left"><code>b_t</code></td>
<td align="left">AR(1) or random walk spatiotemporal deviations
(knot)</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î±</mi><mi>g</mi></msub><annotation encoding="application/x-tex">\alpha_g</annotation></semantics></math></td>
<td align="left"><code>RE</code></td>
<td align="left">IID random intercept deviation for group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>
</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ›</mi><mi>g</mi></msub><annotation encoding="application/x-tex">\mathbf{b}_{g}</annotation></semantics></math></td>
<td align="left"><code>re_b_pars</code></td>
<td align="left">Vector of random intercepts/slopes for group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>
</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğšº</mi><mi>Ï‰</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\Sigma}_\omega</annotation></semantics></math></td>
<td align="left"><code>-</code></td>
<td align="left">Spatial random field covariance matrix</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğšº</mi><mi>Î¶</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\Sigma}_\zeta</annotation></semantics></math></td>
<td align="left"><code>-</code></td>
<td align="left">Spatially varying coefficient random field covariance
matrix</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğšº</mi><mi>Ïµ</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\Sigma}_\epsilon</annotation></semantics></math></td>
<td align="left"><code>-</code></td>
<td align="left">Spatiotemporal random field covariance matrix</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ</mi><mi>Ï‰</mi></msub><annotation encoding="application/x-tex">\mathbf{Q}_\omega</annotation></semantics></math></td>
<td align="left"><code>Q_s</code></td>
<td align="left">Spatial random field precision matrix</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ</mi><mi>Î¶</mi></msub><annotation encoding="application/x-tex">\mathbf{Q}_\zeta</annotation></semantics></math></td>
<td align="left"><code>Q_s</code></td>
<td align="left">Spatially varying coefficient random field precision
matrix</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ</mi><mi>Ïµ</mi></msub><annotation encoding="application/x-tex">\mathbf{Q}_\epsilon</annotation></semantics></math></td>
<td align="left"><code>Q_st</code></td>
<td align="left">Spatiotemporal random field precision matrix</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğšº</mi><mi>g</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\Sigma}_{g}</annotation></semantics></math></td>
<td align="left"><code>re_cov_pars</code></td>
<td align="left">Random effect covariance per grouping factor (Cholesky
SD + correlation params)</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_\alpha^2</annotation></semantics></math></td>
<td align="left"><code>sigma_G</code></td>
<td align="left">IID random intercept variance</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>Ïƒ</mi><mi>Ïµ</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_\epsilon^2</annotation></semantics></math></td>
<td align="left"><code>sigma_E</code></td>
<td align="left">Spatiotemporal random field marginal variance</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>Ïƒ</mi><mi>Ï‰</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_\omega^2</annotation></semantics></math></td>
<td align="left"><code>sigma_O</code></td>
<td align="left">Spatial random field marginal variance</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>Ïƒ</mi><mi>Î¶</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_\zeta^2</annotation></semantics></math></td>
<td align="left"><code>sigma_Z</code></td>
<td align="left">Spatially varying coefficient random field marginal
variance</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Îº</mi><mi>Ï‰</mi></msub><annotation encoding="application/x-tex">\kappa_\omega</annotation></semantics></math></td>
<td align="left"><code>kappa(0)</code></td>
<td align="left">Spatial decorrelation rate</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Îº</mi><mi>Ïµ</mi></msub><annotation encoding="application/x-tex">\kappa_\epsilon</annotation></semantics></math></td>
<td align="left"><code>kappa(1)</code></td>
<td align="left">Spatiotemporal decorrelation rate</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math></td>
<td align="left"><code>ar1_rho</code></td>
<td align="left">Correlation between random fields in subsequent time
steps</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ï</mi><mi>Î³</mi></msub><annotation encoding="application/x-tex">\rho_{\gamma}</annotation></semantics></math></td>
<td align="left"><code>rho_time</code></td>
<td align="left">Correlation between time-varying coefficients in
subsequent time steps</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Q</mi><mrow><mi mathvariant="normal">g</mi><mi mathvariant="normal">g</mi></mrow></msup><annotation encoding="application/x-tex">Q^{\mathrm{gg}}</annotation></semantics></math></td>
<td align="left"><code>gengamma_Q</code></td>
<td align="left">Generalized gamma shape parameter
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo>â†’</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Q \rightarrow 0</annotation></semantics></math>
gives lognormal;
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo>=</mo><mi>Ï•</mi></mrow><annotation encoding="application/x-tex">Q=\phi</annotation></semantics></math>
gives gamma)</td>
</tr>
<tr class="even">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ€</mi><annotation encoding="application/x-tex">\mathbf{A}</annotation></semantics></math></td>
<td align="left"><code>A</code></td>
<td align="left">Sparse projection matrix to interpolate between knot
and data locations</td>
</tr>
<tr class="odd">
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ‡</mi><annotation encoding="application/x-tex">\mathbf{H}</annotation></semantics></math></td>
<td align="left"><code>H</code></td>
<td align="left">2-parameter rotation matrix used to define
anisotropy</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-anderson2017c" class="csl-entry">
Anderson, S.C., Branch, T.A., Cooper, A.B. &amp; Dulvy, N.K. (2017).
Black-swan events in animal populations. <em>Proceedings of the National
Academy of Sciences</em>, <strong>114</strong>, 3252â€“3257.
</div>
<div id="ref-sdmTMB" class="csl-entry">
Anderson, S.C., Ward, E.J., English, P.A., Barnett, L.A.K. &amp;
Thorson, J.T. (2024). <a href="https://doi.org/10.1101/2022.03.24.485545" class="external-link"><span class="nocase">sdmTMB</span>: An <span>R</span> package for fast,
flexible, and user-friendly generalized linear mixed effects models with
spatial and spatiotemporal random fields</a>. <em>bioRxiv</em>,
<strong>2022.03.24.485545</strong>.
</div>
<div id="ref-bakka2019" class="csl-entry">
Bakka, H., Vanhatalo, J., Illian, J., Simpson, D. &amp; Rue, H. (2019).
Non-stationary <span>Gaussian</span> models with physical barriers.
<em>arXiv:1608.03787 [stat]</em>. Retrieved from <a href="https://arxiv.org/abs/1608.03787" class="external-link">https://arxiv.org/abs/1608.03787</a>
</div>
<div id="ref-burkner2017" class="csl-entry">
BÃ¼rkner, P.-C. (2017). <a href="https://doi.org/10.18637/jss.v080.i01" class="external-link"><span class="nocase">brms</span>: An <span>R</span> package for
<span>Bayesian</span> multilevel models using <span>Stan</span></a>.
<em>Journal of Statistical Software</em>, <strong>80</strong>, 1â€“28.
</div>
<div id="ref-cribari-neto2010" class="csl-entry">
Cribari-Neto, F. &amp; Zeileis, A. (2010). Beta regression in
<span>R</span>. <em>Journal of Statistical Software</em>,
<strong>34</strong>, 1â€“24.
</div>
<div id="ref-dunicGeneralizedGamma2025" class="csl-entry">
Dunic, J.C., Conner, J., Anderson, S.C. &amp; Thorson, J.T. (2025). <a href="https://doi.org/10.1093/icesjms/fsaf040" class="external-link">The generalized gamma is
a flexible distribution that outperforms alternatives when modelling
catch rate data</a>. <em>ICES Journal of Marine Science</em>,
<strong>82</strong>, fsaf040.
</div>
<div id="ref-dunn2005" class="csl-entry">
Dunn, P.K. &amp; Smyth, G.K. (2005). <a href="https://doi.org/10.1007/s11222-005-4070-y" class="external-link">Series evaluation of
<span>Tweedie</span> exponential dispersion model densities</a>.
<em>Statistics and Computing</em>, <strong>15</strong>, 267â€“280.
</div>
<div id="ref-edwards2019" class="csl-entry">
Edwards, A.M. &amp; Auger-MÃ©thÃ©, M. (2019). Some guidance on using
mathematical notation in ecology. <em>Methods in Ecology and
Evolution</em>, <strong>10</strong>, 92â€“99.
</div>
<div id="ref-ferrari2004" class="csl-entry">
Ferrari, S. &amp; Cribari-Neto, F. (2004). <a href="https://doi.org/10.1080/0266476042000214501" class="external-link">Beta regression for
modelling rates and proportions</a>. <em>Journal of Applied
Statistics</em>, <strong>31</strong>, 799â€“815.
</div>
<div id="ref-fournier2012ad" class="csl-entry">
Fournier, D.A., Skaug, H.J., Ancheta, J., Ianelli, J., Magnusson, A.,
Maunder, M.N., Nielsen, A. &amp; Sibert, J. (2012). AD model builder:
Using automatic differentiation for statistical inference of highly
parameterized complex nonlinear models. <em>Optimization Methods and
Software</em>, <strong>27</strong>, 233â€“249.
</div>
<div id="ref-fuglstad2015a" class="csl-entry">
Fuglstad, G.-A., Lindgren, F., Simpson, D. &amp; Rue, H. (2015).
Exploring a new class of non-stationary spatial <span>Gaussian</span>
random fields with varying local anisotropy. <em>Statistica Sinica</em>,
<strong>25</strong>, 115â€“133.
</div>
<div id="ref-gay1990" class="csl-entry">
Gay, D.M. (1990). Usage summary for selected optimization routines.
<em>Computing Science Technical Report</em>, <strong>153</strong>, 1â€“21.
</div>
<div id="ref-hilbe2011" class="csl-entry">
Hilbe, J.M. (2011). <em>Negative <span>Binomial Regression</span></em>.
<span>Cambridge University Press</span>.
</div>
<div id="ref-kristensen2016" class="csl-entry">
Kristensen, K., Nielsen, A., Berg, C.W., Skaug, H. &amp; Bell, B.M.
(2016). <a href="https://doi.org/10.18637/jss.v070.i05" class="external-link"><span>TMB</span>: Automatic
differentiation and <span>Laplace</span> approximation</a>. <em>Journal
of Statistical Software</em>, <strong>70</strong>, 1â€“21.
</div>
<div id="ref-lindgren2015" class="csl-entry">
Lindgren, F. &amp; Rue, H. (2015). <a href="https://doi.org/10.18637/jss.v063.i19" class="external-link">Bayesian spatial modelling
with <span>R-INLA</span></a>. <em>Journal of Statistical Software</em>,
<strong>63</strong>, 1â€“25.
</div>
<div id="ref-lindgren2011" class="csl-entry">
Lindgren, F., Rue, H. &amp; LindstrÃ¶m, J. (2011). An explicit link
between <span>Gaussian</span> fields and <span>Gaussian Markov</span>
random fields: The stochastic partial differential equation approach.
<em>J. R. Stat. Soc. Ser. B Stat. Methodol.</em>, <strong>73</strong>,
423â€“498.
</div>
<div id="ref-pebesma2018" class="csl-entry">
Pebesma, E. (2018). <span class="nocase">Simple Features for R:
Standardized Support for Spatial Vector Data</span>. <em><span>The R
Journal</span></em>, <strong>10</strong>, 439â€“446. Retrieved from <a href="https://doi.org/10.32614/RJ-2018-009" class="external-link">https://doi.org/10.32614/RJ-2018-009</a>
</div>
<div id="ref-prenticeLogGamma1974" class="csl-entry">
Prentice, R.L. (1974). <a href="https://doi.org/10.1093/biomet/61.3.539" class="external-link">A log gamma model and its
maximum likelihood estimation</a>. <em>Biometrika</em>,
<strong>61</strong>, 539â€“544.
</div>
<div id="ref-r2021" class="csl-entry">
R Core Team. (2021). <em>R: A language and environment for statistical
computing</em>. R Foundation for Statistical Computing, Vienna, Austria.
Retrieved from <a href="https://www.R-project.org/" class="external-link">https://www.R-project.org/</a>
</div>
<div id="ref-thorson2019" class="csl-entry">
Thorson, J.T. (2019). <a href="https://doi.org/10.1016/j.fishres.2018.10.013" class="external-link">Guidance for
decisions using the <span>Vector Autoregressive
Spatio</span>-<span>Temporal</span> (<span>VAST</span>) package in
stock, ecosystem, habitat and climate assessments</a>. <em>Fisheries
Research</em>, <strong>210</strong>, 143â€“161.
</div>
<div id="ref-thorson2018poisson" class="csl-entry">
Thorson, J.T. (2018). <a href="https://doi.org/10.1139/cjfas-2017-0266" class="external-link">Three problems with the
conventional delta-model for biomass sampling data, and a
computationally efficient alternative</a>. <em>Canadian Journal of
Fisheries and Aquatic Sciences</em>, <strong>75</strong>, 1369â€“1382.
</div>
<div id="ref-thorson2011" class="csl-entry">
Thorson, J.T., Stewart, I.J. &amp; Punt, A.E. (2011). <a href="https://doi.org/10.1139/f2011-086" class="external-link">Accounting for fish shoals in
single- and multi-species survey data using mixture distribution
models</a>. <em>Canadian Journal of Fisheries and Aquatic Sciences</em>,
<strong>68</strong>, 1681â€“1693.
</div>
<div id="ref-wood2017a" class="csl-entry">
Wood, S.N. (2017). <em>Generalized additive models: An introduction with
<span>R</span></em>, 2nd edn. <span>Chapman and Hall/CRC</span>.
</div>
<div id="ref-wood2020" class="csl-entry">
Wood, S. &amp; Scheipl, F. (2020). <em>gamm4: <span>Generalized Additive
Mixed Models</span> using â€™mgcvâ€™ and â€™lme4â€™</em>. Retrieved from <a href="https://CRAN.R-project.org/package=gamm4" class="external-link">https://CRAN.R-project.org/package=gamm4</a>
</div>
<div id="ref-zhang2013a" class="csl-entry">
Zhang, Y. (2013). <a href="https://doi.org/10.1007/s11222-012-9343-7" class="external-link">Likelihood-based and
<span>Bayesian</span> methods for <span>Tweedie</span> compound
<span>Poisson</span> linear mixed models</a>. <em>Statistics and
Computing</em>, <strong>23</strong>, 743â€“757.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean C. Anderson, Eric J. Ward, Philina A. English, Lewis A. K. Barnett, James T. Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
