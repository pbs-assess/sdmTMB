<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Threshold modeling with sdmTMB • sdmTMB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Threshold modeling with sdmTMB">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sdmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.0.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic-intro.html">Introduction to modelling with sdmTMB</a></li>
    <li><a class="dropdown-item" href="../articles/bayesian.html">Bayesian estimation with sdmTMB</a></li>
    <li><a class="dropdown-item" href="../articles/cross-validation.html">Cross-validation for model evaluation and comparison</a></li>
    <li><a class="dropdown-item" href="../articles/delta-models.html">Fitting delta (hurdle) models with sdmTMB</a></li>
    <li><a class="dropdown-item" href="../articles/forecasting.html">Forecasting with sdmTMB</a></li>
    <li><a class="dropdown-item" href="../articles/ggeffects.html">Visualizing marginal effects in sdmTMB models with ggeffects</a></li>
    <li><a class="dropdown-item" href="../articles/index-standardization.html">Index standardization with sdmTMB</a></li>
    <li><a class="dropdown-item" href="../articles/model-description.html">sdmTMB model description</a></li>
    <li><a class="dropdown-item" href="../articles/multispecies.html">Fitting multispecies models with sdmTMB</a></li>
    <li><a class="dropdown-item" href="../articles/poisson-link.html">Poisson-link delta models</a></li>
    <li><a class="dropdown-item" href="../articles/presence-only.html">Spatial Modeling of Presence-Only Data with sdmTMB</a></li>
    <li><a class="dropdown-item" href="../articles/pretty-plots.html">Making pretty maps with sdmTMB output</a></li>
    <li><a class="dropdown-item" href="../articles/residual-checking.html">Residual checking with sdmTMB</a></li>
    <li><a class="dropdown-item" href="../articles/spatial-trend-models.html">Fitting spatial trend models with sdmTMB</a></li>
    <li><a class="dropdown-item" href="../articles/threshold-models.html">Threshold modeling with sdmTMB</a></li>
    <li><a class="dropdown-item" href="../articles/visreg.html">Visualizing sdmTMB conditional effects using visreg</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pbs-assess/sdmTMB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Threshold modeling with sdmTMB</h1>
            
            <h4 data-toc-skip class="date">2025-04-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pbs-assess/sdmTMB/blob/main/vignettes/articles/threshold-models.Rmd" class="external-link"><code>vignettes/articles/threshold-models.Rmd</code></a></small>
      <div class="d-none name"><code>threshold-models.Rmd</code></div>
    </div>

    
    
<p><strong>If the code in this vignette has not been evaluated, a
rendered version is available on the <a href="https://pbs-assess.github.io/sdmTMB/index.html">documentation
site</a> under ‘Articles’.</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pbs-assess.github.io/sdmTMB/">sdmTMB</a></span><span class="op">)</span></span></code></pre></div>
<p>We’ll repeat the same models used for the index standardization
vignette, using the built-in data for Pacific cod.</p>
<p>As a summary, - We’ve included columns for depth and depth squared. -
Depth was centred and scaled by its standard deviation and we’ve
included those in the data frame so that they could be used to similarly
scale the prediction grid. - The density units should be
kg/km<sup>2</sup>. - Here, X and Y are coordinates in UTM zone 9.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 2,143</span></span>
<span><span class="co">#&gt; Columns: 12</span></span>
<span><span class="co">#&gt; $ year          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 2003<span style="color: #949494;">, </span>2003<span style="color: #949494;">, </span>2003<span style="color: #949494;">, </span>2003<span style="color: #949494;">, </span>2003<span style="color: #949494;">, </span>2003<span style="color: #949494;">, </span>2003<span style="color: #949494;">, </span>2003<span style="color: #949494;">, </span>2003<span style="color: #949494;">, </span>20…</span></span>
<span><span class="co">#&gt; $ X             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 446.4752<span style="color: #949494;">, </span>446.4594<span style="color: #949494;">, </span>448.5987<span style="color: #949494;">, </span>436.9157<span style="color: #949494;">, </span>420.6101<span style="color: #949494;">, </span>417.71…</span></span>
<span><span class="co">#&gt; $ Y             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 5793.426<span style="color: #949494;">, </span>5800.136<span style="color: #949494;">, </span>5801.687<span style="color: #949494;">, </span>5802.305<span style="color: #949494;">, </span>5771.055<span style="color: #949494;">, </span>5772.2…</span></span>
<span><span class="co">#&gt; $ depth         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 201<span style="color: #949494;">, </span>212<span style="color: #949494;">, </span>220<span style="color: #949494;">, </span>197<span style="color: #949494;">, </span>256<span style="color: #949494;">, </span>293<span style="color: #949494;">, </span>410<span style="color: #949494;">, </span>387<span style="color: #949494;">, </span>285<span style="color: #949494;">, </span>270<span style="color: #949494;">, </span>381<span style="color: #949494;">, </span>1…</span></span>
<span><span class="co">#&gt; $ density       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 113.138476<span style="color: #949494;">, </span>41.704922<span style="color: #949494;">, </span>0.000000<span style="color: #949494;">, </span>15.706138<span style="color: #949494;">, </span>0.000000<span style="color: #949494;">, </span>0.…</span></span>
<span><span class="co">#&gt; $ present       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ lat           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 52.28858<span style="color: #949494;">, </span>52.34890<span style="color: #949494;">, </span>52.36305<span style="color: #949494;">, </span>52.36738<span style="color: #949494;">, </span>52.08437<span style="color: #949494;">, </span>52.094…</span></span>
<span><span class="co">#&gt; $ lon           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -129.7847<span style="color: #949494;">, </span>-129.7860<span style="color: #949494;">, </span>-129.7549<span style="color: #949494;">, </span>-129.9265<span style="color: #949494;">, </span>-130.1586<span style="color: #949494;">, </span>-…</span></span>
<span><span class="co">#&gt; $ depth_mean    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 5.155194<span style="color: #949494;">, </span>5.155194<span style="color: #949494;">, </span>5.155194<span style="color: #949494;">, </span>5.155194<span style="color: #949494;">, </span>5.155194<span style="color: #949494;">, </span>5.1551…</span></span>
<span><span class="co">#&gt; $ depth_sd      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.4448783<span style="color: #949494;">, </span>0.4448783<span style="color: #949494;">, </span>0.4448783<span style="color: #949494;">, </span>0.4448783<span style="color: #949494;">, </span>0.4448783<span style="color: #949494;">, </span>0…</span></span>
<span><span class="co">#&gt; $ depth_scaled  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.3329252<span style="color: #949494;">, </span>0.4526914<span style="color: #949494;">, </span>0.5359529<span style="color: #949494;">, </span>0.2877417<span style="color: #949494;">, </span>0.8766077<span style="color: #949494;">, </span>1…</span></span>
<span><span class="co">#&gt; $ depth_scaled2 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.11083919<span style="color: #949494;">, </span>0.20492947<span style="color: #949494;">, </span>0.28724555<span style="color: #949494;">, </span>0.08279527<span style="color: #949494;">, </span>0.768440…</span></span></code></pre></div>
<p>As before, the SPDE mesh is created using 75 knots for a balance
between speed and accuracy. You will likely want to use more for applied
scenarios. You will want to make sure that increasing the number of
knots does not change the conclusions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pcod_spde</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_mesh.html">make_mesh</a></span><span class="op">(</span><span class="va">pcod</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, cutoff <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<p>We will extend the simple GLMM used in the index standardization
vignette to include a threshold effect. For real applications, the
threshold effect might be a function of habitat covariates,
environmental variables, etc. Because ‘depth’ is the only external
variable in the <code>pcod</code> data frame, we’ll use that. For any
threshold model, you can specify the model as a linear threshold
(<code>breakpt()</code>) or logistic (<code>logistic()</code>) as part
of the formula. Note: as before, if we want to use this model for index
standardization then we need to include <code>0 + as.factor(year)</code>
or <code>-1 + as.factor(year)</code> so that we have a factor predictor
that represents the mean estimate for each time slice.</p>
<p>This first example uses the ‘depth_scaled’ covariate (depth,
standardized ~ N(0,1)) and the logistic function, similar to selectivity
curves used in fisheries models. The form is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>τ</mi><mo>+</mo><mi>ψ</mi><mo>*</mo><mspace width="1.0em"></mspace><msup><mrow><mo stretchy="true" form="prefix">[</mo><mn>1</mn><mo>+</mo><msup><mo>exp</mo><mrow><mo>−</mo><mi>l</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>19</mn><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mo>*</mo><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>−</mo><mi>s</mi><mn>50</mn><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mi>/</mi><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mn>95</mn><mspace width="1.0em"></mspace><mo>−</mo><mspace width="1.0em"></mspace><mi>s</mi><mn>50</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msup><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">s(x)=\tau + \psi *\quad { \left[ 1+{ \exp }^{ -ln\left( 19 \right) \quad *\quad \left( x-s50 \right) \quad /\quad \left( s95\quad -\quad s50 \right)  } \right]  }^{ -1 }</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ψ</mi><annotation encoding="application/x-tex">\psi</annotation></semantics></math>
is a scaling parameter (controlling the height of the y-axis for the
response, and is unconstrained),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
is an intercept,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mn>50</mn></mrow><annotation encoding="application/x-tex">s50</annotation></semantics></math>
is a parameter controlling the point at which the function reaches 50%
of the maximum
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ψ</mi><annotation encoding="application/x-tex">\psi</annotation></semantics></math>),
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mn>95</mn></mrow><annotation encoding="application/x-tex">s95</annotation></semantics></math>
is a parameter controlling the point at which the function reaches 95%.
The parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mn>50</mn></mrow><annotation encoding="application/x-tex">s50</annotation></semantics></math>
is unconstrained, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mn>95</mn></mrow><annotation encoding="application/x-tex">s95</annotation></semantics></math>
is constrained to be larger than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mn>50</mn></mrow><annotation encoding="application/x-tex">s50</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pcod</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">density</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu">logistic</span><span class="op">(</span><span class="va">depth_scaled</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"year"</span>, mesh <span class="op">=</span> <span class="va">pcod_spde</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can then look at the important coefficients from the model. Here
we’re looking at ‘s50’, ‘s95’, and ‘smax’.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spatiotemporal model fit by ML ['sdmTMB']</span></span>
<span><span class="co">#&gt; Formula: density ~ 0 + logistic(depth_scaled) + as.factor(year)</span></span>
<span><span class="co">#&gt; Mesh: pcod_spde (isotropic covariance)</span></span>
<span><span class="co">#&gt; Time column: year</span></span>
<span><span class="co">#&gt; Data: pcod</span></span>
<span><span class="co">#&gt; Family: tweedie(link = 'log')</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Conditional model:</span></span>
<span><span class="co">#&gt;                     coef.est coef.se</span></span>
<span><span class="co">#&gt; as.factor(year)2003    -0.52    0.63</span></span>
<span><span class="co">#&gt; as.factor(year)2004     0.06    0.62</span></span>
<span><span class="co">#&gt; as.factor(year)2005    -0.08    0.62</span></span>
<span><span class="co">#&gt; as.factor(year)2007    -1.28    0.63</span></span>
<span><span class="co">#&gt; as.factor(year)2009    -0.80    0.63</span></span>
<span><span class="co">#&gt; as.factor(year)2011    -0.33    0.62</span></span>
<span><span class="co">#&gt; as.factor(year)2013    -0.13    0.61</span></span>
<span><span class="co">#&gt; as.factor(year)2015    -0.16    0.62</span></span>
<span><span class="co">#&gt; as.factor(year)2017    -0.75    0.63</span></span>
<span><span class="co">#&gt; depth_scaled-s50       -1.48    0.12</span></span>
<span><span class="co">#&gt; depth_scaled-s95       -0.89    0.11</span></span>
<span><span class="co">#&gt; depth_scaled-smax       3.22    0.53</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dispersion parameter: 12.33</span></span>
<span><span class="co">#&gt; Tweedie p: 1.53</span></span>
<span><span class="co">#&gt; Matérn range: 22.09</span></span>
<span><span class="co">#&gt; Spatial SD: 2.02</span></span>
<span><span class="co">#&gt; Spatiotemporal IID SD: 1.40</span></span>
<span><span class="co">#&gt; ML criterion at convergence: 6435.001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; See ?tidy.sdmTMB to extract these values as a data frame.</span></span></code></pre></div>
<p>We can visualize the effect:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  depth_scaled <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">$</span><span class="va">depth_scaled</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">$</span><span class="va">depth_scaled</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.2</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, </span>
<span>  year <span class="op">=</span> <span class="fl">2015L</span> <span class="co"># a chosen year</span></span>
<span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, newdata <span class="op">=</span> <span class="va">nd</span>, se_fit <span class="op">=</span> <span class="cn">TRUE</span>, re_form <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">depth_scaled</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span>, </span>
<span>  ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">est</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">est_se</span><span class="op">)</span>, </span>
<span>  ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">est</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">est_se</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="threshold-models_files/figure-html/logistic-eff-1.png" width="672"></p>
<p>Next, we can try to fit the same model but use a linear breakpoint /
cutpoint model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pcod</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">density</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu">breakpt</span><span class="op">(</span><span class="va">depth_scaled</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"year"</span>, mesh <span class="op">=</span> <span class="va">pcod_spde</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For this model, the important parameters are the slope,
‘depth_scaled-slope’, and breakpoint, ‘depth_scaled-breakpt’.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spatiotemporal model fit by ML ['sdmTMB']</span></span>
<span><span class="co">#&gt; Formula: density ~ 0 + breakpt(depth_scaled) + as.factor(year)</span></span>
<span><span class="co">#&gt; Mesh: pcod_spde (isotropic covariance)</span></span>
<span><span class="co">#&gt; Time column: year</span></span>
<span><span class="co">#&gt; Data: pcod</span></span>
<span><span class="co">#&gt; Family: tweedie(link = 'log')</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Conditional model:</span></span>
<span><span class="co">#&gt;                      coef.est coef.se</span></span>
<span><span class="co">#&gt; as.factor(year)2003      3.63    0.33</span></span>
<span><span class="co">#&gt; as.factor(year)2004      4.19    0.32</span></span>
<span><span class="co">#&gt; as.factor(year)2005      4.00    0.32</span></span>
<span><span class="co">#&gt; as.factor(year)2007      2.89    0.33</span></span>
<span><span class="co">#&gt; as.factor(year)2009      3.38    0.33</span></span>
<span><span class="co">#&gt; as.factor(year)2011      3.78    0.32</span></span>
<span><span class="co">#&gt; as.factor(year)2013      4.09    0.32</span></span>
<span><span class="co">#&gt; as.factor(year)2015      3.94    0.32</span></span>
<span><span class="co">#&gt; as.factor(year)2017      3.39    0.33</span></span>
<span><span class="co">#&gt; depth_scaled-slope       1.12    0.17</span></span>
<span><span class="co">#&gt; depth_scaled-breakpt    -1.59    0.23</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dispersion parameter: 12.14</span></span>
<span><span class="co">#&gt; Tweedie p: 1.51</span></span>
<span><span class="co">#&gt; Matérn range: 15.93</span></span>
<span><span class="co">#&gt; Spatial SD: 1.82</span></span>
<span><span class="co">#&gt; Spatiotemporal IID SD: 1.70</span></span>
<span><span class="co">#&gt; ML criterion at convergence: 6397.346</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; See ?tidy.sdmTMB to extract these values as a data frame.</span></span></code></pre></div>
<p>We can visualize the linear breakpoint effect:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, newdata <span class="op">=</span> <span class="va">nd</span>, se_fit <span class="op">=</span> <span class="cn">TRUE</span>, re_form <span class="op">=</span> <span class="cn">NA</span>, xy_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">depth_scaled</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span>, </span>
<span>  ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">est</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">est_se</span><span class="op">)</span>, </span>
<span>  ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">est</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">est_se</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="threshold-models_files/figure-html/brkpt-eff-1.png" width="672"></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean C. Anderson, Eric J. Ward, Philina A. English, Lewis A. K. Barnett, James T. Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
