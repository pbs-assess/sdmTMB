<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Poisson-link delta models ‚Ä¢ sdmTMB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Poisson-link delta models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sdmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.4.9024</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sdmTMB/sdmTMB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Poisson-link delta models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sdmTMB/sdmTMB/blob/main/vignettes/articles/poisson-link.Rmd" class="external-link"><code>vignettes/articles/poisson-link.Rmd</code></a></small>
      <div class="d-none name"><code>poisson-link.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Jim Thorson introduced the Poisson-link delta model in a CJFAS paper
<span class="citation">(Thorson 2018)</span>. It‚Äôs a useful model family
when dealing with positive continuous data that have zeroes. It can be
used in the same circumstances that you could use the Tweedie or a
traditional delta-gamma or delta-lognormal model with logit and log
links.</p>
<p>The Poisson-link delta formulation describes how to go from linear
predictors in link space to expected values that are entered into the
data likelihood. The likelihood on the first component is Bernoulli
(i.e., binomial with single trials) and the likelihood of the second
component can be gamma or lognormal.</p>
<p>In sdmTMB, these families are specified as
<code>delta_gamma(type = "poisson-link")</code> and
<code>delta_lognormal(type = "poisson-link")</code>.</p>
</div>
<div class="section level2">
<h2 id="the-model">The model<a class="anchor" aria-label="anchor" href="#the-model"></a>
</h2>
<p><span class="citation">Thorson (2018)</span> describes the process
model as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>p</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mn>1</mn><mo>‚àí</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚àí</mo><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>r</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mrow><mi>n</mi><mi>w</mi></mrow><mi>p</mi></mfrac><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
p &amp;= 1 - \exp(-n),\\
r &amp;= \frac{n w}{p},
\end{aligned}
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
represents encounter <strong>p</strong>robability,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
represents group <strong>n</strong>umbers density,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
represents positive catch <strong>r</strong>ate (i.e., catch rate given
encounter), and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math>
represents <strong>w</strong>eight per group.</p>
<p>The linear predictors represent log group numbers density
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\log (n)</annotation></semantics></math>)
and log weight per group
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\log (w)</annotation></semantics></math>):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>ùêó</mi><mn>ùüè</mn></msub><msub><mi>ùõÉ</mi><mn>ùüè</mn></msub><mo>+</mo><mi>‚Ä¶</mi><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>w</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>ùêó</mi><mn>ùüê</mn></msub><msub><mi>ùõÉ</mi><mn>ùüê</mn></msub><mo>+</mo><mi>‚Ä¶</mi><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\log (n) &amp;= \boldsymbol{X_1} \boldsymbol{\beta_1} + \ldots,\\
\log (w) &amp;= \boldsymbol{X_2} \boldsymbol{\beta_2} + \ldots,
\end{aligned}
</annotation></semantics></math></p>
<p>where the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêó</mi><annotation encoding="application/x-tex">\boldsymbol{X}</annotation></semantics></math>s
represent design matrices, the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùõÉ</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math>s
represent coefficient vectors, and the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>‚Ä¶</mi><annotation encoding="application/x-tex">\ldots</annotation></semantics></math>
represents all other possible model components that are linear in link
space including any random fields.</p>
<p>These are transformed with the above process equations to generate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>.
Then the model evaluates the following likelihood components. For the
encounter probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Bernoulli</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\operatorname{Bernoulli} (p),
</annotation></semantics></math></p>
<p>or equivalently</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Binomial</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\operatorname{Binomial} (1, p),
</annotation></semantics></math></p>
<p>and for the positive rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>,
either the gamma or lognormal likelihood</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Gamma</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>œï</mi><mo>,</mo><mfrac><mi>r</mi><mi>œï</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\operatorname{Gamma} \left( \phi, \frac{r}{\phi}  \right),
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œï</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
represents the gamma shape and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>/</mi><mi>œï</mi></mrow><annotation encoding="application/x-tex">r / \phi</annotation></semantics></math>
represents the scale, or</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Lognormal</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mfrac><msup><mi>œï</mi><mn>2</mn></msup><mn>2</mn></mfrac><mo>,</mo><msup><mi>œï</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\operatorname{Lognormal} \left( \log (r) - \frac{\phi^2}{2}, \phi^2 \right),
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mfrac><msup><mi>œï</mi><mn>2</mn></msup><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\log (r) - \frac{\phi^2}{2}</annotation></semantics></math>
represents the bias-corrected log mean and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œï</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
represents the standard deviation in log-space.</p>
</div>
<div class="section level2">
<h2 id="an-example">An example<a class="anchor" aria-label="anchor" href="#an-example"></a>
</h2>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>We will work with Pacific Spiny Dogfish observations from a trawl
survey off the west coast of Vancouver Island, Canada. The dataset
<code>dogfish</code> is contained within the sdmTMB package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sdmTMB.github.io/sdmTMB/">sdmTMB</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dogfish</span><span class="op">$</span><span class="va">log_depth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dogfish</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dogfish</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 √ó 10</span></span></span>
<span><span class="co">#&gt;    year longitude latitude     X     Y present catch_weight area_swept depth</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>004     -<span style="color: #BB0000;">125.</span>     48.7  780. <span style="text-decoration: underline;">5</span>399.       1         22.7     0.103     73</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>004     -<span style="color: #BB0000;">126.</span>     48.2  735. <span style="text-decoration: underline;">5</span>346.       0          0       0.103    455</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>004     -<span style="color: #BB0000;">126.</span>     48.3  738. <span style="text-decoration: underline;">5</span>355.       0          0       0.116    171</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>004     -<span style="color: #BB0000;">126.</span>     48.3  749. <span style="text-decoration: underline;">5</span>354.       1        221.      0.122    137</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>004     -<span style="color: #BB0000;">126.</span>     48.4  744. <span style="text-decoration: underline;">5</span>362.       1        440.      0.096<span style="text-decoration: underline;">4</span>   140</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>004     -<span style="color: #BB0000;">126.</span>     48.4  737. <span style="text-decoration: underline;">5</span>362.       1         48.2     0.122    145</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ‚Ñπ 1 more variable: log_depth &lt;dbl&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_mesh.html">make_mesh</a></span><span class="op">(</span><span class="va">dogfish</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, cutoff <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a-conventional-delta-gamma-model">A conventional delta-gamma model:<a class="anchor" aria-label="anchor" href="#a-conventional-delta-gamma-model"></a>
</h3>
<p>First, lets fit a conventional delta-gamma model with logit and log
links and illustrate a limitation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_dg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span><span class="va">catch_weight</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">log_depth</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">delta_gamma</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  spatial <span class="op">=</span> <span class="st">"on"</span>,</span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dogfish</span>,</span>
<span>  anisotropy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  reml <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dogfish</span><span class="op">$</span><span class="va">area_swept</span><span class="op">)</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sanity.html">sanity</a></span><span class="op">(</span><span class="va">fit_dg</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> Non-linear minimizer suggests successful convergence</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> Hessian matrix is positive definite</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> No extreme or very small eigenvalues detected</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> No gradients with respect to fixed effects are &gt;= 0.001</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> No fixed-effect standard errors are NA</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> No standard errors look unreasonably large</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> No sigma parameters are &lt; 0.01</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> No sigma parameters are &gt; 100</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> Range parameters don't look unreasonably large</span></span></code></pre></div>
<p>How can we show the effect of depth on catch weight? There is no one
curve, because the two components use different links (logit + log), so
there is a different catch-weight to depth relationship depending on
what the expected catch weight is from other coefficients (here year but
also for a given point in space because of the spatial random
field).</p>
<p>For example, here is how the curves look for different years:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  log_depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">dogfish</span><span class="op">$</span><span class="va">log_depth</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dogfish</span><span class="op">$</span><span class="va">log_depth</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>,</span>
<span>  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dogfish</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_dg</span>, newdata <span class="op">=</span> <span class="va">nd</span>, re_form <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">log_depth</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">est1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">est2</span><span class="op">)</span><span class="op">)</span>, colour <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"log expected catch weight"</span><span class="op">)</span></span></code></pre></div>
<p><img src="poisson-link_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" width="480"></p>
<p>There is no one curve! It depends on the value of year and for every
point in space that has a different random field value.</p>
</div>
<div class="section level3">
<h3 id="a-poisson-link-delta-gamma-alternative">A Poisson-link-delta-gamma alternative<a class="anchor" aria-label="anchor" href="#a-poisson-link-delta-gamma-alternative"></a>
</h3>
<p>Instead, let‚Äôs fit a Poisson-link delta-gamma model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_dpg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span><span class="va">catch_weight</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">log_depth</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">delta_gamma</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"poisson-link"</span><span class="op">)</span>,</span>
<span>  spatial <span class="op">=</span> <span class="st">"on"</span>,</span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dogfish</span>,</span>
<span>  anisotropy <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  reml <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dogfish</span><span class="op">$</span><span class="va">area_swept</span><span class="op">)</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sanity.html">sanity</a></span><span class="op">(</span><span class="va">fit_dpg</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> Non-linear minimizer suggests successful convergence</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> Hessian matrix is positive definite</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> No extreme or very small eigenvalues detected</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> No gradients with respect to fixed effects are &gt;= 0.001</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> No fixed-effect standard errors are NA</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> No standard errors look unreasonably large</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> No sigma parameters are &lt; 0.01</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">‚úî</span> No sigma parameters are &gt; 100</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_dpg</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spatial model fit by REML ['sdmTMB']</span></span>
<span><span class="co">#&gt; Formula: catch_weight ~ 0 + as.factor(year) + s(log_depth)</span></span>
<span><span class="co">#&gt; Mesh: mesh (anisotropic covariance)</span></span>
<span><span class="co">#&gt; Data: dogfish</span></span>
<span><span class="co">#&gt; Family: delta_gamma(link1 = 'log', link2 = 'log', type = 'poisson-link')</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Delta/hurdle model 1: -----------------------------------</span></span>
<span><span class="co">#&gt; Family: binomial(link = 'log') </span></span>
<span><span class="co">#&gt; Conditional model:</span></span>
<span><span class="co">#&gt;                     coef.est coef.se</span></span>
<span><span class="co">#&gt; as.factor(year)2004     1.96    0.77</span></span>
<span><span class="co">#&gt; as.factor(year)2006     2.89    0.77</span></span>
<span><span class="co">#&gt; as.factor(year)2008     2.57    0.76</span></span>
<span><span class="co">#&gt; as.factor(year)2010     2.43    0.77</span></span>
<span><span class="co">#&gt; as.factor(year)2012     1.94    0.76</span></span>
<span><span class="co">#&gt; as.factor(year)2014     1.93    0.76</span></span>
<span><span class="co">#&gt; as.factor(year)2016     2.20    0.76</span></span>
<span><span class="co">#&gt; as.factor(year)2018     2.03    0.76</span></span>
<span><span class="co">#&gt; as.factor(year)2021     1.18    0.76</span></span>
<span><span class="co">#&gt; as.factor(year)2022     1.75    0.76</span></span>
<span><span class="co">#&gt; slog_depth              0.15    0.54</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Smooth terms:</span></span>
<span><span class="co">#&gt;                  Std. Dev.</span></span>
<span><span class="co">#&gt; sd__s(log_depth)      2.38</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Mat√©rn anisotropic range (spatial): 26.1 to 381.1 at 142 deg.</span></span>
<span><span class="co">#&gt; Spatial SD: 1.18</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Delta/hurdle model 2: -----------------------------------</span></span>
<span><span class="co">#&gt; Family: Gamma(link = 'log') </span></span>
<span><span class="co">#&gt; Conditional model:</span></span>
<span><span class="co">#&gt;                     coef.est coef.se</span></span>
<span><span class="co">#&gt; as.factor(year)2004     3.59    0.37</span></span>
<span><span class="co">#&gt; as.factor(year)2006     2.78    0.33</span></span>
<span><span class="co">#&gt; as.factor(year)2008     2.47    0.32</span></span>
<span><span class="co">#&gt; as.factor(year)2010     3.50    0.34</span></span>
<span><span class="co">#&gt; as.factor(year)2012     2.77    0.33</span></span>
<span><span class="co">#&gt; as.factor(year)2014     2.45    0.33</span></span>
<span><span class="co">#&gt; as.factor(year)2016     2.09    0.32</span></span>
<span><span class="co">#&gt; as.factor(year)2018     2.60    0.32</span></span>
<span><span class="co">#&gt; as.factor(year)2021     1.69    0.33</span></span>
<span><span class="co">#&gt; as.factor(year)2022     1.98    0.33</span></span>
<span><span class="co">#&gt; slog_depth             -0.20    0.82</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Smooth terms:</span></span>
<span><span class="co">#&gt;                  Std. Dev.</span></span>
<span><span class="co">#&gt; sd__s(log_depth)      5.09</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dispersion parameter: 0.59</span></span>
<span><span class="co">#&gt; Mat√©rn anisotropic range (spatial): 4.2 to 60.8 at 142 deg.</span></span>
<span><span class="co">#&gt; Spatial SD: 1.97</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; REML criterion at convergence: 5851.613</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; See ?tidy.sdmTMB to extract these values as a data frame.</span></span>
<span><span class="co">#&gt; See ?plot_anisotropy to plot the anisotropic range.</span></span></code></pre></div>
<p>and make the same plot:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_dpg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_dpg</span>, newdata <span class="op">=</span> <span class="va">nd</span>, re_form <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">p_dpg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">log_depth</span>, <span class="va">est1</span> <span class="op">+</span> <span class="va">est2</span>, colour <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"log expected catch weight"</span><span class="op">)</span></span></code></pre></div>
<p><img src="poisson-link_files/figure-html/unnamed-chunk-9-1.png" class="r-plt" width="480"></p>
<p>Note how the lines are now parallel. Other predictors shift the curve
up and down but do not affect the shape of the combined prediction
because both use a log link.</p>
<!-- TODO fix link in component 1 print -->
</div>
<div class="section level3">
<h3 id="examining-the-model-components-and-how-they-combine">Examining the model components and how they combine<a class="anchor" aria-label="anchor" href="#examining-the-model-components-and-how-they-combine"></a>
</h3>
<p>We‚Äôll make some predictions across depths but for a single year for
simplicity:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd2010</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">nd</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">2010</span><span class="op">)</span></span>
<span><span class="va">p_pdg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_dpg</span>, newdata <span class="op">=</span> <span class="va">nd2010</span>, re_form <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<!-- TODO fix predict response vs. not on re_form = NA!!!!!!!!!!!!!!!!! -->
<p>We can extract the components of our theoretical deconstruction of
catch into group <strong>n</strong>umbers density,
<strong>w</strong>eight per group, encounter
<strong>p</strong>robability, and positive <strong>r</strong>ate:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">p_pdg</span><span class="op">$</span><span class="va">est1</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">p_pdg</span><span class="op">$</span><span class="va">est2</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">w</span><span class="op">)</span> <span class="op">/</span> <span class="va">p</span></span></code></pre></div>
<p>We can come up with our overall predictions in two ways:</p>
<ol style="list-style-type: decimal">
<li><p><code>n * w</code>: group numbers
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>√ó</mo><annotation encoding="application/x-tex">\times</annotation></semantics></math>
weight per group. This is equivalently <code>exp(est1 + est2)</code>,
where <code>est1</code> and <code>est2</code> are the linear predictors
in link space.</p></li>
<li><p><code>p * r</code>: encounter probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>√ó</mo><annotation encoding="application/x-tex">\times</annotation></semantics></math>
positive catch rate.</p></li>
</ol>
<p>These give identical answers:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">p</span> <span class="op">*</span> <span class="va">r</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">w</span>, <span class="va">p</span> <span class="op">*</span> <span class="va">r</span>, xlim <span class="op">=</span> <span class="va">lims</span>, ylim <span class="op">=</span> <span class="va">lims</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="poisson-link_files/figure-html/unnamed-chunk-12-1.png" class="r-plt" width="384"></p>
<p>Let‚Äôs plot out all the components and possible combinations:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">p_pdg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">log_depth</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Expected group density"</span><span class="op">)</span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">p_pdg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">log_depth</span>, <span class="va">w</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Expected weight per group"</span><span class="op">)</span></span>
<span><span class="va">g3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">p_pdg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">log_depth</span>, <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Expected encounter probability"</span><span class="op">)</span></span>
<span><span class="va">g4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">p_pdg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">log_depth</span>, <span class="va">r</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Expected catch given encounter"</span><span class="op">)</span></span>
<span><span class="va">g5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">p_pdg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">log_depth</span>, <span class="va">n</span> <span class="op">*</span> <span class="va">w</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Expected catch"</span><span class="op">)</span></span>
<span><span class="va">g6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">p_pdg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">log_depth</span>, <span class="va">p</span> <span class="op">*</span> <span class="va">r</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Expected catch"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>, <span class="va">g3</span>, <span class="va">g4</span>, <span class="va">g5</span>, <span class="va">g6</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="poisson-link_files/figure-html/unnamed-chunk-13-1.png" class="r-plt" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="faq">FAQ<a class="anchor" aria-label="anchor" href="#faq"></a>
</h2>
<div class="section level3">
<h3 id="what-is-a-group-and-how-does-the-model-know-about-numbers">What is a ‚Äògroup‚Äô and how does the model know about numbers!?<a class="anchor" aria-label="anchor" href="#what-is-a-group-and-how-does-the-model-know-about-numbers"></a>
</h3>
<p>The model represents a process in which groups of fish (or other
observations, of course) are encountered in certain numbers (‚Äúgroup
<strong>n</strong>umbers density‚Äù) and each group is of a certain weight
(‚Äú<strong>w</strong>eight per group‚Äù).</p>
<p>This is a theoretical construct reflecting how the model can best
parse the two components according to the properties of the observed
data. Since the predicted response value is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>‚ãÖ</mo><mi>w</mi></mrow><annotation encoding="application/x-tex">n \cdot w</annotation></semantics></math>,
you can get to the same value by multiplying
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
and dividing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math>
by the same amount. You could have more numbers and less weight per
group or fewer numbers and more weight per group and get to the same
place. However, there is a balance of the two, given covariates and
random effects, that best fits the data when entered into the likelihood
as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="what-is-the-connection-to-the-complementary-log-log-link-cloglog-and-the-poisson">What is the connection to the complementary log-log link (‚Äòcloglog‚Äô)
and the Poisson?<a class="anchor" aria-label="anchor" href="#what-is-the-connection-to-the-complementary-log-log-link-cloglog-and-the-poisson"></a>
</h3>
<p>From <a href="https://en.wikipedia.org/wiki/Generalized_linear_model" class="external-link">Wikipedia</a>:
‚ÄúThe cloglog model corresponds to applications where we observe either
zero events (e.g., defects) or one or more, where the number of events
is assumed to follow the Poisson distribution.‚Äù The following is based
around this entry.</p>
<p>The Poisson assumes that the probability of observing a zero given
expected number
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚àí</mo><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\exp(-n)</annotation></semantics></math>.
I.e.,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">P</mi><mi mathvariant="normal">r</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚àí</mo><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\mathrm{Pr}(0) = \exp(-n)
</annotation></semantics></math> If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
is the probability of observing a non-zero (i.e., an encounter),
then</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚àí</mo><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>‚àí</mo><mi>p</mi><mo>=</mo><mrow><mi mathvariant="normal">P</mi><mi mathvariant="normal">r</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\exp(-n) = 1 - p = \mathrm{Pr}(0).
</annotation></semantics></math></p>
<p>We can re-arrange that as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mo>‚àí</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
n = -\log(1 - p).
</annotation></semantics></math></p>
<p>And since we want our linear predictor to take values from negative
to positive infinity (and therefore keep our predicted number densities
positive after exponentiating them), we work in log space:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚àí</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\log (n) = \log(-\log(1 - p)).
</annotation></semantics></math></p>
<p>The right side is known as the ‚Äòcloglog‚Äô link function.</p>
<p>This link has the following inverse link function:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>1</mn><mo>‚àí</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚àí</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
p = 1 - \exp(-\exp(\log n)).
</annotation></semantics></math></p>
<p>We can check this in R:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">0.78</span></span>
<span><span class="va">log_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">log_n</span></span>
<span><span class="co">#&gt; [1] 0.4148395</span></span>
<span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.78</span></span></code></pre></div>
<p>You can see how the cloglog inverse link is the same as the first
part of our Poisson-link delta model. <strong>However</strong>, the
‚Äòtrick‚Äô here is that group density
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
affects both encounter probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
(as shown above) <em>and</em> positive catch rates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mfrac><mrow><mi>n</mi><mi>w</mi></mrow><mi>p</mi></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
r = \frac{n w}{p}.
</annotation></semantics></math></p>
<p>So, when going from the linear predictors (which have log links) to
the expected values going into the data likelihood (binomial +
lognormal/gamma), the first linear predictor plays double duty in that
it appears in both delta model expected values.</p>
</div>
<div class="section level3">
<h3 id="what-are-the-advantages-of-using-such-a-model">What are the advantages of using such a model?<a class="anchor" aria-label="anchor" href="#what-are-the-advantages-of-using-such-a-model"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>The poisson-link families have the flexibility of a delta model,
which in practice is often helpful for better predictions. This could be
checked with AIC, or better yet, cross validation.</p></li>
<li><p>Like other delta models, there is a decomposition of the process
into two theoretical parts. This can help interpretation (or can make
things more complicated to interpret!). Here, these parts can be
rearranged to represent two ways of thinking about those two components
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>).</p></li>
<li><p>Compared to a traditional delta-gamma model that has a logit and
log link, the two linear predictors have log links, so their
coefficients are interpretable as multiplicative effects, and their
effects can be combined. E.g., their coefficients can be added in log
space or their predictions can be added in log space to generate a
single response curve for a given predictor.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="where-does-the-offset-come-in">Where does the offset come in?<a class="anchor" aria-label="anchor" href="#where-does-the-offset-come-in"></a>
</h3>
<p>The offset is added to the linear predictor for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">\log n</annotation></semantics></math>,
i.e., <code>exp(offset) * n</code>. For example if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>
represents area swept (a measure of effort) and log area swept is
entered into the model as the ‚Äòoffset‚Äô, then,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>1</mn><mo>‚àí</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚àí</mo><mi>a</mi><mo>‚ãÖ</mo><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
p = 1 - \exp(-a \cdot n).
</annotation></semantics></math></p>
<p>Therefore, the encounter probability goes to 1 as area swept (effort)
and underlying group numbers density increase towards infinity. This
gets carried over to the positive rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
via
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mi>n</mi><mi>w</mi><mi>/</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">r = nw/p</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="why-call-it-a-poisson-link">Why call it a Poisson-link?<a class="anchor" aria-label="anchor" href="#why-call-it-a-poisson-link"></a>
</h3>
<p>I can only guess. The cloglog function is derived from the theory of
a Poisson and although the cloglog function appears in the
‚ÄòPoisson-link‚Äô model, the interaction of the two model components makes
it different from a pure cloglog and so I assume it needed another
name.</p>
</div>
<div class="section level3">
<h3 id="these-equations-dont-look-anything-like-the-sdmtmb-source-code">These equations don‚Äôt look anything like the sdmTMB source
code!<a class="anchor" aria-label="anchor" href="#these-equations-dont-look-anything-like-the-sdmtmb-source-code"></a>
</h3>
<p>That‚Äôs because the calculations have to be done in log space for
computational stability and some calculations are fastest and most
stable if done slightly differently from how they are most easily
described in equations above.</p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-thorson2018poisson" class="csl-entry">
Thorson, J.T. (2018). <a href="https://doi.org/10.1139/cjfas-2017-0266" class="external-link">Three problems with the
conventional delta-model for biomass sampling data, and a
computationally efficient alternative</a>. <em>Canadian Journal of
Fisheries and Aquatic Sciences</em>, <strong>75</strong>, 1369‚Äì1382.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean C. Anderson, Eric J. Ward, Philina A. English, Lewis A. K. Barnett, James T. Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
