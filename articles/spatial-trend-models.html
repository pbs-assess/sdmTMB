<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fitting spatial trend models with sdmTMB • sdmTMB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting spatial trend models with sdmTMB">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sdmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.4.9024</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sdmTMB/sdmTMB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fitting spatial trend models with sdmTMB</h1>
            
            <h4 data-toc-skip class="date">2025-11-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sdmTMB/sdmTMB/blob/main/vignettes/articles/spatial-trend-models.Rmd" class="external-link"><code>vignettes/articles/spatial-trend-models.Rmd</code></a></small>
      <div class="d-none name"><code>spatial-trend-models.Rmd</code></div>
    </div>

    
    
<p><strong>If the code in this vignette has not been evaluated, a
rendered version is available on the <a href="https://sdmTMB.github.io/sdmTMB/index.html">documentation site</a>
under ‘Articles’.</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sdmTMB.github.io/sdmTMB/">sdmTMB</a></span><span class="op">)</span></span></code></pre></div>
<p>Using the built-in British Columbia Queen Charlotte Sound Pacific Cod
dataset, we might be interested in fitting a model that describes
spatially varying trends through time. The data are as follows:</p>
<ul>
<li>There are columns for depth and depth squared.</li>
<li>Depth was centred and scaled by its standard deviation and we’ve
included those in the data frame so that they could be used to similarly
scale the prediction grid.</li>
<li>The density units should be kg/km<sup>2</sup>.</li>
<li>Here, X and Y are coordinates in UTM zone 9.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pcod_spde</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_mesh.html">make_mesh</a></span><span class="op">(</span><span class="va">pcod</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, cutoff <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pcod_spde</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial-trend-models_files/figure-html/unnamed-chunk-1-1.png" class="r-plt" width="672"></p>
<p>We will fit a model that includes an overall intercept, a slope for
‘year’, an intercept spatial random field, and another random field for
spatially varying slopes that represent temporal trends that vary
spatially (<code>spatial_varying</code> argument).</p>
<p>First, we will set up a column for time that is centered to help
break correlation with the intercept and help estimation (and
interpretation of the intercept) and we will scale the year values so
that a unit of change is a decade instead of a year. This is likely more
interpretable and can help with estimation by keeping the coefficients
on a reasonable scale.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">pcod</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">scaled_year</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">pcod</span><span class="op">$</span><span class="va">year</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">scaled_year</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.64022399 -0.54022399 -0.44022399 -0.24022399 -0.04022399  0.15977601</span></span>
<span><span class="co">#&gt; [7]  0.35977601  0.55977601  0.75977601</span></span></code></pre></div>
<p>Now we will fit a model using
<code>spatial_varying ~ 0 + scaled_year</code>. The <code>0 +</code>
drops the intercept, which is already present due to
<code>spatial = "on"</code>, which is the default.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span></span>
<span>  <span class="va">density</span> <span class="op">~</span> <span class="va">scaled_year</span>, </span>
<span>  data <span class="op">=</span> <span class="va">d</span>,</span>
<span>  mesh <span class="op">=</span> <span class="va">pcod_spde</span>, </span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,</span>
<span>  spatial <span class="op">=</span> <span class="st">"on"</span>,</span>
<span>  spatial_varying <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">scaled_year</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spatial model fit by ML ['sdmTMB']</span></span>
<span><span class="co">#&gt; Formula: density ~ scaled_year</span></span>
<span><span class="co">#&gt; Mesh: pcod_spde (isotropic covariance)</span></span>
<span><span class="co">#&gt; Data: d</span></span>
<span><span class="co">#&gt; Family: tweedie(link = 'log')</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Conditional model:</span></span>
<span><span class="co">#&gt;             coef.est coef.se</span></span>
<span><span class="co">#&gt; (Intercept)     2.26    0.33</span></span>
<span><span class="co">#&gt; scaled_year    -0.06    0.21</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dispersion parameter: 11.77</span></span>
<span><span class="co">#&gt; Tweedie p: 1.52</span></span>
<span><span class="co">#&gt; Matérn range: 20.50</span></span>
<span><span class="co">#&gt; Spatial SD: 2.40</span></span>
<span><span class="co">#&gt; Spatially varying coefficient SD (scaled_year): 1.23</span></span>
<span><span class="co">#&gt; ML criterion at convergence: 6406.405</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; See ?tidy.sdmTMB to extract these values as a data frame.</span></span>
<span><span class="fu"><a href="../reference/sanity.html">sanity</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Non-linear minimizer suggests successful convergence</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Hessian matrix is positive definite</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No extreme or very small eigenvalues detected</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No gradients with respect to fixed effects are &gt;= 0.001</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No fixed-effect standard errors are NA</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No standard errors look unreasonably large</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No sigma parameters are &lt; 0.01</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No sigma parameters are &gt; 100</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Range parameter doesn't look unreasonably large</span></span></code></pre></div>
<p>We have not included spatiotemporal random fields for this example
for simplicity, but they could also be included.</p>
<p>Let’s extract some parameter estimates. Look for <code>sigma_Z</code>
coefficients:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">fit</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   term        estimate std.error conf.low conf.high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (Intercept)   2.26       0.326    1.62      2.90 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> scaled_year  -<span style="color: #BB0000;">0.063</span><span style="color: #BB0000; text-decoration: underline;">2</span>     0.205   -<span style="color: #BB0000;">0.465</span>     0.339</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"ran_pars"</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 5</span></span></span>
<span><span class="co">#&gt;   term      estimate std.error conf.low conf.high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> range        20.5     2.49     16.2       26.0 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> phi          11.8     0.394    11.0       12.6 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> sigma_O       2.40    0.175     2.08       2.76</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> sigma_Z       1.23    0.180     0.925      1.64</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> tweedie_p     1.52    0.011<span style="text-decoration: underline;">1</span>    1.50       1.54</span></span></code></pre></div>
<p>Let’s look at the predictions and estimates of the spatially varying
coefficients on a grid. First, we will create a small function to help
with plotting:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_map_raster</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>, <span class="va">column</span> <span class="op">=</span> <span class="va">est</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, fill <span class="op">=</span> <span class="op">{</span><span class="op">{</span> <span class="va">column</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We need to predict on a grid to make our visualizations. We also need
to add a column for <code>scaled_year</code> to match the fitting. Make
sure you scale based on the same values! Here, that means using the mean
from our fitted data and turning years into decades.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/replicate_df.html">replicate_df</a></span><span class="op">(</span><span class="va">qcs_grid</span>, <span class="st">"year"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nd</span><span class="op">$</span><span class="va">scaled_year</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">nd</span><span class="op">$</span><span class="va">year</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">nd</span><span class="op">)</span></span></code></pre></div>
<p>Let’s look at the spatial trends. The <code>zeta_s_scaled_year</code>
in the predictions are values from a random field describing deviations
from the overall effect of <code>year_scaled</code> on species density.
These are in link (log) space. These are the spatially varying
coefficients.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_map_raster</span><span class="op">(</span><span class="va">pred</span>, <span class="va">zeta_s_scaled_year</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial-trend-models_files/figure-html/unnamed-chunk-8-1.png" class="r-plt" width="672"></p>
<p>If we wanted to get at the actual slope of <code>scaled_year</code>
in space, we would also have to add on the main overall (fixed effect)
coefficient.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">fit</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">scaled_year_coef</span> <span class="op">&lt;-</span> <span class="va">coefs</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="va">coefs</span><span class="op">$</span><span class="va">term</span> <span class="op">==</span> <span class="st">"scaled_year"</span><span class="op">]</span></span>
<span><span class="va">scaled_year_coef</span></span>
<span><span class="co">#&gt; [1] -0.0632089</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">scaled_year_coef</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9387474</span></span></code></pre></div>
<p>Our main effect tells us that the overall linear trend of density has
been a multiplicative factor of 0.94 per decade. Conversely, the overall
trend has been a decline of 6% per decade.</p>
<p>We can add this overall effect to the spatial deviations from this
effect to get the spatially varying trend:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_map_raster</span><span class="op">(</span><span class="va">pred</span>, <span class="va">scaled_year_coef</span> <span class="op">+</span> <span class="va">zeta_s_scaled_year</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial-trend-models_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" width="672"></p>
<p>We could put those slopes back into natural space:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_map_raster</span><span class="op">(</span><span class="va">pred</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">scaled_year_coef</span> <span class="op">+</span> <span class="va">zeta_s_scaled_year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>midpoint <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">fill</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">fill</span>, which will replace the existing scale.</span></span></code></pre></div>
<p><img src="spatial-trend-models_files/figure-html/unnamed-chunk-11-1.png" class="r-plt" width="672"></p>
<p>Here, 2, for example, means a 2-fold change in density in that
location per decade.</p>
<p>We might prefer to log transform the color scale. This gets us back
to the plot in log space but with values on the colour legend that
represent (multiplicative) values in natural space.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_map_raster</span><span class="op">(</span><span class="va">pred</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">scaled_year_coef</span> <span class="op">+</span> <span class="va">zeta_s_scaled_year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>midpoint <span class="op">=</span> <span class="fl">0</span>, trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">fill</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">fill</span>, which will replace the existing scale.</span></span></code></pre></div>
<p><img src="spatial-trend-models_files/figure-html/unnamed-chunk-12-1.png" class="r-plt" width="672"></p>
<p>The fastest way to get uncertainty on this spatially varying
coefficient is with draws from the joint precision matrix of the
parameters:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">82938</span><span class="op">)</span></span>
<span><span class="va">psim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">nd</span>, nsim <span class="op">=</span> <span class="fl">200</span>, sims_var <span class="op">=</span> <span class="st">"zeta_s"</span><span class="op">)</span></span>
<span><span class="va">pred</span><span class="op">$</span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">psim</span>, <span class="fl">1</span>, <span class="va">sd</span><span class="op">)</span></span>
<span><span class="fu">plot_map_raster</span><span class="op">(</span><span class="va">pred</span>, <span class="va">se</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial-trend-models_files/figure-html/unnamed-chunk-13-1.png" class="r-plt" width="672"></p>
<p>We can see a visual pattern of the SPDE mesh in this plot. The
uncertainty standard error is most accurate at the nodes (vertices,
knots) of the mesh.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean C. Anderson, Eric J. Ward, Philina A. English, Lewis A. K. Barnett, James T. Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
