<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Zero-one-inflated beta (ZOIB) models with sdmTMB ‚Ä¢ sdmTMB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Zero-one-inflated beta (ZOIB) models with sdmTMB">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sdmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.4.9024</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sdmTMB/sdmTMB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Zero-one-inflated beta (ZOIB) models with sdmTMB</h1>
                        <h4 data-toc-skip class="author">Sean
Anderson</h4>
            
            <h4 data-toc-skip class="date">2025-11-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sdmTMB/sdmTMB/blob/main/vignettes/articles/zoib.Rmd" class="external-link"><code>vignettes/articles/zoib.Rmd</code></a></small>
      <div class="d-none name"><code>zoib.Rmd</code></div>
    </div>

    
    
<p><strong>If the code in this vignette has not been evaluated, a
rendered version is available on the <a href="https://sdmTMB.github.io/sdmTMB/index.html">documentation site</a>
under ‚ÄòArticles‚Äô.</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sdmTMB.github.io/sdmTMB/">sdmTMB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Zero-one-inflated beta (ZOIB) models are used for modeling
proportional data (values bounded between 0 and 1) that include excess
zeros and/or ones beyond what would be expected from a standard beta
distribution. These models are useful for analyzing data such as:</p>
<ul>
<li>Species abundance as a proportion of maximum capacity</li>
<li>Habitat suitability indices</li>
<li>Proportional cover data in ecology</li>
<li>Any other response variable that is a true proportion with potential
inflation at the boundaries</li>
</ul>
<p>A ZOIB model consists of three components:</p>
<ol style="list-style-type: decimal">
<li>A <strong>zero component</strong>: models the probability of a zero
value (typically using a binomial/logit model)</li>
<li>A <strong>one component</strong>: models the probability of a one
value (typically using a binomial/logit model)</li>
<li>A <strong>proportion component</strong>: models the continuous
proportion between 0 and 1 (typically using a beta distribution)</li>
</ol>
<p>The final prediction combines all three components:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>p</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>√ó</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mn>1</mn></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>p</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>√ó</mo><mi>Œº</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{E}[Y] = (1 - p_0) \times (p_1 + (1 - p_1) \times \mu)</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mn>0</mn></msub><annotation encoding="application/x-tex">p_0</annotation></semantics></math>
is the probability of zero,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mn>1</mn></msub><annotation encoding="application/x-tex">p_1</annotation></semantics></math>
is the probability of one (given not zero), and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œº</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
is the expected proportion from the beta component.</p>
<p>Currently, sdmTMB does not have a built-in ZOIB family. However, ZOIB
models can be implemented by fitting three separate models and combining
their predictions. This vignette demonstrates this approach.</p>
</div>
<div class="section level2">
<h2 id="simulating-zoib-data">Simulating ZOIB data<a class="anchor" aria-label="anchor" href="#simulating-zoib-data"></a>
</h2>
<p>Let‚Äôs simulate data from a ZOIB process to illustrate how to fit
these models in sdmTMB.</p>
<p>First, we‚Äôll set up the parameters for our simulation:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">800</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Coefficients for the zero component (logit scale)</span></span>
<span><span class="va">b_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Coefficients for the one component (logit scale)</span></span>
<span><span class="va">b_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0.6</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Coefficients for the proportion component (logit scale for mean)</span></span>
<span><span class="va">b_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Precision parameter for beta distribution</span></span>
<span><span class="va">phi</span> <span class="op">&lt;-</span> <span class="fl">30</span></span></code></pre></div>
<p>Now we‚Äôll simulate the three components:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Zero component: probability of observing a zero</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">b_0</span><span class="op">)</span></span>
<span><span class="va">y_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># One component: probability of observing a one (given not zero)</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">b_1</span><span class="op">)</span></span>
<span><span class="va">y_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="va">q</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Proportion component: beta-distributed values between 0 and 1</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">b_prop</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">phi</span> <span class="op">*</span> <span class="va">mu</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">phi</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">mu</span><span class="op">)</span></span>
<span><span class="va">y_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we combine the components to create the ZOIB response:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span>length <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="va">y_p</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="va">y_p</span> <span class="op">!=</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">y_q</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="va">y_p</span> <span class="op">!=</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">y_q</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">y_r</span><span class="op">[</span><span class="va">y_p</span> <span class="op">!=</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">y_q</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predictor"</span>, y <span class="op">=</span> <span class="st">"Response (proportion)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="zoib_files/figure-html/simulate-combine-1.png" class="r-plt" width="672"></p>
<p>The plot shows the characteristic ZOIB pattern: data concentrated at
0 and 1, with continuous values between.</p>
</div>
<div class="section level2">
<h2 id="fitting-the-zoib-model-components">Fitting the ZOIB model components<a class="anchor" aria-label="anchor" href="#fitting-the-zoib-model-components"></a>
</h2>
<p>To fit a ZOIB model with sdmTMB, we fit three separate models and
combine their predictions.</p>
<p>First, we prepare the data for each component:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Zero component: 1 if zero, 0 otherwise</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">y_zero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># One component: 1 if one, 0 if between 0 and 1, NA if zero</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">y_one</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">dat</span><span class="op">$</span><span class="va">y</span> <span class="op">!=</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Proportion component: the value itself, but only for values between 0 and 1</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">y_proportion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">dat</span><span class="op">$</span><span class="va">y</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="va">dat</span><span class="op">$</span><span class="va">y</span>, <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p>Now we fit the three models. In this example, we turn off spatial
effects with <code>spatial = "off"</code>, but in practice you could
include spatial and spatiotemporal random fields in any or all of the
components:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model 1: Zero component</span></span>
<span><span class="va">fit_zero</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span></span>
<span>  <span class="va">y_zero</span> <span class="op">~</span> <span class="va">x</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  spatial <span class="op">=</span> <span class="st">"off"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model 2: One component (excluding zeros)</span></span>
<span><span class="va">fit_one</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span></span>
<span>  <span class="va">y_one</span> <span class="op">~</span> <span class="va">x</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y_one</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  spatial <span class="op">=</span> <span class="st">"off"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model 3: Proportion component (values between 0 and 1)</span></span>
<span><span class="va">fit_proportion</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span></span>
<span>  <span class="va">y_proportion</span> <span class="op">~</span> <span class="va">x</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y_proportion</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">Beta</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  spatial <span class="op">=</span> <span class="st">"off"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let‚Äôs check how well we recovered the simulation parameters:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Zero component coefficients</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_zero</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)           x </span></span>
<span><span class="co">#&gt;  -0.8702097  -0.4254690</span></span>
<span><span class="va">b_0</span></span>
<span><span class="co">#&gt; [1] -1.0 -0.4</span></span>
<span></span>
<span><span class="co"># One component coefficients</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_one</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)           x </span></span>
<span><span class="co">#&gt;  -1.0390158   0.7738772</span></span>
<span><span class="va">b_1</span></span>
<span><span class="co">#&gt; [1] -1.0  0.6</span></span>
<span></span>
<span><span class="co"># Proportion component coefficients</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_proportion</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)           x </span></span>
<span><span class="co">#&gt;   0.2114247   0.4901013</span></span>
<span><span class="va">b_prop</span></span>
<span><span class="co">#&gt; [1] 0.2 0.5</span></span>
<span></span>
<span><span class="co"># Precision parameter</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">fit_proportion</span>, <span class="st">"ran_pars"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 √ó 5</span></span></span>
<span><span class="co">#&gt;   term  estimate std.error conf.low conf.high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> phi       29.6      2.09     25.8      34.0</span></span>
<span><span class="va">phi</span></span>
<span><span class="co">#&gt; [1] 30</span></span></code></pre></div>
<p>The estimated coefficients should be close to the true values used in
the simulation.</p>
</div>
<div class="section level2">
<h2 id="making-predictions">Making predictions<a class="anchor" aria-label="anchor" href="#making-predictions"></a>
</h2>
<p>To make predictions from a ZOIB model, we need to:</p>
<ol style="list-style-type: decimal">
<li>Generate predictions from each component</li>
<li>Combine them using the ZOIB formula</li>
</ol>
<p>First, create a new data frame for prediction:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="point-predictions">Point predictions<a class="anchor" aria-label="anchor" href="#point-predictions"></a>
</h3>
<p>Generate point predictions from each component and combine:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get predictions on the response scale (probabilities/proportions)</span></span>
<span><span class="va">p0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_zero</span>, newdata <span class="op">=</span> <span class="va">nd</span><span class="op">)</span><span class="op">$</span><span class="va">est</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_one</span>, newdata <span class="op">=</span> <span class="va">nd</span><span class="op">)</span><span class="op">$</span><span class="va">est</span><span class="op">)</span></span>
<span><span class="va">pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_proportion</span>, newdata <span class="op">=</span> <span class="va">nd</span><span class="op">)</span><span class="op">$</span><span class="va">est</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine using ZOIB formula: E[Y] = (1 - p0) * (p1 + (1 - p1) * pp)</span></span>
<span><span class="va">nd</span><span class="op">$</span><span class="va">est</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p0</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">p1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p1</span><span class="op">)</span> <span class="op">*</span> <span class="va">pp</span><span class="op">)</span></span></code></pre></div>
<p>Plot the predictions:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">est</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">nd</span>, colour <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Predictor"</span>, y <span class="op">=</span> <span class="st">"Response (proportion)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"ZOIB model predictions"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="zoib_files/figure-html/plot-point-predictions-1.png" class="r-plt" width="672"></p>
</div>
<div class="section level3">
<h3 id="predictions-with-uncertainty">Predictions with uncertainty<a class="anchor" aria-label="anchor" href="#predictions-with-uncertainty"></a>
</h3>
<p>To incorporate parameter uncertainty, we use can use simulation-based
inference. The <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function with <code>nsim</code>
will draw from the joint precision matrix of the fixed effects and
random effects:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate simulation draws from each model</span></span>
<span><span class="va">p0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_zero</span>, newdata <span class="op">=</span> <span class="va">nd</span>, nsim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_one</span>, newdata <span class="op">=</span> <span class="va">nd</span>, nsim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_proportion</span>, newdata <span class="op">=</span> <span class="va">nd</span>, nsim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine the simulations</span></span>
<span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p0</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">p1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p1</span><span class="op">)</span> <span class="op">*</span> <span class="va">pp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate median and credible intervals</span></span>
<span><span class="va">nd</span><span class="op">$</span><span class="va">est2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">combined</span>, <span class="fl">1</span>, <span class="va">median</span><span class="op">)</span></span>
<span><span class="va">nd</span><span class="op">$</span><span class="va">lwr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">combined</span>, <span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span></span>
<span><span class="va">nd</span><span class="op">$</span><span class="va">upr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">combined</span>, <span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span></span></code></pre></div>
<p>Plot with uncertainty bands:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">nd</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, ymin <span class="op">=</span> <span class="va">lwr</span>, ymax <span class="op">=</span> <span class="va">upr</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">nd</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">est2</span><span class="op">)</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Predictor"</span>, y <span class="op">=</span> <span class="st">"Response (proportion)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"ZOIB predictions with 95% credible intervals"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="zoib_files/figure-html/plot-uncertainty-1.png" class="r-plt" width="672"></p>
<p>The red line shows the median prediction and the shaded region shows
the 95% credible interval accounting for parameter uncertainty.</p>
</div>
</div>
<div class="section level2">
<h2 id="comparison-with-the-zoib-package">Comparison with the zoib package<a class="anchor" aria-label="anchor" href="#comparison-with-the-zoib-package"></a>
</h2>
<p>For reference, we can compare our approach to the dedicated ZOIB
implementation in the <code>zoib</code> package, which uses Bayesian
methods:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.r-project.org" class="external-link">zoib</a></span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">zoib</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">|</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">x</span> <span class="op">|</span> <span class="va">x</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>  zero.inflation <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  one.inflation <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  joint <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n.iter <span class="op">=</span> <span class="fl">600</span>,</span>
<span>  n.thin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  n.burn <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract parameter estimates</span></span>
<span><span class="va">sample1</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">$</span><span class="va">coeff</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sample1</span>, quantiles <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare with our estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_proportion</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_zero</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_one</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate predictions</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu">pred.zoib</span><span class="op">(</span><span class="va">m</span>, xnew <span class="op">=</span> <span class="va">nd</span><span class="op">)</span></span>
<span><span class="va">nd2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nd</span><span class="op">$</span><span class="va">x</span>, zoib <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span>, <span class="st">"mean"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare predictions</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">est</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">nd</span>, colour <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">zoib</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">nd2</span>, colour <span class="op">=</span> <span class="st">"blue"</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Predictor"</span>, y <span class="op">=</span> <span class="st">"Response (proportion)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Comparison: sdmTMB (red) vs zoib package (blue)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>While sdmTMB does not currently have a built-in ZOIB family, this
three-model approach provides flexibility to:</p>
<ul>
<li>Include different predictors in each component</li>
<li>Add spatial/spatiotemporal random fields to any component</li>
<li>Use different spatial structures across components</li>
<li>Leverage all of sdmTMB‚Äôs modeling features for each piece</li>
</ul>
<p>The main limitation is that there is no built-in function to
calculate derived quantities like population indices with integrated
uncertainty across all three model components. However, the simulation
approach shown here can be extended to calculate any derived quantities
of interest.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean C. Anderson, Eric J. Ward, Philina A. English, Lewis A. K. Barnett, James T. Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
