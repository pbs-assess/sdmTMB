<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Cross-validation for model evaluation and comparison • sdmTMB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cross-validation for model evaluation and comparison">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sdmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.4.9024</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sdmTMB/sdmTMB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Cross-validation for model evaluation and comparison</h1>
            
            <h4 data-toc-skip class="date">2025-11-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sdmTMB/sdmTMB/blob/main/vignettes/articles/cross-validation.Rmd" class="external-link"><code>vignettes/articles/cross-validation.Rmd</code></a></small>
      <div class="d-none name"><code>cross-validation.Rmd</code></div>
    </div>

    
    
<p><strong>If the code in this vignette has not been evaluated, a
rendered version is available on the <a href="https://sdmTMB.github.io/sdmTMB/index.html">documentation site</a>
under ‘Articles’.</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sdmTMB.github.io/sdmTMB/">sdmTMB</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Cross-validation is one of the best approaches that can be used to
quantify model performance and compare sdmTMB models with different
structures (unlike AIC, this approach will also factor in uncertainty in
random effects). Arguably the most challenging decision in implementing
cross-validation is how to specify the folds (each fold representing a
subset of data that is in turn held out and used as a test set). Folds
may vary in number and how data are partitioned, and will likely be
slightly different for each application.</p>
<p>The goals of some sdmTMB applications may be focused on spatial
prediction; these include making prediction to new spatial regions
(e.g. unsampled areas or areas not sampled in every year). For these
types of models we recommend exploring folds using the
<code>blockCV</code> or <code>spatialsample</code> packages <span class="citation">(Valavi <em>et al.</em> 2019; Silge 2021)</span>. In
general, these spatial sampling approaches assign observations that are
spatially autocorrelated to the same fold. Accounting for the spatial
correlation can lead to better estimates of covariate effects, as well
as prediction errors.</p>
<p>Alternatively, the goals of an analysis with sdmTMB may be to
evaluate the predictive accuracy of a model in time (e.g. a missing
survey year, or prediction to future years). For retrospective analyses,
all points within a year may be assigned to a fold (or groups of years
to the same fold). In contrast, models that are forward looking would
use Leave Future Out Cross-Validation (LFOCV). In LFOCV, data up to year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
are used to predict observations at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t+1</annotation></semantics></math>,
etc.</p>
</div>
<div class="section level2">
<h2 id="cross-validation-in-sdmtmb">Cross validation in sdmTMB<a class="anchor" aria-label="anchor" href="#cross-validation-in-sdmtmb"></a>
</h2>
<p>Cross validation in sdmTMB is implemented using the
<code><a href="../reference/sdmTMB_cv.html">sdmTMB_cv()</a></code> function, with the <code>k_folds</code>
argument specifying the number of folds (defaults to 8). The function
uses parallelization by default a <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code> is set,
but this can be turned off with the <code>parallel</code> argument.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">)</span></span>
<span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_mesh.html">make_mesh</a></span><span class="op">(</span><span class="va">pcod</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, cutoff <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">pcod</span><span class="op">$</span><span class="va">fyear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set parallel processing if desired:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">m_cv</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="fu">::</span><span class="fu"><a href="../reference/sdmTMB_cv.html">sdmTMB_cv</a></span><span class="op">(</span></span>
<span>  <span class="va">density</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth_scaled</span><span class="op">)</span> <span class="op">+</span> <span class="va">fyear</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pcod</span>,</span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,</span>
<span>  k_folds <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running fits with `future.apply()`.</span></span>
<span><span class="co">#&gt; Set a parallel `future::plan()` to use parallel processing.</span></span></code></pre></div>
<p>In the above example, folds are assigned randomly—but these can be
modified to specific spatial or temporal applications. Without getting
into the complexities of the <code>blockCV</code> or
<code>spatialsample</code> packages, we could simply use
<code>kmeans</code> to generate spatial clusters, e.g.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">20</span><span class="op">)</span><span class="op">$</span><span class="va">cluster</span></span>
<span></span>
<span><span class="va">m_cv</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="fu">::</span><span class="fu"><a href="../reference/sdmTMB_cv.html">sdmTMB_cv</a></span><span class="op">(</span></span>
<span>  <span class="va">density</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth_scaled</span><span class="op">)</span> <span class="op">+</span> <span class="va">fyear</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pcod</span>,</span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  fold_ids <span class="op">=</span> <span class="va">clust</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running fits with `future.apply()`.</span></span>
<span><span class="co">#&gt; Set a parallel `future::plan()` to use parallel processing.</span></span></code></pre></div>
<p>Or similarly, these clusters could be assigned in time—here, each
year to a unique fold. Note that year is not included as a factor and
spatiotemporal fields are turned off because they cannot be estimated in
missing years.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m_cv</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="fu">::</span><span class="fu"><a href="../reference/sdmTMB_cv.html">sdmTMB_cv</a></span><span class="op">(</span></span>
<span>  <span class="va">density</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth_scaled</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pcod</span>,</span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  fold_ids <span class="op">=</span> <span class="va">clust</span>,</span>
<span>  spatiotemporal <span class="op">=</span> <span class="st">"off"</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running fits with `future.apply()`.</span></span>
<span><span class="co">#&gt; Set a parallel `future::plan()` to use parallel processing.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="measuring-model-performance">Measuring model performance<a class="anchor" aria-label="anchor" href="#measuring-model-performance"></a>
</h2>
<p>Lots of measures of predictive accuracy can be used to evaluate model
performance. By default, <code><a href="../reference/sdmTMB_cv.html">sdmTMB_cv()</a></code> returns a list that
contains the sum of the log likelihoods for each left-out fold and the
total summed across the left-out folds. This is roughly equivalent to
the expected log predictive density (ELPD) in the Bayesian literature
and can be interpreted as the predictive ability of the model for new
observations. These can be accessed as below, and inspecting the
quantities across folds may help elucidate whether there are particular
folds that are difficult to predict.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB_cv.html">sdmTMB_cv</a></span><span class="op">(</span></span>
<span>  <span class="va">density</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth_scaled</span><span class="op">)</span> <span class="op">+</span> <span class="va">fyear</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pcod</span>,</span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,</span>
<span>  k_folds <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running fits with `future.apply()`.</span></span>
<span><span class="co">#&gt; Set a parallel `future::plan()` to use parallel processing.</span></span>
<span></span>
<span><span class="va">m_cv</span><span class="op">$</span><span class="va">fold_loglik</span> <span class="co"># fold log-likelihood</span></span>
<span><span class="co">#&gt; [1] -1640.111 -1732.549 -1722.904 -1507.211</span></span>
<span><span class="va">m_cv</span><span class="op">$</span><span class="va">sum_loglik</span> <span class="co"># total log-likelihood</span></span>
<span><span class="co">#&gt; [1] -6602.776</span></span></code></pre></div>
<p>The <code>fold_loglik</code> values represent the sum of predictive
log-likelihood values across observations for each fold, and the
<code>sum_loglik</code> value represents the sum of
<code>fold_loglik</code> values, representing the sum for the entire
dataset. We can also calculate derived statistics based on the
predictive values – here, using examples with Root Mean Square Error
(RMSE) and Mean Absolute Error (MAE).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB_cv.html">sdmTMB_cv</a></span><span class="op">(</span></span>
<span>  <span class="va">density</span> <span class="op">~</span> <span class="va">depth_scaled</span> <span class="op">+</span> <span class="va">depth_scaled2</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pcod</span>, mesh <span class="op">=</span> <span class="fu"><a href="../reference/make_mesh.html">make_mesh</a></span><span class="op">(</span><span class="va">pcod</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, cutoff <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>, k_folds <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running fits with `future.apply()`.</span></span>
<span><span class="co">#&gt; Set a parallel `future::plan()` to use parallel processing.</span></span>
<span></span>
<span><span class="co"># RMSE across entire dataset:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">density</span> <span class="op">-</span> <span class="va">m</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">cv_predicted</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 194.9289</span></span>
<span><span class="co"># MAE across entire dataset:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">density</span> <span class="op">-</span> <span class="va">m</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">cv_predicted</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 50.53269</span></span></code></pre></div>
<p>Alternatively, we might be interested in calculating RMSE and MAE by
fold,</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># RMSE and MAE by fold:</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">data</span>, <span class="va">cv_fold</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    rmse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">density</span> <span class="op">-</span> <span class="va">cv_predicted</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    mae <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">density</span> <span class="op">-</span> <span class="va">cv_predicted</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   cv_fold  rmse   mae</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>       1  281.  58.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>       2  150.  48.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>       3  113.  44.6</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="single-splits">Single splits<a class="anchor" aria-label="anchor" href="#single-splits"></a>
</h2>
<p>In cases where only a single test set is evaluated (e.g., 10% of the
data), using the <code><a href="../reference/sdmTMB_cv.html">sdmTMB_cv()</a></code> function may be overkill
because two <code><a href="../reference/sdmTMB.html">sdmTMB()</a></code> models will be fit, but using this
function may be worthwhile to reduce coding errors (in the
log-likelihood calculations). For example, here we assign two folds,
randomly holding out 10% of the observations as a test set (the test set
is given ID = 1, and the training set is given ID = 2).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB_cv.html">sdmTMB_cv</a></span><span class="op">(</span></span>
<span>  <span class="va">density</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth_scaled</span><span class="op">)</span> <span class="op">+</span> <span class="va">fyear</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pcod</span>,</span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  fold_ids <span class="op">=</span> <span class="va">clust</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,</span>
<span>  k_folds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">clust</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can ignore the total log-likelihood, and just focus on the first
element of list list:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_cv</span><span class="op">$</span><span class="va">fold_loglik</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] -771.5139</span></span></code></pre></div>
<!-- # Leave Future Out Cross-Validation -->
<!-- We can do LFOCV using the relevant arguments. Our dataset has 9 time steps. Therefore, if we use the arguments `lfo_forecast=2` and `lfo_validations=3`, the cross validation will: -->
<!-- - Fit data to time steps 1 to 5, predict and validate step 7. -->
<!-- - Fit data to time steps 1 to 6, predict and validate step 8. -->
<!-- - Fit data to time steps 1 to 7, predict and validate step 9. -->
</div>
<div class="section level2">
<h2 id="comparing-two-or-more-models">Comparing two or more models<a class="anchor" aria-label="anchor" href="#comparing-two-or-more-models"></a>
</h2>
<p>We can use the output of <code><a href="../reference/sdmTMB_cv.html">sdmTMB_cv()</a></code> to compare two or
more models. For example, if we wanted to evaluate the support for a
depth effect or not, we could do 10-fold cross validation (it’s
important that the folds be the same across the two models). In this
example, using either the predictive log-likelihood or ELPD would lead
one to conclude that including depth improves the predictive accuracy of
the model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="fu">::</span><span class="fu"><a href="../reference/sdmTMB_cv.html">sdmTMB_cv</a></span><span class="op">(</span></span>
<span>  <span class="va">density</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">fyear</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pcod</span>,</span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  fold_ids <span class="op">=</span> <span class="va">clust</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running fits with `future.apply()`.</span></span>
<span><span class="co">#&gt; Set a parallel `future::plan()` to use parallel processing.</span></span>
<span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu">sdmTMB</span><span class="fu">::</span><span class="fu"><a href="../reference/sdmTMB_cv.html">sdmTMB_cv</a></span><span class="op">(</span></span>
<span>  <span class="va">density</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">fyear</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth_scaled</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pcod</span>,</span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  fold_ids <span class="op">=</span> <span class="va">clust</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running fits with `future.apply()`.</span></span>
<span><span class="co">#&gt; Set a parallel `future::plan()` to use parallel processing.</span></span>
<span></span>
<span><span class="co"># Compare log-likelihoods -- higher is better!</span></span>
<span><span class="va">m1</span><span class="op">$</span><span class="va">sum_loglik</span></span>
<span><span class="co">#&gt; [1] -6728.762</span></span>
<span><span class="va">m2</span><span class="op">$</span><span class="va">sum_loglik</span></span>
<span><span class="co">#&gt; [1] -6554.709</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-ensembling">Model ensembling<a class="anchor" aria-label="anchor" href="#model-ensembling"></a>
</h2>
<p>Finally, instead of identifying single “best” models, we may be
interested in doing model averaging. In the sdmTMB package, we’ve
implemented the model stacking procedure described by <span class="citation">(Yao <em>et al.</em> 2018)</span> in the
<code><a href="../reference/sdmTMB_stacking.html">sdmTMB_stacking()</a></code> function. This procedure uses
optimization to find the normalized weights that maximize the total
log-likelihood across models (other metrics may also be used). Inputs to
the function are a list of models (a fictitious
<code>model_list</code>), where each list element is the output of a
call to <code><a href="../reference/sdmTMB_cv.html">sdmTMB_cv()</a></code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB_stacking.html">sdmTMB_stacking</a></span><span class="op">(</span><span class="va">model_list</span><span class="op">)</span></span></code></pre></div>
<p>By default this calculation uses data from each fold. If instead, we
had split the data into the 10/90 split (as in the example above), we
wouldn’t want to use the 2nd model fit to generate these weights. If we
had just wanted to use the predictions from the first fold onto the 10%
test set, we could specify that using the <code>include_folds</code>
argument.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB_stacking.html">sdmTMB_stacking</a></span><span class="op">(</span><span class="va">model_list</span>, include_folds <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calculating-measures-of-predictive-skill-for-binary-data">Calculating measures of predictive skill for binary data<a class="anchor" aria-label="anchor" href="#calculating-measures-of-predictive-skill-for-binary-data"></a>
</h2>
<p>For delta models, or models of presence-absence data, several
measures of predictive ability are available. These are applicable to
cross validation, although we demonstrate them here first in a non-cross
validation context for simplicity.</p>
<p>A first commonly used diagnostic is the AUC (Area Under the Curve),
which quantifies the ability of a model to discriminate between the two
classes; this is done from the Receiver Operating Characteristic (ROC)
curve, which plots the true positive rate vs. false positive rate. There
are several packages to calculate AUC in R, but this can be done with
the <code>pROC</code> package, where inputs are a vector of 0s and 1s
(or factor equivalents) in the raw data, and a vector of estimated
probabilities (generated from a call to <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>, as shown
below). The <code><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis()</a></code> function is needed to convert
estimated values in logit space to probabilities in natural (zero to
one) space.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_mesh.html">make_mesh</a></span><span class="op">(</span><span class="va">pcod</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, cutoff <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span><span class="va">present</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">pcod</span>, mesh <span class="op">=</span> <span class="va">mesh</span><span class="op">)</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="co"># presence-absence model</span></span>
<span><span class="va">roc</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">$</span><span class="va">present</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">est</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Setting levels: control = 0, case = 1</span></span>
<span><span class="co">#&gt; Setting direction: controls &lt; cases</span></span>
<span><span class="va">auc</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html" class="external-link">auc</a></span><span class="op">(</span><span class="va">roc</span><span class="op">)</span></span>
<span><span class="va">auc</span></span>
<span><span class="co">#&gt; Area under the curve: 0.8831</span></span></code></pre></div>
<p>With a delta model, two estimated values are returned, so only the
first would be used. E.g.,</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span><span class="va">density</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">pcod</span>, </span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>, family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">delta_gamma</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the first linear predictor is the binomial component (est1):</span></span>
<span><span class="va">roc</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">pcod</span><span class="op">$</span><span class="va">present</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">est1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Setting levels: control = 0, case = 1</span></span>
<span><span class="co">#&gt; Setting direction: controls &lt; cases</span></span>
<span><span class="va">auc</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html" class="external-link">auc</a></span><span class="op">(</span><span class="va">roc</span><span class="op">)</span></span>
<span><span class="va">auc</span></span>
<span><span class="co">#&gt; Area under the curve: 0.8604</span></span></code></pre></div>
<p>If we wanted to apply this in the context of cross validation, we
could do it like this:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB_cv.html">sdmTMB_cv</a></span><span class="op">(</span></span>
<span>  <span class="va">present</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">pcod</span>, spatial <span class="op">=</span> <span class="st">"off"</span>,</span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, k_folds <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="va">roc</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">present</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">cv_predicted</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">auc</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html" class="external-link">auc</a></span><span class="op">(</span><span class="va">roc</span><span class="op">)</span></span>
<span><span class="va">auc</span></span></code></pre></div>
<p>AUC may be sensitive to imbalances in the data, however, and
alternative metrics may better approximate skill. Here we highlight an
example of using true skill score (implemented in packages such as
SDMtune):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_mesh.html">make_mesh</a></span><span class="op">(</span><span class="va">pcod</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, cutoff <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span><span class="va">present</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">pcod</span>, </span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, we can generate predicted probabilities and classes using a
threshold of 0.5 as an example:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">pred</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">est</span><span class="op">)</span></span>
<span><span class="va">pred</span><span class="op">$</span><span class="va">pred_01</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;</span> <span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Next we create a confusion matrix and calculate the true skill
score:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">pred_01</span>, <span class="va">pred</span><span class="op">$</span><span class="va">present</span><span class="op">)</span></span>
<span><span class="va">true_neg</span> <span class="op">&lt;-</span> <span class="va">conmat</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">false_neg</span> <span class="op">&lt;-</span> <span class="va">conmat</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">false_pos</span> <span class="op">&lt;-</span> <span class="va">conmat</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">true_pos</span> <span class="op">&lt;-</span> <span class="va">conmat</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Calculate TSS:</span></span>
<span><span class="va">true_pos_rate</span> <span class="op">&lt;-</span> <span class="va">true_pos</span> <span class="op">/</span> <span class="op">(</span><span class="va">true_pos</span> <span class="op">+</span> <span class="va">false_neg</span><span class="op">)</span></span>
<span><span class="va">true_neg_rate</span> <span class="op">&lt;-</span> <span class="va">true_neg</span> <span class="op">/</span> <span class="op">(</span><span class="va">true_neg</span> <span class="op">+</span> <span class="va">false_pos</span><span class="op">)</span></span>
<span><span class="va">TSS</span> <span class="op">&lt;-</span> <span class="va">true_pos_rate</span> <span class="op">+</span> <span class="va">true_neg_rate</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">TSS</span></span>
<span><span class="co">#&gt; [1] 0.5238745</span></span></code></pre></div>
<p>In some cases, reporting the true negative or true positive rate
might be of interest in addition to TSS.</p>
</div>
<div class="section level2">
<h2 id="multi-scale-spatial-assessment-with-waywiser">Multi-scale spatial assessment with waywiser<a class="anchor" aria-label="anchor" href="#multi-scale-spatial-assessment-with-waywiser"></a>
</h2>
<p>The waywiser package <span class="citation">(Mahoney 2023)</span>
provides tools for assessing spatial models, including methods to
evaluate model performance at multiple spatial scales. A common pattern
with spatial models is that predictions for individual observation units
(e.g., points, pixels) may be aggregated to arbitrary scales (e.g.,
management units, grid cells of varying sizes). Because prediction
errors can be spatially distributed and may compound or counteract each
other when aggregated, it’s useful to assess model performance across
multiple scales.</p>
<p>The <code><a href="../reference/cv_to_waywiser.html">cv_to_waywiser()</a></code> function converts
<code>sdmTMB_cv</code> objects to sf (simple features) format, which can
then be passed to waywiser functions like
<code>ww_multi_scale()</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First run cross-validation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_mesh.html">make_mesh</a></span><span class="op">(</span><span class="va">pcod</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, cutoff <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">m_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB_cv.html">sdmTMB_cv</a></span><span class="op">(</span></span>
<span>  <span class="va">density</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">depth_scaled</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pcod</span>,</span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">tweedie</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,</span>
<span>  k_folds <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running fits with `future.apply()`.</span></span>
<span><span class="co">#&gt; Set a parallel `future::plan()` to use parallel processing.</span></span>
<span></span>
<span><span class="co"># Convert to sf format for spatial assessment</span></span>
<span><span class="va">cv_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv_to_waywiser.html">cv_to_waywiser</a></span><span class="op">(</span><span class="va">m_cv</span>, ll_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Detected UTM zone 9N; CRS = 32609.</span></span>
<span><span class="co">#&gt; Visit https://epsg.io/32609 to verify.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cv_sf</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 2143 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 343061.7 ymin: 5635893 xmax: 579368.1 ymax: 5839019</span></span>
<span><span class="co">#&gt; Projected CRS: WGS 84 / UTM zone 9N</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;        truth     estimate                 geometry</span></span>
<span><span class="co">#&gt; 1  113.13848 37.532270279 POINT (446475.2 5793426)</span></span>
<span><span class="co">#&gt; 2   41.70492 11.173070839 POINT (446459.4 5800136)</span></span>
<span><span class="co">#&gt; 3    0.00000  9.561890006 POINT (448598.7 5801687)</span></span>
<span><span class="co">#&gt; 4   15.70614 98.612458614 POINT (436915.7 5802305)</span></span>
<span><span class="co">#&gt; 5    0.00000  7.037695083 POINT (420610.1 5771055)</span></span>
<span><span class="co">#&gt; 6    0.00000  0.891090606   POINT (417713 5772205)</span></span>
<span><span class="co">#&gt; 7    0.00000  0.033984196 POINT (408208.8 5771287)</span></span>
<span><span class="co">#&gt; 8    0.00000  0.007256825 POINT (408356.2 5766882)</span></span>
<span><span class="co">#&gt; 9    0.00000  0.427827876 POINT (414365.6 5760894)</span></span>
<span><span class="co">#&gt; 10  13.94762  6.558124623 POINT (400474.5 5749034)</span></span></code></pre></div>
<p>This sf object can now be used with waywiser functions. For example,
to assess model performance at multiple spatial scales:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assess performance at different grid resolutions</span></span>
<span><span class="co"># n controls the number of grid cells in x and y directions</span></span>
<span><span class="va">multi_scale_results</span> <span class="op">&lt;-</span> <span class="fu">waywiser</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/waywiser/reference/ww_multi_scale.html" class="external-link">ww_multi_scale</a></span><span class="op">(</span></span>
<span>  <span class="va">cv_sf</span>,</span>
<span>  <span class="va">truth</span>,    <span class="co"># column name (unquoted)</span></span>
<span>  <span class="va">estimate</span>, <span class="co"># column name (unquoted)</span></span>
<span>  <span class="co"># 10x10, 5x5, and 2x2 grids:</span></span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">multi_scale_results</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   .metric .estimator .estimate .grid_args       .grid          .notes          </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> rmse    standard       19.4  <span style="color: #949494;">&lt;tibble [1 × 1]&gt;</span> <span style="color: #949494;">&lt;sf [100 × 5]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 2]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> mae     standard       12.2  <span style="color: #949494;">&lt;tibble [1 × 1]&gt;</span> <span style="color: #949494;">&lt;sf [100 × 5]&gt;</span> <span style="color: #949494;">&lt;tibble [0 × 2]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> rmse    standard        7.23 <span style="color: #949494;">&lt;tibble [1 × 1]&gt;</span> <span style="color: #949494;">&lt;sf [25 × 5]&gt;</span>  <span style="color: #949494;">&lt;tibble [0 × 2]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> mae     standard        4.80 <span style="color: #949494;">&lt;tibble [1 × 1]&gt;</span> <span style="color: #949494;">&lt;sf [25 × 5]&gt;</span>  <span style="color: #949494;">&lt;tibble [0 × 2]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> rmse    standard        3.45 <span style="color: #949494;">&lt;tibble [1 × 1]&gt;</span> <span style="color: #949494;">&lt;sf [4 × 5]&gt;</span>   <span style="color: #949494;">&lt;tibble [0 × 2]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> mae     standard        3.40 <span style="color: #949494;">&lt;tibble [1 × 1]&gt;</span> <span style="color: #949494;">&lt;sf [4 × 5]&gt;</span>   <span style="color: #949494;">&lt;tibble [0 × 2]&gt;</span></span></span></code></pre></div>
<p>The results show how metrics like RMSE and MAE change as predictions
are aggregated to coarser spatial scales, which can reveal whether your
model’s performance is scale-dependent.</p>
<p>See the waywiser documentation
(<code><a href="https://docs.ropensci.org/waywiser/reference/ww_multi_scale.html" class="external-link">?waywiser::ww_multi_scale</a></code> and
<code><a href="https://docs.ropensci.org/waywiser/articles/multi-scale-assessment.html" class="external-link">vignette("multi-scale-assessment", package = "waywiser")</a></code>)
for more details on interpreting multi-scale assessment results and
additional functions for spatial model evaluation.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-mahoney_2023" class="csl-entry">
Mahoney, M. (2023). <em>Waywiser: Ergonomic methods for assessing
spatial models</em>. Retrieved from <a href="https://CRAN.R-project.org/package=waywiser" class="external-link">https://CRAN.R-project.org/package=waywiser</a>
</div>
<div id="ref-silge_2021" class="csl-entry">
Silge, J. (2021). <em>Spatialsample: Spatial resampling
infrastructure</em>. Retrieved from <a href="https://CRAN.R-project.org/package=spatialsample" class="external-link">https://CRAN.R-project.org/package=spatialsample</a>
</div>
<div id="ref-valavi_2019" class="csl-entry">
Valavi, R., Elith, J., Lahoz-Monfort, J.J. &amp; Guillera-Arroita, G.
(2019). blockCV: An r package for generating spatially or
environmentally separated folds for k-fold cross-validation of species
distribution models. <em>Methods in Ecology and Evolution</em>,
<strong>10</strong>, 225–232.
</div>
<div id="ref-yao_2018" class="csl-entry">
Yao, Y., Vehtari, A., Simpson, D. &amp; Gelman, A. (2018). <span class="nocase">Using Stacking to Average Bayesian Predictive
Distributions (with Discussion)</span>. <em>Bayesian Analysis</em>,
<strong>13</strong>, 917–1007.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean C. Anderson, Eric J. Ward, Philina A. English, Lewis A. K. Barnett, James T. Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
