<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Calculating range edges • sdmTMB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculating range edges">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sdmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.4.9024</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sdmTMB/sdmTMB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculating range edges</h1>
            
            <h4 data-toc-skip class="date">2025-11-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sdmTMB/sdmTMB/blob/main/vignettes/articles/range-edges.Rmd" class="external-link"><code>vignettes/articles/range-edges.Rmd</code></a></small>
      <div class="d-none name"><code>range-edges.Rmd</code></div>
    </div>

    
    
<p><strong>If the code in this vignette has not been evaluated, a
rendered version is available on the <a href="https://sdmTMB.github.io/sdmTMB/index.html">documentation site</a>
under ‘Articles’.</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sdmTMB.github.io/sdmTMB/">sdmTMB</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Range edges are useful metrics for understanding species
distributions and how they change over time. The
<code><a href="../reference/get_range_edge.html">get_range_edge()</a></code> function calculates range edges as
density-weighted quantiles along a spatial axis (e.g., latitude,
longitude, or depth). This approach follows methods used in Fredston et
al. 2021 from VAST.</p>
<p>Range edges are calculated by:</p>
<ol style="list-style-type: decimal">
<li>Ordering spatial locations along a user-specified axis</li>
<li>Calculating the cumulative proportion of total density along that
axis</li>
<li>Finding positions where the cumulative proportion equals target
quantiles</li>
<li>Using simulation from the joint precision matrix to quantify
uncertainty</li>
</ol>
<p>In this vignette, we’ll demonstrate calculating range edges for
Pacific Spiny Dogfish (<em>Squalus suckleyi</em>) along the latitude
axis on the west coast of Vancouver Island.</p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>We’ll use the built-in <code>dogfish</code> dataset, which contains
fisheries-independent trawl survey data from the west coast of Vancouver
Island. The data includes catch weights, presence/absence, depth, and
area swept.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">dogfish</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 1,458</span></span>
<span><span class="co">#&gt; Columns: 9</span></span>
<span><span class="co">#&gt; $ year         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 2004<span style="color: #949494;">, </span>2004<span style="color: #949494;">, </span>2004<span style="color: #949494;">, </span>2004<span style="color: #949494;">, </span>2004<span style="color: #949494;">, </span>2004<span style="color: #949494;">, </span>2004<span style="color: #949494;">, </span>2004<span style="color: #949494;">, </span>2004<span style="color: #949494;">, </span>200…</span></span>
<span><span class="co">#&gt; $ longitude    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -125.1928<span style="color: #949494;">, </span>-125.8362<span style="color: #949494;">, </span>-125.7952<span style="color: #949494;">, </span>-125.6383<span style="color: #949494;">, </span>-125.7022<span style="color: #949494;">, </span>-1…</span></span>
<span><span class="co">#&gt; $ latitude     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 48.68167<span style="color: #949494;">, </span>48.22183<span style="color: #949494;">, </span>48.30733<span style="color: #949494;">, </span>48.29017<span style="color: #949494;">, </span>48.36000<span style="color: #949494;">, </span>48.3645…</span></span>
<span><span class="co">#&gt; $ X            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 780.2098<span style="color: #949494;">, </span>734.9809<span style="color: #949494;">, </span>737.6287<span style="color: #949494;">, </span>749.3395<span style="color: #949494;">, </span>744.2715<span style="color: #949494;">, </span>737.449…</span></span>
<span><span class="co">#&gt; $ Y            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 5399.066<span style="color: #949494;">, </span>5345.797<span style="color: #949494;">, </span>5355.425<span style="color: #949494;">, </span>5354.015<span style="color: #949494;">, </span>5361.570<span style="color: #949494;">, </span>5361.78…</span></span>
<span><span class="co">#&gt; $ present      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ catch_weight <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 22.7<span style="color: #949494;">, </span>0.0<span style="color: #949494;">, </span>0.0<span style="color: #949494;">, </span>221.1<span style="color: #949494;">, </span>439.8<span style="color: #949494;">, </span>48.2<span style="color: #949494;">, </span>13.5<span style="color: #949494;">, </span>0.0<span style="color: #949494;">, </span>47.9<span style="color: #949494;">, </span>68.2…</span></span>
<span><span class="co">#&gt; $ area_swept   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.10288<span style="color: #949494;">, </span>0.10288<span style="color: #949494;">, </span>0.11574<span style="color: #949494;">, </span>0.12217<span style="color: #949494;">, </span>0.09645<span style="color: #949494;">, </span>0.12217<span style="color: #949494;">, </span>0.1…</span></span>
<span><span class="co">#&gt; $ depth        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 73<span style="color: #949494;">, </span>455<span style="color: #949494;">, </span>171<span style="color: #949494;">, </span>137<span style="color: #949494;">, </span>140<span style="color: #949494;">, </span>145<span style="color: #949494;">, </span>320<span style="color: #949494;">, </span>279<span style="color: #949494;">, </span>117<span style="color: #949494;">, </span>70<span style="color: #949494;">, </span>61<span style="color: #949494;">, </span>77<span style="color: #949494;">, </span>9…</span></span></code></pre></div>
<p>For prediction, we’ll use the <code>wcvi_grid</code>, which provides
a spatial grid covering the survey area:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">wcvi_grid</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 2,689</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ X     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 733.9852<span style="color: #949494;">, </span>735.9852<span style="color: #949494;">, </span>737.9852<span style="color: #949494;">, </span>735.9852<span style="color: #949494;">, </span>737.9852<span style="color: #949494;">, </span>739.9852<span style="color: #949494;">, </span>735.…</span></span>
<span><span class="co">#&gt; $ Y     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 5346.334<span style="color: #949494;">, </span>5346.334<span style="color: #949494;">, </span>5346.334<span style="color: #949494;">, </span>5348.334<span style="color: #949494;">, </span>5348.334<span style="color: #949494;">, </span>5348.334<span style="color: #949494;">, </span>5350…</span></span>
<span><span class="co">#&gt; $ depth <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 447<span style="color: #949494;">, </span>442<span style="color: #949494;">, </span>433<span style="color: #949494;">, </span>312<span style="color: #949494;">, </span>295<span style="color: #949494;">, </span>400<span style="color: #949494;">, </span>287<span style="color: #949494;">, </span>233<span style="color: #949494;">, </span>352<span style="color: #949494;">, </span>449<span style="color: #949494;">, </span>402<span style="color: #949494;">, </span>390<span style="color: #949494;">, </span>382<span style="color: #949494;">,</span>…</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fitting-a-spatiotemporal-model">Fitting a spatiotemporal model<a class="anchor" aria-label="anchor" href="#fitting-a-spatiotemporal-model"></a>
</h2>
<p>First, we’ll construct a mesh for the spatial random effects:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_mesh.html">make_mesh</a></span><span class="op">(</span><span class="va">dogfish</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, cutoff <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>Next, we’ll fit a spatiotemporal model for dogfish density using a
delta generalized-gamma family (Dunic et al. 2025). This models the
positive catches with a generalized gamma distribution that works well
for Pacific Dogfish given their occasional giant outlying catch values.
A simpler Tweedie or delta-gamma family could have been used too. We’ll
include depth as a predictor using a quadratic effect:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdmTMB.html">sdmTMB</a></span><span class="op">(</span></span>
<span>  <span class="va">catch_weight</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">depth</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dogfish</span>,</span>
<span>  mesh <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/families.html">delta_gengamma</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"poisson-link"</span><span class="op">)</span>,</span>
<span>  spatial <span class="op">=</span> <span class="st">"on"</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  spatiotemporal <span class="op">=</span> <span class="st">"IID"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/sanity.html">sanity</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Non-linear minimizer suggests successful convergence</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Hessian matrix is positive definite</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No extreme or very small eigenvalues detected</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No gradients with respect to fixed effects are &gt;= 0.001</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No fixed-effect standard errors are NA</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No standard errors look unreasonably large</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No sigma parameters are &lt; 0.01</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> No sigma parameters are &gt; 100</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Range parameters don't look unreasonably large</span></span>
<span><span class="va">fit</span></span>
<span><span class="co">#&gt; Spatiotemporal model fit by ML ['sdmTMB']</span></span>
<span><span class="co">#&gt; Formula: catch_weight ~ poly(log(depth), 2)</span></span>
<span><span class="co">#&gt; Mesh: mesh (isotropic covariance)</span></span>
<span><span class="co">#&gt; Time column: year</span></span>
<span><span class="co">#&gt; Data: dogfish</span></span>
<span><span class="co">#&gt; Family: delta_gengamma(link1 = 'log', link2 = 'log', type = 'poisson-link')</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Delta/hurdle model 1: -----------------------------------</span></span>
<span><span class="co">#&gt; Family: binomial(link = 'log') </span></span>
<span><span class="co">#&gt; Conditional model:</span></span>
<span><span class="co">#&gt;                      coef.est coef.se</span></span>
<span><span class="co">#&gt; (Intercept)              0.17    0.38</span></span>
<span><span class="co">#&gt; poly(log(depth), 2)1    -9.28    4.42</span></span>
<span><span class="co">#&gt; poly(log(depth), 2)2   -30.68    3.23</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matérn range: 54.35</span></span>
<span><span class="co">#&gt; Spatial SD: 0.96</span></span>
<span><span class="co">#&gt; Spatiotemporal IID SD: 1.31</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Delta/hurdle model 2: -----------------------------------</span></span>
<span><span class="co">#&gt; Family: gengamma(link = 'log') </span></span>
<span><span class="co">#&gt; Conditional model:</span></span>
<span><span class="co">#&gt;                      coef.est coef.se</span></span>
<span><span class="co">#&gt; (Intercept)              2.71    0.29</span></span>
<span><span class="co">#&gt; poly(log(depth), 2)1    -5.53    3.06</span></span>
<span><span class="co">#&gt; poly(log(depth), 2)2    -7.98    2.54</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dispersion parameter: 1.08</span></span>
<span><span class="co">#&gt; Generalized gamma Q: -0.68</span></span>
<span><span class="co">#&gt; Matérn range: 86.75</span></span>
<span><span class="co">#&gt; Spatial SD: 0.24</span></span>
<span><span class="co">#&gt; Spatiotemporal IID SD: 0.46</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ML criterion at convergence: 5523.459</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; See ?tidy.sdmTMB to extract these values as a data frame.</span></span></code></pre></div>
<p>The model shows both spatial and spatiotemporal variation, with depth
having a strong relationship with dogfish density.</p>
</div>
<div class="section level2">
<h2 id="making-predictions">Making predictions<a class="anchor" aria-label="anchor" href="#making-predictions"></a>
</h2>
<p>To calculate range edges, we need to make predictions on a spatial
grid that covers the area of interest. We’ll replicate the
<code>wcvi_grid</code> for each year in the dataset and generate
predictions with simulation:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create prediction grid for each year</span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dogfish</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/replicate_df.html">replicate_df</a></span><span class="op">(</span><span class="va">wcvi_grid</span>, <span class="st">"year"</span>, <span class="va">years</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make predictions with simulations for uncertainty quantification</span></span>
<span><span class="co"># Using nsim = 200 simulations from the joint precision matrix</span></span>
<span><span class="co"># larger simulations will be more stable at the expense of speed and memory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">nd</span>, nsim <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function with <code>nsim &gt; 0</code>
returns a matrix where each column represents one simulation draw from
the joint precision matrix.</p>
</div>
<div class="section level2">
<h2 id="calculating-range-edges">Calculating range edges<a class="anchor" aria-label="anchor" href="#calculating-range-edges"></a>
</h2>
<p>Now we can calculate range edges along the latitude axis (Y
coordinate). By default, <code><a href="../reference/get_range_edge.html">get_range_edge()</a></code> calculates the
2.5% and 97.5% quantiles, representing the lower and upper range edges.
Here, we’ll also add in the median (0.5) to find the center of the
distribution.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edges</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_range_edge.html">get_range_edge</a></span><span class="op">(</span><span class="va">pred</span>, axis <span class="op">=</span> <span class="va">nd</span><span class="op">$</span><span class="va">Y</span>, quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.50</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span></span>
<span><span class="co">#&gt;   year quantile      est      lwr      upr        se</span></span>
<span><span class="co">#&gt; 1 2004    0.025 5360.334 5356.334 5366.334  2.847127</span></span>
<span><span class="co">#&gt; 2 2004    0.500 5392.334 5384.334 5416.334  8.386996</span></span>
<span><span class="co">#&gt; 3 2004    0.975 5570.334 5510.334 5590.334 22.087935</span></span>
<span><span class="co">#&gt; 4 2006    0.025 5358.334 5354.334 5362.334  1.853287</span></span>
<span><span class="co">#&gt; 5 2006    0.500 5436.334 5414.334 5458.334 10.086017</span></span>
<span><span class="co">#&gt; 6 2006    0.975 5582.334 5559.884 5590.384  9.733245</span></span></code></pre></div>
<p>The output includes:</p>
<ul>
<li>
<code>year</code>: the time slice</li>
<li>
<code>quantile</code>: the quantile value (0.025 for lower edge,
0.500 for the median, 0.975 for upper edge)</li>
<li>
<code>est</code>: the estimated position along the axis (latitude in
this case)</li>
<li>
<code>lwr</code> and <code>upr</code>: 95% confidence intervals for
each quantile</li>
<li>
<code>se</code>: standard error for each quantile</li>
</ul>
</div>
<div class="section level2">
<h2 id="visualizing-range-edges">Visualizing range edges<a class="anchor" aria-label="anchor" href="#visualizing-range-edges"></a>
</h2>
<p>We can plot how the range edges change over time:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">edges</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">est</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">quantile</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lwr</span>, ymax <span class="op">=</span> <span class="va">upr</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">quantile</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    colour <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Latitude (UTM km)"</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"Quantile"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Quantile"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_colour_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5%"</span>, <span class="st">"50%"</span>, <span class="st">"95%"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_fill_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5%"</span>, <span class="st">"50%"</span>, <span class="st">"95%"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="range-edges_files/figure-html/plot-custom-edges-1.png" class="r-plt" width="672"></p>
<p>This plot shows how the northern and southern range edges of dogfish
have shifted over time, with uncertainty bands reflecting sampling and
estimation uncertainty. The median line represents the center of the
distribution.</p>
</div>
<div class="section level2">
<h2 id="accessing-simulation-draws">Accessing simulation draws<a class="anchor" aria-label="anchor" href="#accessing-simulation-draws"></a>
</h2>
<p>For custom analyses, you can access the raw simulation draws:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edges_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_range_edge.html">get_range_edge</a></span><span class="op">(</span><span class="va">pred</span>, axis <span class="op">=</span> <span class="va">nd</span><span class="op">$</span><span class="va">Y</span>, return_sims <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">edges_sims</span><span class="op">)</span></span>
<span><span class="co">#&gt;   year quantile   .value .iteration</span></span>
<span><span class="co">#&gt; 1 2004    0.025 5362.334          1</span></span>
<span><span class="co">#&gt; 2 2004    0.025 5358.334          2</span></span>
<span><span class="co">#&gt; 3 2004    0.025 5358.334          3</span></span>
<span><span class="co">#&gt; 4 2004    0.025 5358.334          4</span></span>
<span><span class="co">#&gt; 5 2004    0.025 5356.334          5</span></span>
<span><span class="co">#&gt; 6 2004    0.025 5362.334          6</span></span></code></pre></div>
<p>This returns all simulation draws in long format, which can be useful
for:</p>
<ul>
<li>Custom uncertainty quantification</li>
<li>Calculating probabilities of range shifts</li>
<li>Comparing range edges between models or scenarios</li>
</ul>
<p>For example, we could calculate the probability that the upper range
edge (northern edge) has shifted northward between two time periods:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract simulations for upper edge in first and last year</span></span>
<span><span class="va">upper_first</span> <span class="op">&lt;-</span> <span class="va">edges_sims</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">quantile</span> <span class="op">==</span> <span class="fl">0.975</span>, <span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">upper_last</span> <span class="op">&lt;-</span> <span class="va">edges_sims</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">quantile</span> <span class="op">==</span> <span class="fl">0.975</span>, <span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate shift for each simulation</span></span>
<span><span class="va">shifts</span> <span class="op">&lt;-</span> <span class="va">upper_last</span><span class="op">$</span><span class="va">.value</span> <span class="op">-</span> <span class="va">upper_first</span><span class="op">$</span><span class="va">.value</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">upper_last</span><span class="op">$</span><span class="va">.iteration</span>, <span class="va">upper_first</span><span class="op">$</span><span class="va">.iteration</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Probability of northward shift</span></span>
<span><span class="va">prob_north</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">shifts</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Probability of northward shift:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">prob_north</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Probability of northward shift: 41 %</span></span></code></pre></div>
<p>We can plot that distibution:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>shifts <span class="op">=</span> <span class="va">shifts</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">shifts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value `binwidth`.</span></span></code></pre></div>
<p><img src="range-edges_files/figure-html/prob-shift-hist-1.png" class="r-plt" width="672"></p>
<p>If anything, the northern range has contracted here, which is
consistent with previous research on this stock (Ward et al. 2024).</p>
</div>
<div class="section level2">
<h2 id="other-axes">Other axes<a class="anchor" aria-label="anchor" href="#other-axes"></a>
</h2>
<p>While we’ve demonstrated using latitude (Y), range edges can be
calculated along any spatial axis. Common choices include:</p>
<ul>
<li>
<strong>Longitude (X)</strong>: for east-west range shifts</li>
<li>
<strong>Depth</strong>: for depth range edges (e.g., shallow
vs. deep distribution limits)</li>
<li>
<strong>Coastal distance</strong>: for offshore/onshore distribution
patterns</li>
<li>
<strong>Temperature</strong>: if you have environmental covariates
in your prediction grid</li>
</ul>
<p>Simply provide the appropriate vector to the <code>axis</code>
argument.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Dunic, J.C., Conner, J., Anderson, S.C., and Thorson, J.T. 2025. The
generalized gamma is a flexible distribution that outperforms
alternatives when modelling catch rate data. ICES Journal of Marine
Science 82(4): fsaf040. <a href="https://doi.org/10.1093/icesjms/fsaf040" class="external-link uri">https://doi.org/10.1093/icesjms/fsaf040</a></p>
<p>Fredston, A. L., Pinsky, M., Selden, R. L., Szuwalski, C., Thorson,
J. T., Gaines, S. D., &amp; Halpern, B. S. (2021). Range edges of North
American marine species are tracking temperature over decades.
<em>Global Change Biology</em>, 27(13), 3145-3156. <a href="https://doi.org/10.1111/gcb.15614" class="external-link uri">https://doi.org/10.1111/gcb.15614</a></p>
<p>Ward, E.J., Anderson, S.C., Barnett, L.A.K., English, P.A., Berger,
H.M., Commander, C.J.C., Essington, T.E., Harvey, C.J., Hunsicker, M.E.,
Jacox, M.G., Johnson, K.F., Large, S., Liu, O.R., Richerson, K.E.,
Samhouri, J.F., Siedlecki, S.A., Shelton, A.O., Somers, K.A., and
Watson, J.T. 2024. Win, lose, or draw: Evaluating dynamic thermal niches
of northeast Pacific groundfish. PLOS Climate 3(11): e0000454. Public
Library of Science. <a href="https://doi.org/10.1371/journal.pclm.0000454" class="external-link uri">https://doi.org/10.1371/journal.pclm.0000454</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean C. Anderson, Eric J. Ward, Philina A. English, Lewis A. K. Barnett, James T. Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
